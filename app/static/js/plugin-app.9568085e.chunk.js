"use strict";(self.webpackChunkmaps_app=self.webpackChunkmaps_app||[]).push([[2143],{89487:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ro});var n=a(44538),r=a(78594),i=a(54479),s=a(46329),o=a(1006),d=a.n(o),l=a(91982),c=a(63665),f=a.n(c),u=a(2085),p=a(53853);const m=()=>u.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",top:0}},u.createElement(i.M,null,u.createElement(s.V,null)));var b=a(16259);const g="en",y=e=>e&&e.includes("_")?e.replace("_","-"):e,h=e=>Array.isArray(e)?new Date(e[0],e[1],e[2]):new Date(e),E=e=>{const t=h(e);return`${t.getFullYear()}-${("0"+(t.getMonth()+1)).slice(-2)}-${("0"+t.getDate()).slice(-2)}`},v=e=>e.substr(0,10),C=void 0!==a.g.Intl&&Intl.DateTimeFormat,P=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return C?new Intl.DateTimeFormat(y(t||b.Z.language||g),{year:a?"numeric":void 0,month:"short",day:"numeric"}).format(h(e)):v(e)},S=(e,t,a,n)=>{const r=a||b.Z.language||g;return`${P(e,r,n)} - ${P(t,a,n)}`},_=e=>[parseInt(e.substring(0,4)),parseInt(e.substring(5,7))-1,parseInt(e.substring(8,10))],w="tileLayer",T="googleLayer",N="bingLayer",O="external",Z="earthEngine",R="geoJson",x=(E((new Date).setFullYear((new Date).getFullYear()-1)),E(new Date),"SINGLE"),A="SPLIT_BY_PERIOD",k="CHOROPLETH",L="BUBBLE",I=5,M=30,D=1e5,F="#333333",U="#BB0000",j="#000000",G="#0000BB",B="#333333",V=6,q=1,$=2,H="COLOR",z="SYMBOL",W="{name}",Y="14px",J="#333333",Q="osmLight",K=()=>X()[0],X=()=>[{id:Q,name:b.Z.t("OSM Light"),img:"images/osmlight.png",config:{type:w,url:"//cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'}},{id:"openStreetMap",name:b.Z.t("OSM Detailed"),img:"images/osm.png",config:{type:w,url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}},{id:"googleStreets",name:b.Z.t("Google Streets"),img:"images/googlestreets.png",config:{type:T,style:"ROADMAP"}},{id:"googleHybrid",name:b.Z.t("Google Hybrid"),img:"images/googlehybrid.jpeg",config:{type:T,style:"HYBRID"}},{id:"bingLight",name:b.Z.t("Bing Road"),img:"images/bingroad.png",config:{type:N,style:"CanvasLight",apiKey:"AotYGLQC0RDcofHC5pWLaW7k854n-6T9mTunsev9LEFwVqGaVnG8b4KERNY9PeKA"}},{id:"bingDark",name:b.Z.t("Bing Dark"),img:"images/bingdark.png",config:{type:N,style:"CanvasDark"}},{id:"bingAerial",name:b.Z.t("Bing Aerial"),img:"images/bingaerial.jpeg",config:{type:N,style:"Aerial"}},{id:"bingHybrid",name:b.Z.t("Bing Aerial Labels"),img:"images/binghybrid.jpeg",config:{type:N,style:"AerialWithLabelsOnDemand"}}],ee={keyDefaultBaseMap:Q},te={resource:"systemSettings",params:{key:["keyAnalysisRelativePeriod","keyBingMapsApiKey","keyHideDailyPeriods","keyHideWeeklyPeriods","keyHideBiWeeklyPeriods","keyHideMonthlyPeriods","keyHideBiMonthlyPeriods","keyDefaultBaseMap"]}},ae=(0,u.createContext)({}),ne=/keyHide(.*)Periods/,re=e=>Object.keys(e).filter((t=>ne.test(t)&&e[t])).map((e=>e.match(ne)[1].toUpperCase())),ie=e=>{let{children:t}=e;const[a,r]=(0,u.useState)({}),i=(0,n.bQ)();return(0,u.useEffect)((()=>{!async function(){const{systemSettings:e}=await i.query({systemSettings:te});r(Object.assign({},ee,e,{hiddenPeriods:re(e)}))}()}),[i]),u.createElement(ae.Provider,{value:a},t)};ie.propTypes={children:f().node};const se=ie,oe=(e,t)=>{const a=e.mapViews.find((e=>e.layer===O&&"BASEMAP"===JSON.parse(e.config||{}).mapLayerPosition));let n,r=e.mapViews;return a?(n=JSON.parse(a.config),r=e.mapViews.filter((e=>e.id!==a.id))):n=(0,l.isString)(e.basemap)?"none"===e.basemap?{id:t,isVisible:!1}:{id:e.basemap}:(0,l.isObject)(e.basemap)?e.basemap:{id:t},{...e,basemap:n,mapViews:r}},de={externalLayer:1,earthEngine:2,thematic4:3,thematic3:4,thematic2:5,thematic1:6,boundary:7,facility:8,event:9},le=e=>{const{mapViews:t}=e;if(!t.some((e=>e.layer.match(/thematic[1-4]/))))return e;const a=(0,l.sortBy)((e=>de[e.layer]),t).map((e=>({...e,layer:e.layer.replace(/\d$/,"")})));return{...e,mapViews:a}},ce=e=>({...e,mapViews:e.mapViews.map((e=>"boundary"===e.layer?{...e,layer:"orgUnit"}:e))});var fe=a(43933),ue=a(67637);const pe=async e=>{const t=await e.text();return""===t?void 0:JSON.parse(t)},me=async(e,t,a)=>{const n={headers:{"Content-Type":"application/json"},credentials:"include"};return t&&a&&(n.method=t,(0,l.isString)(a)?(n.headers["Content-Type"]="text/html",n.body=a):(0,l.isObject)(a)&&(n.body=JSON.stringify(a))),fetch(encodeURI(ue.vc.baseUrl+e),n).then((e=>["POST","PUT","PATCH"].includes(t)?e:pe(e))).catch((e=>console.log("Error: ",e)))},be={name:"name",displayName:"name",shortName:"shortName",displayShortName:"shortName"},ge=(e,t)=>{const a=e.currentUser.settings.keyAnalysisDisplayProperty;return be[a]||be[t]||"name"},ye=["id","user","displayName~rename(name)","description","longitude","latitude","zoom","basemap","publicAccess","created","lastUpdated","access","update","manage","delete","href"],he=(["*","!created","!lastUpdated","!displayName","!externalAccess","!access","!userGroupAccesses"].join(","),e=>e.find((e=>e.renderingStrategy===A))),Ee=e=>`${e.substring(0,10)} ${e.substring(11,16)}`,ve=(e,t)=>e.reduce(((e,a)=>a[t]&&String(a[t]).length>e.length?String(a[t]):e),"").length,Ce=((()=>{const e=(()=>{const e="displayName~rename(name)";return["*",`columns[dimension,filter,items[dimensionItem~rename(id),dimensionItemType,${e}]]`,`rows[dimension,filter,items[dimensionItem~rename(id),dimensionItemType,${e}]]`,`filters[dimension,filter,items[dimensionItem~rename(id),dimensionItemType,${e}]]`,"organisationUnits[id,path]","dataDimensionItems",`program[id,${e}]`,"programStage[id,displayName~rename(name)]","legendSet[id,displayName~rename(name)]","trackedEntityType[id,displayName~rename(name)]","organisationUnitSelectionMode","!href","!publicAccess","!rewindRelativePeriods","!userOrganisationUnit","!userOrganisationUnitChildren","!userOrganisationUnitGrandChildren","!externalAccess","!access","!relativePeriods","!columnDimensions","!rowDimensions","!filterDimensions","!user","!organisationUnitGroups","!itemOrganisationUnitGroups","!userGroupAccesses","!indicators","!dataElements","!dataElementOperands","!dataElementGroups","!dataSets","!periods","!organisationUnitLevels","!sortOrder","!topLimit"]})();ye.join(","),e.join(",")})(),{resource:"externalMapLayers",params:{paging:!1,fields:"id,displayName~rename(name),service,url,attribution,mapService,layers,imageFormat,mapLayerPosition,legendSet,legendSetUrl"}}),Pe=async e=>e.query({externalLayers:Ce}),Se={WMS:"wmsLayer",XYZ:w,TMS:w,VECTOR_STYLE:"vectorStyle"},_e=e=>({layer:O,id:e.id,name:e.name,opacity:1,config:we(e)}),we=e=>{const{id:t,name:a,attribution:n,mapService:r,url:i,layers:s,imageFormat:o,legendSet:d,legendSetUrl:l}=e;return{id:t,type:Se[r],url:i,attribution:n,name:a,layers:s,tms:"TMS"===r,format:"JPG"===o?"image/jpeg":"image/png",legendSet:d,legendSetUrl:l}},Te=async e=>{let t;try{t=JSON.parse(e)}catch(e){return}if(t.id)try{const e=await(async e=>(await(0,ue.s8)()).models.externalMapLayers.get(e))(t.id);return we(e)}catch(e){return t}return t};const Ne=async function(e){let{basemapId:t,keyDefaultBaseMap:a,keyBingMapsApiKey:n,engine:r}=e;const i=await async function(e,t,a){try{let n=[];return((0,fe.isValidUid)(e)||(0,fe.isValidUid)(t))&&(n=(await Pe(a)).filter((e=>"BASEMAP"===e.mapLayerPosition)).map(_e)),X().concat(n)}catch(e){return X()}}(t,a,r),s=i.find((e=>{let{id:a}=e;return a===t}))||i.find((e=>{let{id:t}=e;return t===a}))||K();return"bing"===s.id.substring(0,4)&&(s.config.apiKey=n),{basemap:s}};var Oe=a(44829),Ze=a(93338);const Re={id:"operand",value:"operand",param:"dc",dimensionName:"dx",objectName:"dc",itemType:"DATA_ELEMENT_OPERAND"},xe={id:"organisationUnit",value:"organisationUnit",param:"ou",dimensionName:"ou",objectName:"ou"},Ae=e=>(0,l.sortBy)("le",e).map((e=>{const t=JSON.parse(e.co);let a="",n="",r="Point";if(2===e.ty&&(r="Polygon","[[[["===e.co.substring(0,4)&&(r="MultiPolygon")),(0,l.isString)(e.pg)&&e.pg.length){const t=(0,l.compact)(e.pg.split("/"));t.length>=2&&(a=t[t.length-2]),t.length>2&&(n="/"+t.slice(0,t.length-2).join("/"))}return{type:"Feature",id:e.id,geometry:{type:r,coordinates:t},properties:{type:r,id:e.id,name:e.na,hasCoordinatesDown:e.hcd,hasCoordinatesUp:e.hcu,level:e.le,grandParentParentGraph:n,grandParentId:a,parentGraph:e.pg,parentId:e.pi,parentName:e.pn,dimensions:e.dimensions}}})).filter((e=>{let{geometry:t}=e;return Array.isArray(t.coordinates)&&t.coordinates.length&&t.coordinates.flat().length})),ke=(e,t,a,n)=>({...e,rows:[{dimension:xe.objectName,items:[{id:t,path:`${a}/${t}`},{id:"LEVEL-"+n}]}],isLoaded:!1}),Le=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.resize(),!t){const t=e.getLayersBounds();Array.isArray(t)&&e.fitBounds(t)}e.toggleMultiTouch(!t),e.toggleScrollZoom(t)};var Ie=a(10002),Me=a(17682);const De=()=>({acres:b.Z.t("acres"),Area:b.Z.t("Area"),Cancel:b.Z.t("Cancel"),"Center map on area":b.Z.t("Center map on area"),"Center map on line":b.Z.t("Center map on line"),"Click the next position":b.Z.t("Click the next position"),"Click where you want to start the measurement":b.Z.t("Click where you want to start the measurement"),Delete:b.Z.t("Delete"),Distance:b.Z.t("Distance"),"Enter fullscreen":b.Z.t("Enter fullscreen"),"Exit fullscreen":b.Z.t("Exit fullscreen"),"Finish measurement":b.Z.t("Finish measurement"),ha:b.Z.t("ha"),km:b.Z.t("km"),"Measure distances and areas":b.Z.t("Measure distances and areas"),mi:b.Z.t("mi"),Perimeter:b.Z.t("Perimeter"),"Reset bearing to north":b.Z.t("Reset bearing to north"),"Search for place or address":b.Z.t("Search for place or address"),"Zoom in":b.Z.t("Zoom in"),"Zoom out":b.Z.t("Zoom out"),"Zoom to content":b.Z.t("Zoom to content")}),Fe=e=>{const t=`${{REACT_APP_DHIS2_BASE_URL:"..",REACT_APP_DHIS2_APP_PLUGIN:"true",REACT_APP_DHIS2_APP_NAME:"Maps",REACT_APP_DHIS2_APP_PWA_ENABLED:"true",REACT_APP_DHIS2_APP_PWA_CACHING_OMIT_EXTERNAL_REQUESTS_FROM_APP_SHELL:"false",REACT_APP_DHIS2_APP_PWA_CACHING_OMIT_EXTERNAL_REQUESTS:"false",REACT_APP_DHIS2_APP_PWA_CACHING_PATTERNS_TO_OMIT_FROM_APP_SHELL:'[".*"]',REACT_APP_DHIS2_APP_PWA_CACHING_PATTERNS_TO_OMIT:"[]",REACT_APP_DHIS2_APP_PWA_CACHING_PATTERNS_TO_OMIT_FROM_CACHEABLE_SECTIONS:"[]",PORT:void 0,PUBLIC_URL:".",NODE_ENV:"production"}.DHIS2_BASE_URL}/dhis-web-maps/fonts/{fontstack}/{range}.pbf`,a=document.createElement("div");return a.className="dhis2-map",a.style.width="100%",a.style.height="100%",new Me.ZP(a,{...e,locale:De(),glyphs:t})},Ue=["percentage","hectares","acres"],je=e=>Ue.includes(e),Ge=e=>{const t=(e=>{if(!Array.isArray(e)||!e.length)return null;const{id:t,name:a,year:n,arguments:r}=e[0];return{id:t||r[1],name:a,year:n}})(e);if(!t)return null;const{name:a,year:n}=t;return`${a}${n&&String(n)!==a?` ${n}`:""}`},Be=()=>new Promise((async(e,t)=>{const a=await me("/tokens/google").catch((()=>t(new Error(b.Z.t("Cannot get authorization token for Google Earth Engine.")))));a&&"ERROR"===a.status&&t(new Error(b.Z.t("This layer requires a Google Earth Engine account. Check the DHIS2 documentation for more information."))),e({token_type:"Bearer",...a})}));const Ve=e=>{let{id:t,name:a,year:n}=e;return[{type:"eq",arguments:["system:index",String(t)],name:a,year:n}]},qe=e=>[{layer:Z,datasetId:"WorldPop/GP/100m/pop",name:b.Z.t("Population"),unit:b.Z.t("people per hectare"),description:b.Z.t("Estimated number of people living in an area."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/WorldPop_GP_100m_pop",img:"images/population.png",defaultAggregations:["sum","mean"],periodType:"Yearly",filters:e=>{let{id:t,name:a,year:n}=e;return[{id:t,name:a,type:"eq",arguments:["year",n]}]},mosaic:!0,params:{min:0,max:10,palette:"#fee5d9,#fcbba1,#fc9272,#fb6a4a,#de2d26,#a50f15"},opacity:.9},{layer:Z,datasetId:"WorldPop/GP/100m/pop_age_sex_cons_unadj",name:b.Z.t("Population age groups"),unit:b.Z.t("people per hectare"),description:b.Z.t("Estimated number of people living in an area, grouped by age and gender."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/WorldPop_GP_100m_pop_age_sex_cons_unadj",img:"images/population.png",periodType:"Yearly",defaultAggregations:["sum","mean"],bands:[{id:"M_0",name:b.Z.t("Male 0 - 1 years")},{id:"M_1",name:b.Z.t("Male 1 - 4 years")},{id:"M_5",name:b.Z.t("Male 5 - 9 years")},{id:"M_10",name:b.Z.t("Male 10 - 14 years")},{id:"M_15",name:b.Z.t("Male 15 - 19 years")},{id:"M_20",name:b.Z.t("Male 20 - 24 years")},{id:"M_25",name:b.Z.t("Male 25 - 29 years")},{id:"M_30",name:b.Z.t("Male 30 - 34 years")},{id:"M_35",name:b.Z.t("Male 35 - 39 years")},{id:"M_40",name:b.Z.t("Male 40 - 44 years")},{id:"M_45",name:b.Z.t("Male 45 - 49 years")},{id:"M_50",name:b.Z.t("Male 50 - 54 years")},{id:"M_55",name:b.Z.t("Male 55 - 59 years")},{id:"M_60",name:b.Z.t("Male 60 - 64 years")},{id:"M_65",name:b.Z.t("Male 65 - 69 years")},{id:"M_70",name:b.Z.t("Male 70 - 74 years")},{id:"M_75",name:b.Z.t("Male 75 - 79 years")},{id:"M_80",name:b.Z.t("Male 80 years and above")},{id:"F_0",name:b.Z.t("Female 0 - 1 years")},{id:"F_1",name:b.Z.t("Female 1 - 4 years")},{id:"F_5",name:b.Z.t("Female 5 - 9 years")},{id:"F_10",name:b.Z.t("Female 10 - 14 years")},{id:"F_15",name:b.Z.t("Female 15 - 19 years")},{id:"F_20",name:b.Z.t("Female 20 - 24 years")},{id:"F_25",name:b.Z.t("Female 25 - 29 years")},{id:"F_30",name:b.Z.t("Female 30 - 34 years")},{id:"F_35",name:b.Z.t("Female 35 - 39 years")},{id:"F_40",name:b.Z.t("Female 40 - 44 years")},{id:"F_45",name:b.Z.t("Female 45 - 49 years")},{id:"F_50",name:b.Z.t("Female 50 - 54 years")},{id:"F_55",name:b.Z.t("Female 55 - 59 years")},{id:"F_60",name:b.Z.t("Female 60 - 64 years")},{id:"F_65",name:b.Z.t("Female 65 - 69 years")},{id:"F_70",name:b.Z.t("Female 70 - 74 years"),multiple:!0},{id:"F_75",name:b.Z.t("Female 75 - 79 years")},{id:"F_80",name:b.Z.t("Female 80 years and above")}],filters:e=>{let{id:t,name:a,year:n}=e;return[{id:t,name:a,type:"eq",arguments:["year",n]}]},mosaic:!0,params:{min:0,max:10,palette:"#fee5d9,#fcbba1,#fc9272,#fb6a4a,#de2d26,#a50f15"},opacity:.9,tileScale:4},{layer:Z,datasetId:"GOOGLE/Research/open-buildings/v1/polygons",format:"FeatureCollection",name:b.Z.t("Building footprints"),unit:b.Z.t("Number of buildings"),description:b.Z.t("The outlines of buildings derived from high-resolution satellite imagery. Only for the continent of Africa."),notice:b.Z.t("Building counts are only available for smaller organisation unit areas."),error:b.Z.t("Select a smaller area or single organization unit to see the count of buildings."),source:"NASA / USGS / JPL-Caltech / Google Earth Engine",sourceUrl:"https://sites.research.google/open-buildings/",img:"images/buildings.png",aggregations:["count"],defaultAggregations:["count"],opacity:.9},{layer:Z,datasetId:"USGS/SRTMGL1_003",name:b.Z.t("Elevation"),unit:b.Z.t("meters"),description:b.Z.t("Elevation above sea-level."),source:"NASA / USGS / JPL-Caltech / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/USGS%2FSRTMGL1_003",img:"images/elevation.png",aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],band:"elevation",params:{min:0,max:1500,palette:"#ffffd4,#fee391,#fec44f,#fe9929,#d95f0e,#993404"},opacity:.9},{layer:Z,datasetId:"UCSB-CHG/CHIRPS/PENTAD",name:b.Z.t("Precipitation"),unit:b.Z.t("millimeter"),description:b.Z.t("Precipitation collected from satellite and weather stations on the ground. The values are in millimeters within 5 days periods. Updated monthly, during the 3rd week of the following month."),source:"UCSB / CHG / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/UCSB-CHG%2FCHIRPS%2FPENTAD",periodType:"Custom",band:"precipitation",aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],mask:!0,img:"images/precipitation.png",params:{min:0,max:100,palette:"#eff3ff,#c6dbef,#9ecae1,#6baed6,#3182bd,#08519c"},opacity:.9},{layer:Z,datasetId:"MODIS/006/MOD11A2",name:b.Z.t("Temperature"),unit:b.Z.t("°C during daytime"),description:b.Z.t("Land surface temperatures collected from satellite. Blank spots will appear in areas with a persistent cloud cover."),source:"NASA LP DAAC / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/MODIS%2FMOD11A2",img:"images/temperature.png",aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],periodType:"Custom",band:"LST_Day_1km",mask:!0,methods:{toFloat:[],multiply:[.02],subtract:[273.15]},params:{min:0,max:40,palette:"#fff5f0,#fee0d2,#fcbba1,#fc9272,#fb6a4a,#ef3b2c,#cb181d,#a50f15,#67000d"},opacity:.9},{layer:Z,datasetId:"MODIS/006/MCD12Q1",name:b.Z.t("Landcover"),description:b.Z.t("Distinct landcover types collected from satellites."),source:"NASA LP DAAC / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/MODIS_006_MCD12Q1",periodType:"Yearly",band:"LC_Type1",filters:Ve,defaultAggregations:"percentage",legend:{items:[{id:1,name:b.Z.t("Evergreen Needleleaf forest"),color:"#162103"},{id:2,name:b.Z.t("Evergreen Broadleaf forest"),color:"#235123"},{id:3,name:b.Z.t("Deciduous Needleleaf forest"),color:"#399b38"},{id:4,name:b.Z.t("Deciduous Broadleaf forest"),color:"#38eb38"},{id:5,name:b.Z.t("Mixed forest"),color:"#39723b"},{id:6,name:b.Z.t("Closed shrublands"),color:"#6a2424"},{id:7,name:b.Z.t("Open shrublands"),color:"#c3a55f"},{id:8,name:b.Z.t("Woody savannas"),color:"#b76124"},{id:9,name:b.Z.t("Savannas"),color:"#d99125"},{id:10,name:b.Z.t("Grasslands"),color:"#92af1f"},{id:11,name:b.Z.t("Permanent wetlands"),color:"#10104c"},{id:12,name:b.Z.t("Croplands"),color:"#cdb400"},{id:13,name:b.Z.t("Urban and built-up"),color:"#cc0202"},{id:14,name:b.Z.t("Cropland/Natural vegetation mosaic"),color:"#332808"},{id:15,name:b.Z.t("Snow and ice"),color:"#d7cdcc"},{id:16,name:b.Z.t("Barren or sparsely vegetated"),color:"#f7e174"},{id:17,name:b.Z.t("Water"),color:"#aec3d6"}]},mask:!1,popup:"{name}: {value}",img:"images/landcover.png",opacity:.9},{layer:Z,legacy:!0,datasetId:"WorldPop/POP",name:b.Z.t("Population"),unit:b.Z.t("people per km²"),description:b.Z.t("Estimated number of people living in an area."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/WorldPop%2FPOP",img:"images/population.png",periodType:"Yearly",filters:e=>{let{id:t,name:a,year:n}=e;return[{id:t,name:a,type:"eq",arguments:["year",n]},{type:"eq",arguments:["UNadj","yes"]}]},mosaic:!0,params:{min:0,max:1e3,palette:"#fee5d9,#fcbba1,#fc9272,#fb6a4a,#de2d26,#a50f15"},methods:{multiply:[100]},opacity:.9},{layer:Z,legacy:!0,datasetId:"NOAA/DMSP-OLS/NIGHTTIME_LIGHTS",name:b.Z.t("Nighttime lights"),unit:b.Z.t("light intensity"),description:b.Z.t("Light intensity from cities, towns, and other sites with persistent lighting, including gas flares."),source:"NOAA / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/NOAA%2FDMSP-OLS%2FNIGHTTIME_LIGHTS",periodType:"Yearly",band:"stable_lights",mask:!0,img:"images/nighttime.png",params:{min:0,max:63,palette:"#ffffd4,#fee391,#fec44f,#fe9929,#ec7014,#cc4c02,#8c2d04"},opacity:.9}].find((t=>t.datasetId===e));var $e=a(33933),He=a(97363);const ze=[He.O5,He.fW,He.Nn,He.MA,He.GN,He.P8,He.FJ,He.AP,He.hy],We=()=>[{id:"RELATIVE_PERIODS",name:b.Z.t("Relative")},{id:He.O5,name:b.Z.t("Daily"),group:He.O5},{id:He.fW,name:b.Z.t("Weekly"),group:He.fW},{id:He.At,name:b.Z.t("Weekly (Start Wednesday)"),group:He.fW},{id:He.bk,name:b.Z.t("Weekly (Start Thursday)"),group:He.fW},{id:He.BI,name:b.Z.t("Weekly (Start Saturday)"),group:He.fW},{id:He.Eu,name:b.Z.t("Weekly (Start Sunday)"),group:He.fW},{id:He.Nn,name:b.Z.t("Bi-weekly"),group:He.Nn},{id:He.MA,name:b.Z.t("Monthly"),group:He.MA},{id:He.GN,name:b.Z.t("Bi-monthly"),group:He.GN},{id:He.P8,name:b.Z.t("Quarterly"),group:He.P8},{id:He.FJ,name:b.Z.t("Six-monthly"),group:He.FJ},{id:He.xP,name:b.Z.t("Six-monthly April"),group:He.FJ},{id:He.AP,name:b.Z.t("Yearly"),group:He.AP},{id:He.y9,name:b.Z.t("Financial year (Start November)"),group:He.hy},{id:He.F9,name:b.Z.t("Financial year (Start October)"),group:He.hy},{id:He.tA,name:b.Z.t("Financial year (Start July)"),group:He.hy},{id:He.VG,name:b.Z.t("Financial year (Start April)"),group:He.hy},{id:"START_END_DATES",name:b.Z.t("Start/end dates")}],Ye=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return We().filter((t=>{let{group:a}=t;return!e.includes(a)}))},Je=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return ze.filter((t=>!e.includes(t))).map((e=>(0,$e.CU)(e).getPeriods())).flat()},Qe=(e,t)=>{const a=((e,t)=>t.filter((t=>t.dimension===e))[0])(e,t);return a&&a.items?a.items:[]},Ke=function(){return Qe("dx",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0]},Xe=function(){return Qe("ou",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]},et=function(){return Qe("pe",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0]},tt=e=>({...Ye().reduce(((e,t)=>{let{id:a,name:n}=t;return e[a]=n,e}),{}),...Je().reduce(((e,t)=>{let{id:a,name:n}=t;return e[a]=n,e}),{})}[e]),at=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>(0,fe.isValidUid)(e.dimension)&&e.items&&e.items.length))},nt=(e,t)=>{if(!t.includes(";")){if("IN"===e)return b.Z.t("is");if("!IN"===e)return b.Z.t("is not")}return{EQ:"=",GT:">",GE:">=",LT:"<",LE:"<=",NE:"!=",IN:b.Z.t("one of"),"!IN":b.Z.t("not one of"),LIKE:b.Z.t("contains"),"!LIKE":b.Z.t("doesn't contains")}[e]},rt=(e,t,a)=>{if("IN"===t){if("1"===e)return b.Z.t("true");if("0"===e)return b.Z.t("false")}return e.split(";").map((e=>a[e]||e)).join(", ")},it=e=>{let t;return e>=1e3&&e<9500?t=(e/1e3).toFixed(1)+"k":e>=9500&&e<999500?t=Math.round(e/1e3)+"k":e>=999500&&e<195e4?t=(e/1e6).toFixed(1)+"M":e>195e4&&(t=Math.round(e/1e6)+"M"),t||e},st=e=>{if(void 0===e)return e=>e;const t=Math.pow(10,e);return e=>Math.round(e*t)/t},ot=["#1f78b4","#ff7f00","#33a02c","#a6cee3","#b2df8a","#fb9a99","#fdbf6f","#cab2d6","#ffff99","#b15928","#6a3d9a","#e31a1c"];var dt=a(9184);const lt={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]},YlOrBr_reverse:{3:["#d95f0e","#fec44f","#fff7bc"],4:["#cc4c02","#fe9929","#fed98e","#ffffd4"],5:["#993404","#d95f0e","#fe9929","#fed98e","#ffffd4"],6:["#993404","#d95f0e","#fe9929","#fec44f","#fee391","#ffffd4"],7:["#8c2d04","#cc4c02","#ec7014","#fe9929","#fec44f","#fee391","#ffffd4"],8:["#8c2d04","#cc4c02","#ec7014","#fe9929","#fec44f","#fee391","#fff7bc","#ffffe5"],9:["#662506","#993404","#cc4c02","#ec7014","#fe9929","#fec44f","#fee391","#fff7bc","#ffffe5"]},Reds_reverse:{3:["#de2d26","#fc9272","#fee0d2"],4:["#cb181d","#fb6a4a","#fcae91","#fee5d9"],5:["#a50f15","#de2d26","#fb6a4a","#fcae91","#fee5d9"],6:["#a50f15","#de2d26","#fb6a4a","#fc9272","#fcbba1","#fee5d9"],7:["#99000d","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee5d9"],8:["#99000d","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee0d2","#fff5f0"],9:["#67000d","#a50f15","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee0d2","#fff5f0"]},YlGn_reverse:{3:["#31a354","#addd8e","#f7fcb9"],4:["#238443","#78c679","#c2e699","#ffffcc"],5:["#006837","#31a354","#78c679","#c2e699","#ffffcc"],6:["#006837","#31a354","#78c679","#addd8e","#d9f0a3","#ffffcc"],7:["#005a32","#238443","#41ab5d","#78c679","#addd8e","#d9f0a3","#ffffcc"],8:["#005a32","#238443","#41ab5d","#78c679","#addd8e","#d9f0a3","#f7fcb9","#ffffe5"],9:["#004529","#006837","#238443","#41ab5d","#78c679","#addd8e","#d9f0a3","#f7fcb9","#ffffe5"]},Greens_reverse:{3:["#31a354","#a1d99b","#e5f5e0"],4:["#238b45","#74c476","#bae4b3","#edf8e9"],5:["#006d2c","#31a354","#74c476","#bae4b3","#edf8e9"],6:["#006d2c","#31a354","#74c476","#a1d99b","#c7e9c0","#edf8e9"],7:["#005a32","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#edf8e9"],8:["#005a32","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#e5f5e0","#f7fcf5"],9:["#00441b","#006d2c","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#e5f5e0","#f7fcf5"]},Blues_reverse:{3:["#3182bd","#9ecae1","#deebf7"],4:["#2171b5","#6baed6","#bdd7e7","#eff3ff"],5:["#08519c","#3182bd","#6baed6","#bdd7e7","#eff3ff"],6:["#08519c","#3182bd","#6baed6","#9ecae1","#c6dbef","#eff3ff"],7:["#084594","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#eff3ff"],8:["#084594","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#deebf7","#f7fbff"],9:["#08306b","#08519c","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#deebf7","#f7fbff"]},BuPu_reverse:{3:["#8856a7","#9ebcda","#e0ecf4"],4:["#88419d","#8c96c6","#b3cde3","#edf8fb"],5:["#810f7c","#8856a7","#8c96c6","#b3cde3","#edf8fb"],6:["#810f7c","#8856a7","#8c96c6","#9ebcda","#bfd3e6","#edf8fb"],7:["#6e016b","#88419d","#8c6bb1","#8c96c6","#9ebcda","#bfd3e6","#edf8fb"],8:["#6e016b","#88419d","#8c6bb1","#8c96c6","#9ebcda","#bfd3e6","#e0ecf4","#f7fcfd"],9:["#4d004b","#810f7c","#88419d","#8c6bb1","#8c96c6","#9ebcda","#bfd3e6","#e0ecf4","#f7fcfd"]},RdPu_reverse:{3:["#c51b8a","#fa9fb5","#fde0dd"],4:["#ae017e","#f768a1","#fbb4b9","#feebe2"],5:["#7a0177","#c51b8a","#f768a1","#fbb4b9","#feebe2"],6:["#7a0177","#c51b8a","#f768a1","#fa9fb5","#fcc5c0","#feebe2"],7:["#7a0177","#ae017e","#dd3497","#f768a1","#fa9fb5","#fcc5c0","#feebe2"],8:["#7a0177","#ae017e","#dd3497","#f768a1","#fa9fb5","#fcc5c0","#fde0dd","#fff7f3"],9:["#49006a","#7a0177","#ae017e","#dd3497","#f768a1","#fa9fb5","#fcc5c0","#fde0dd","#fff7f3"]},PuRd_reverse:{3:["#dd1c77","#c994c7","#e7e1ef"],4:["#ce1256","#df65b0","#d7b5d8","#f1eef6"],5:["#980043","#dd1c77","#df65b0","#d7b5d8","#f1eef6"],6:["#980043","#dd1c77","#df65b0","#c994c7","#d4b9da","#f1eef6"],7:["#91003f","#ce1256","#e7298a","#df65b0","#c994c7","#d4b9da","#f1eef6"],8:["#91003f","#ce1256","#e7298a","#df65b0","#c994c7","#d4b9da","#e7e1ef","#f7f4f9"],9:["#67001f","#980043","#ce1256","#e7298a","#df65b0","#c994c7","#d4b9da","#e7e1ef","#f7f4f9"]},Greys_reverse:{3:["#636363","#bdbdbd","#f0f0f0"],4:["#525252","#969696","#cccccc","#f7f7f7"],5:["#252525","#636363","#969696","#cccccc","#f7f7f7"],6:["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#f7f7f7"],7:["#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f7f7f7"],8:["#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f0f0f0","#ffffff"],9:["#000000","#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f0f0f0","#ffffff"]}},ct=["YlOrBr","Reds","YlGn","Greens","Blues","BuPu","RdPu","PuRd","Greys","YlOrBr_reverse","Reds_reverse","YlGn_reverse","Greens_reverse","Blues_reverse","BuPu_reverse","RdPu_reverse","PuRd_reverse","Greys_reverse","PuOr","BrBG","PRGn","PiYG","RdBu","RdGy","RdYlBu","Spectral","RdYlGn","Paired","Pastel1","Set1","Set3"],ft=(e,t)=>lt[e][t].join(","),ut=5,pt=ft("YlOrBr",ut),mt=e=>(0,l.isString)(e)?"##normal"===e?null:(/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e)?"#":"")+e:e,bt=e=>{const t=[...e];function a(){const e="#000000".replace(/0/g,(()=>(~~(16*Math.random())).toString(16)));return t.includes(e)?a():(t.push(e),e)}return e=>t[e]||a()},gt=e=>(0,dt.Uc)(e).l<70,yt=e=>gt(e)?"#fff":"#000",ht=e=>{let{organisationUnitGroups:t}=e;t.sort(((e,t)=>e.name.localeCompare(t.name)));const a=(e=>{const t=e.filter((e=>!e.color)),a=bt(ot);return e=>{const n=t.findIndex((t=>t.id===e.id));return a(n)}})(t),n=(e=>{const t=e.filter((e=>!e.symbol));return e=>{const a=t.findIndex((t=>t.id===e.id));return a<5?`${21+a}.png`:"25.png"}})(t);return t.map((e=>({...e,color:e.color||a(e),symbol:e.symbol||n(e)})))},Et=e=>me(`/organisationUnitGroupSets/${e}?fields=organisationUnitGroups[id,name,color,symbol]`).then(ht),vt=e=>e.filter((e=>1===e.ty)),Ct=e=>e.filter((e=>2===e.ty)),Pt=(e,t)=>t&&t.organisationUnitGroups&&e&&e[t.id]?t.organisationUnitGroups.find((a=>a.id===e[t.id])):{},St=function(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((a=>{let{name:n,color:r=!0,symbol:i}=a;return e?{name:n,color:r}:{name:n,image:`${t}/images/orgunitgroup/${i}`}}))},_t=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{organisationUnitColor:a=B,radiusLow:n=V}=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const{name:s,styleType:o=(i?H:z),organisationUnitGroups:d=[]}=t,c=!i;let f,u=[];if(!c){const t=(0,l.uniqBy)((e=>e.properties.level),e).map((e=>e.properties.level)).sort();f=e=>Math.pow(t.length-t.indexOf(e),1.2),u=t.map((e=>({name:i[e],color:a,weight:f(e)})))}const p=o===H;let m=e.map((e=>{const a="Point"===e.geometry.type,{hasAdditionalGeometry:i}=e.properties,{color:s,symbol:o}=Pt(e.properties.dimensions,t);let d;a&&(d=i?q+1:n);const l={...e.properties,radius:d};return p&&s?l.color=i?B:s:o&&(l.iconUrl=`${r}/images/orgunitgroup/${o}`),l.level&&f&&(l.weight=f(e.properties.level)),{...e,properties:l}}));c&&t.id&&!p&&(m=m.filter((e=>e.properties.iconUrl)));const g=St(d,p,r),y=c&&!t.id?[{name:b.Z.t("Facility"),color:a,radius:n}]:[];return{styledFeatures:m,legend:{unit:s,items:[...u,...g,...y]}}},wt=async e=>{const t=await e.models.organisationUnitLevels.list({fields:"id,displayName~rename(name),level",paging:!1});return t?t.toArray().reduce(((e,t)=>({...e,[t.level]:t.name})),{}):{}},Tt=e=>{let{orgUnitField:t,orgUnitFieldDisplayName:a}=e;return t&&"none"!==t?{id:t,name:a}:null},Nt=(e,t)=>t?e.filter((e=>{const a=t.find((t=>t.id===e.id));return"Point"===e.geometry.type&&(!a||"Point"!==a.geometry.type)})).map((e=>t.find((t=>t.id===e.id))?{...e,properties:{...e.properties,hasAdditionalGeometry:!0}}:e)).concat(t):e,Ot=e=>{let{min:t,max:a,palette:n}=e;const r=n.split(","),i=(a-t)/(r.length-(t>0?2:1)),s=(0,Ie.Z)(i,a),o=st(s);let d=t,l=o(t+i);return r.map(((e,n)=>{const r={color:e};return 0===n&&t>0?(r.from=0,r.to=t,r.name="< "+t,l=t):d<a?(r.from=d,r.to=l,r.name=d+" - "+l):(r.from=d,r.name="> "+d),d=l,l=o(t+i*(n+(t>0?1:2))),r}))},Zt=async e=>{const{rows:t,aggregationType:a}=e,n=Xe(t),r=Tt(e),i=[];let s,o,d={};if(n&&n.length){const e=await(0,ue.s8)(),t=ge(e).toUpperCase(),a=n.map((e=>e.id));let s,d;const l=e.geoFeatures.byOrgUnit(a).displayProperty(t);try{s=await l.getAll().then(Ae),r&&(d=await l.getAll({coordinateField:r.id}).then(Ae),d.length||i.push({warning:!0,message:b.Z.t("{{name}}: No coordinates found",{name:r.name,nsSeparator:";"})})),o=Nt(s,d),o.length||i.push({warning:!0,message:b.Z.t("Selected org units: No coordinates found",{nsSeparator:";"})})}catch(e){i.push({critical:!0,message:b.Z.t("Error: {{message}}",{message:e.message,nsSeparator:";"})})}}if("string"==typeof e.config){if(d=JSON.parse(e.config),"MODIS/MOD11A2"===d.id&&d.filter){const e=d.image.slice(-10);d.id="MODIS/006/MOD11A2",d.image=e,d.filter[0].arguments[1]=e}if(d.image){var l;const e=null===(l=d.filter)||void 0===l?void 0:l[0];if(e){var c;const t=null===(c=e.arguments)||void 0===c?void 0:c[1];let a=String(d.image);if("string"==typeof t&&t.length>4){const n=t.substring(0,4);e.year=parseInt(n,10),a.slice(-4)===n&&(a=a.slice(0,-4))}e.name=a}}s=qe(d.id),s&&(s.datasetId=d.id,delete d.id),delete e.config}else s=qe(d.id);const f={...s,...e,...d},{unit:u,filter:p,description:m,source:g,sourceUrl:y,band:h,bands:E}=f,{name:v}=s||e,C=Ge(p),P=Array.isArray(o)&&o.length?o:void 0,S=h&&Array.isArray(E)&&E.length?E.filter((e=>Array.isArray(h)?h.includes(e.id):h===e.id)):null,_={...f.legend,title:v,period:C,groups:S,unit:u,description:m,source:g,sourceUrl:y};return!je(a)&&f.params&&(_.items=Ot(f.params)),{...f,legend:_,name:v,data:P,alerts:i,isLoaded:!0,isExpanded:!0,isVisible:!0}},Rt=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{Zt(t).then(a)}),[t,a]),null};Rt.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const xt=Rt,At="COMPLETED";var kt=a(1051),Lt=a.n(kt);const It="psi",Mt=(e,t,a,n,r,i)=>{const s=i(n),o=n.reduce(((n,i,o)=>{const d=e[o];let l;return d.optionSet&&(l=a.find((e=>e.code===i))),{id:r,type:s.type,...n,[t[d.name]||d.name]:l?l.name:i}}),{});return{type:"Feature",id:r,properties:o,geometry:s}},Dt=(e,t)=>{if(t){const a=Lt()(e,(e=>e.name===t));return e=>{let t=e[a];if("string"==typeof t&&t.length)try{t=JSON.parse(t)}catch(e){return null}return Array.isArray(t)&&(n=t,Array.isArray(n)&&2===n.length&&n[0]>=-180&&n[0]<=180&&n[1]>=-90&&n[1]<=90)?{type:"Point",coordinates:t}:null;var n}}{const t=Lt()(e,(e=>"geometry"===e.name));return e=>JSON.parse(e[t])}},Ft=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={...e.headers.reduce(((e,t)=>({...e,[t.name]:t.column})),{}),...t.columnNames},n=t.idCol||It,r=Lt()(e.headers,(e=>e.name===n)),i=Dt(e.headers,t&&t.eventCoordinateField),s=Object.values(e.metaData.items),o=e.rows.map((n=>Mt(e.headers,"ID"!==t.outputIdScheme?a:{},s,n,n[r],i)));return o.sort((e=>"Polygon"===e.geometry.type?-1:0)),{data:o,names:a}},Ut=e=>{let{dimension:t,filter:a,items:n}=e;return Boolean(t&&(a||!n||n.length))},jt="name",Gt=async(e,t)=>{let{program:a,programStage:n,filters:r,startDate:i,endDate:s,rows:o,columns:d,styleDataItem:l,eventStatus:c,eventCoordinateField:f,relativePeriodDate:u,isExtended:p}=e,{d2:m,nameProperty:b}=t;const g=Xe(o),y=et(r),h=((e,t)=>t&&!e.find((e=>e.dimension===t.id))?[...e,{dimension:t.id,name:t.name}]:[...e])(d.filter(Ut),l);if(p){const e=await(async(e,t)=>{let{format:a=jt,nameProperty:n,d2:r}=t;const i="name"===n?"displayName":"displayShortName";return(await r.models.programStage.get(e.programStage.id,{fields:`programStageDataElements[displayInReports,dataElement[id,code,${i}~rename(name),optionSet]]`,paging:!1})).programStageDataElements.filter((e=>e.displayInReports)).map((e=>({dimension:e.dataElement.id,name:e.dataElement[a]})))})({programStage:n},{d2:m,nameProperty:b});e.forEach((e=>{h.find((t=>t.dimension===e.dimension))||h.push(e)}))}let E=(new m.analytics.request).withProgram(a.id).withStage(n.id).withCoordinatesOnly(!0);return E=y?E.addPeriodFilter(y.id):E.withStartDate(i).withEndDate(s),u&&(E=E.withRelativePeriodDate(u)),E=E.addOrgUnitDimension(g.map((e=>e.id))),h&&h.forEach((e=>{E=E.addDimension(e.dimension,e.filter)})),f&&(E=E.addDimension(f).withCoordinateField(f)),c&&"ALL"!==c&&(E=E.withEventStatus(c)),E},Bt=["AGE","INTEGER","INTEGER_NEGATIVE","INTEGER_POSITIVE","INTEGER_ZERO_OR_POSITIVE","NUMBER","PERCENTAGE","UNIT_INTERVAL"],Vt=(e,t)=>e.find(((a,n)=>t>=a.startValue&&(t<a.endValue||(t=>t===e.length-1)(n)&&t==a.endValue))),qt=(e,t,a)=>{const n=e[0],r=e[e.length-1];let i;return t===$?i=$t(n,r,a):3===t&&(i=Ht(e,a)),i},$t=(e,t,a)=>{const n=[],r=(t-e)/a,i=(0,Ie.Z)(r,t),s=st(i);for(let i=0;i<a;i++){const o=e+i*r,d=i<a-1?o+r:t;n.push({startValue:s(o),endValue:s(d)})}return n},Ht=(e,t)=>{const a=e[0],n=e[e.length-1],r=[],i=e.length/t,s=(0,Ie.Z)((n-a)/t,n),o=st(s);let d=0===i?0:i;if(e.length>0){r[0]=a;for(let a=1;a<t;a++)r[a]=e[Math.round(d)],d+=i}return r.filter((e=>void 0!==e)).map(((e,t)=>({startValue:o(e),endValue:o(r[t+1]||n)})))},zt=async e=>(await(0,ue.s8)()).models.legendSet.get(e.id),Wt=e=>{const t=(0,l.pick)(["name","startValue","endValue","color"]);return(0,l.sortBy)("startValue",e.legends).map(t).map((e=>e.name===`${e.startValue} - ${e.endValue}`?{...e,name:""}:e))},Yt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ut,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:pt;const r=e.length?qt(e,t,a):[],i=n.split(",");return r.map(((e,t)=>({...e,color:i[t]})))},Jt=async e=>{const{styleDataItem:t,data:a,legend:n,eventPointRadius:r}=e,{id:i,name:s,values:o}=t;return e.data=a.map((e=>{const t=e.properties[i]||"0";return t?{...e,properties:{...e.properties,value:"1"===t?b.Z.t("Yes"):b.Z.t("No"),color:"1"===t?o.true:o.false}}:e})),n.unit=s||await ea(i),n.items=[{name:b.Z.t("Yes"),color:o.true,radius:r||6}],o.false&&n.items.push({name:b.Z.t("No"),color:o.false,radius:r||6}),e},Qt=async e=>{const{styleDataItem:t,method:a,classes:n,colorScale:r,eventPointRadius:i,data:s}=e;if(1===a){const t=await zt(e.legendSet);e.legend.unit=t.name,e.legend.items=Wt(t)}else{const i=s.map((e=>Number(e.properties[t.id]))).sort(((e,t)=>e-t));e.legend.unit=t.name||await ea(t.id),e.legend.items=Yt(i,a,n,r)}e.legend.items.forEach((e=>{e.radius=i||6,e.count=0}));const o=(0,l.curry)(Vt)(e.legend.items);return e.data=e.data.map((e=>{const a=Number(e.properties[t.id]),n=o(a);return n&&n.count++,{...e,properties:{...e.properties,value:a,color:n?n.color:null}}})),e},Kt=async e=>{const{styleDataItem:t}=e,a=await Xt(t.optionSet),n=t.id;e.styleDataItem={...t,name:a.name,optionSet:a};const r=a.options.reduce(((e,t)=>(e[t.name.toLowerCase()]=t,e)),{});return e.data=e.data.map((e=>{const t=e.properties[n];if(t){const a=r[t.toLowerCase()];if(a)return{...e,properties:{...e.properties,value:a.name,color:a.style.color}}}return e})),e.legend.unit=a.name,e.legend.items=a.options.map((t=>({name:t.name,color:t.style.color,radius:e.eventPointRadius||6}))),e},Xt=async e=>{if(e.name)return e;const t=await(0,ue.s8)(),a=await t.models.optionSet.get(e.id,{fields:"displayName~rename(name),options[id,code,displayName~rename(name)]"});return{...e,name:a.name,options:e.options.map((e=>({...a.options.find((t=>t.id===e.id)),...e})))}},ea=async e=>(await(0,ue.s8)()).models.dataElement.get(e,{fields:"displayName~rename(name)"}).then((e=>e.name)),ta={warning:!0,message:b.Z.t("You don't have access to this layer data")},aa={critical:!0,message:b.Z.t("An unknown error occurred while reading layer data")},na=async e=>{const{columns:t,endDate:a,eventStatus:n,eventClustering:r,eventPointColor:i,eventPointRadius:s,filters:o,programStage:d,startDate:l,styleDataItem:c,areaRadius:f,showDataTable:u}=e,p=et(o),m=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>e.filter));return e.length?e:null}(t),g=await(0,ue.s8)(),y=g.system.systemInfo.databaseInfo.spatialSupport;e.isExtended=u;const h=await Gt(e,{d2:g,nameProperty:g.currentUser.settings.keyAnalysisDisplayProperty});let E;if(e.name=d.name,e.legend={title:e.name,period:p?tt(p.id):S(_(l),_(a)),items:[]},delete e.serverCluster,y&&r&&!c){const t=await ra(h);e.bounds=(e=>{if(!e)return null;const t=e.match(/([-\d.]+)/g);return[[t[0],t[1]],[t[2],t[3]]]})(t.extent),e.serverCluster=t.count>2e3}if(!e.serverCluster){e.outputIdScheme="ID";const{names:t,data:a,response:n}=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const n=await a.analytics.events.getQuery(e.withPageSize(D)),{data:r,names:i}=Ft(n,t);return{data:r,names:i,response:n}}(h,e,g),{total:r}=n.metaData.pager;e.data=a,Array.isArray(e.data)&&e.data.length?(c&&await(async e=>{const{styleDataItem:t}=e;return t.optionSet?await Kt(e):Bt.includes(t.valueType)?await Qt(e):"BOOLEAN"===t.valueType&&await Jt(e),e.legend.items.push({name:b.Z.t("Not set"),color:mt(e.eventPointColor)||F,radius:e.eventPointRadius||6}),e})(e),r>D&&(E={warning:!0,message:`${e.name}: ${b.Z.t("Displaying first {{pageSize}} events out of {{total}}",{pageSize:D,total:r})}`})):E={warning:!0,message:`${e.name}: ${b.Z.t("No data found")}`},e.legend.filters=m&&function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((t=>{let{dimension:a,filter:n}=t;const[r,i]=n.split(":");return`${e[a]} ${nt(r,i)} ${rt(i,r,e)}`}))}(m,{...t,...await ia(m,n.headers)}),e.headers=n.headers}if(!c){const t=mt(i)||F,a=yt(t);e.legend.items=[{name:b.Z.t("Event"),color:t,strokeColor:a,radius:s||6}]}const v=[];n&&v.push(`${b.Z.t("Event status")}: ${[{id:"ALL",name:b.Z.t("All")},{id:"ACTIVE",name:b.Z.t("Active")},{id:At,name:b.Z.t("Completed")}].find((e=>e.id===n)).name}`),f&&v.push(`${b.Z.t("Buffer")}: ${f} m`),v.length&&(e.legend.explanation=v),E&&(e.alerts=[E])},ra=async e=>{const t=await(0,ue.s8)();return await t.analytics.events.getCount(e)},ia=async(e,t)=>{const a=await(0,ue.s8)();if(!e)return null;const n=e.map((e=>t.find((t=>t.name===e.dimension)))).filter((e=>e.optionSet)).map((e=>e.optionSet));if(!n.length)return;return(await Promise.all(n.map((e=>a.models.optionSets.get(e,{fields:"options[code,displayName~rename(name)]"}).then((e=>e.options)).then((e=>e.reduce(((e,t)=>{let{code:a,name:n}=t;return e[a]=n,e}),{}))))))).reduce(((e,t)=>({...e,...t})),{})},sa=async e=>{const t={...e};try{await na(t)}catch(e){403===e.httpStatusCode||409===e.httpStatusCode?t.alerts=[ta]:t.alerts=[aa]}return t.isLoaded=!0,t.isExpanded=!0,t.isVisible=!0,t},oa=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{sa(t).then(a)}),[t,a]),null};oa.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const da=oa,la=async e=>{let{config:t}=e;"string"==typeof t?t=await Te(t):delete e.id;const{name:a,legendSet:n,legendSetUrl:r}=t,i={title:a};if(n){const e=await zt(n);i.items=Wt(e)}return r&&(i.url=r),{...e,layer:O,name:a,legend:i,config:t,isLoaded:!0,isExpanded:!0,isVisible:!0}},ca=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{la(t).then(a)}),[t,a]),null};ca.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const fa=ca,ua=async e=>{const{rows:t,organisationUnitGroupSet:a,areaRadius:n}=e,r=Xe(t),i=!!a,s=Tt(e),o=[],d=r.map((e=>e.id));let l;const c=await(0,ue.s8)(),f=ge(c).toUpperCase(),{contextPath:u}=c.system.systemInfo,p=b.Z.t("Facilities"),m=c.geoFeatures.byOrgUnit(d).displayProperty(f),g=[m.getAll({includeGroupSets:i}).then(vt).then(Ae).catch((e=>{e&&e.message&&o.push({critical:!0,message:b.Z.t("Error: {{message}}",{message:e.message,nsSeparator:";"})})}))];i&&!a.organisationUnitGroups&&g.push(Et(a.id));const[y,h]=await Promise.all(g);h&&(a.organisationUnitGroups=h);const{styledFeatures:E,legend:v}=_t(y,a,e,u);return v.title=p,s&&(l=await m.getAll({coordinateField:s.id,includeGroupSets:i}).then(Ct).then(Ae),l.length||o.push({warning:!0,message:b.Z.t("{{name}}: No coordinates found",{name:s.name,nsSeparator:";"})}),v.items.push({name:s.name,type:"polygon",strokeColor:"#333",fillColor:"rgba(149, 200, 251, 0.5)",weight:.5})),n&&(v.explanation=[`${n} m buffer`]),E.length||o.push({warning:!0,message:b.Z.t("Facilities: No coordinates found",{nsSeparator:";"})}),{...e,data:E,associatedGeometries:l,name:p,legend:v,alerts:o,isLoaded:!0,isExpanded:!0,isVisible:!0}},pa=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{ua(t).then(a)}),[t,a]),null};pa.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const ma=pa,ba=async e=>{const{rows:t,organisationUnitGroupSet:a}=e,n=Xe(t).map((e=>e.id)),r=!!a,i=Tt(e),s=await(0,ue.s8)(),o=ge(s).toUpperCase(),{contextPath:d}=s.system.systemInfo,l=b.Z.t("Organisation units"),c=[],f=s.geoFeatures.byOrgUnit(n).displayProperty(o);let u;const p=[f.getAll({includeGroupSets:r}).then(Ae).catch((e=>{e&&e.message&&c.push({critical:!0,message:b.Z.t("Error: {{message}}",{message:e.message,nsSeparator:";"})})})),wt(s)];r&&!a.organisationUnitGroups&&p.push(Et(a.id));const[m=[],g,y]=await Promise.all(p);m.length||c.length||c.push({warning:!0,message:b.Z.t("Selected org units: No coordinates found",{nsSeparator:";"})}),y&&(a.organisationUnitGroups=y),i&&(u=await f.getAll({coordinateField:i.id,includeGroupSets:r}).then(Ae),u.length||c.push({warning:!0,message:b.Z.t("{{name}}: No coordinates found",{name:i.name,nsSeparator:";"})}));const h=Nt(m,u),{styledFeatures:E,legend:v}=_t(h,a,e,d,g);return v.title=l,{...e,data:E,name:l,legend:v,alerts:c,isLoaded:!0,isExpanded:!0,isVisible:!0}},ga=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{ba(t).then(a)}),[t,a]),null};ga.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const ya=ga;var ha=a(77527);const Ea=e=>{let{dimensions:t,items:a}=e;return t.pe.map((e=>{const{name:t,startDate:n,endDate:r}=a[e],i=new Date(r);return i.setHours(24),{id:e,name:t,startDate:new Date(n),endDate:i}}))},va=e=>{const{headers:t,rows:a}=e,n=(0,l.findIndex)(["name","pe"],t),r=(0,l.findIndex)(["name","ou"],t),i=(0,l.findIndex)(["name","value"],t);return a.reduce(((e,t)=>{const a=t[n];return(e[a]=e[a]||{})[t[r]]={value:t[i]},e}),{})},Ca=e=>{const{headers:t,rows:a}=e,n=(0,l.findIndex)(["name","ou"],t),r=(0,l.findIndex)(["name","value"],t);return a.reduce(((e,t)=>(e[t[n]]=parseFloat(t[r]),e)),{})},Pa=e=>{const{headers:t,rows:a}=e,n=(0,l.findIndex)(["name","value"],t);return a.map((e=>parseFloat(e[n]))).sort(((e,t)=>e-t))},Sa=async e=>{const{rows:t,columns:a,filters:n,displayProperty:r,startDate:i,endDate:s,userOrgUnit:o,valueType:d,relativePeriodDate:l,aggregationType:c,renderingStrategy:f=x,eventStatus:u}=e,p=Xe(t),m=et(n),b=at(e.filters),g=Ke(a),y=Tt(e),h=a[0].dimension===Re.objectName,E=f===x,v=await(0,ue.s8)(),C=ge(v,r).toUpperCase(),P={},S=p.map((e=>e.id));let _=h?g.id.split(".")[0]:g.id;"ds"===d&&(_+=".REPORTING_RATE");let w=(new v.analytics.request).addOrgUnitDimension(p.map((e=>e.id))).addDataDimension(_).withDisplayProperty(C);w=E?m?w.addPeriodFilter(m.id):w.withStartDate(i).withEndDate(s):w.addPeriodDimension(m.id),b&&b.forEach((e=>w=w.addFilter(e.dimension,e.items.map((e=>e.id))))),Array.isArray(o)&&o.length&&(P.userOrgUnit=o.join(";"),w=w.withUserOrgUnit(o)),l&&(w=w.withRelativePeriodDate(l)),c&&(w=w.withAggregationType(c)),h&&(w=w.addDimension("co")),u===At&&(w=w.withParameters({completedOnly:!0}));const T=v.geoFeatures.byOrgUnit(S).displayProperty(C),N=[T.getAll(P).then(Ae),v.analytics.aggregate.get(w)];return y&&N.push(T.getAll({...P,coordinateField:y.id}).then(Ae)),Promise.all(N)},_a=async e=>{const{columns:t,radiusLow:a=I,radiusHigh:n=M,classes:r,colorScale:i,renderingStrategy:s=x,thematicMapType:o,noDataColor:d}=e,c=Ke(t),f=Tt(e);let u;const p=await Sa(e).catch((e=>{u=e}));if(!p)return{...e,...u?{alerts:[{critical:!0,message:`${b.Z.t("Error")}: ${u.message||u}`}]}:{},name:c?c.name:b.Z.t("Thematic layer"),data:[],legend:null,isLoaded:!0,isVisible:!0};const[m,g,y]=p,h=Nt(m,y),E=s===x,v=o===L,C=10===e.method,P=et(e.filters),w=Ea(g.metaData),T=at(e.filters),N=(e=>{let{metaData:t,headers:a}=e;return{...Object.keys(t.items).reduce(((e,a)=>({...e,[a]:t.items[a].name})),{}),...a.reduce(((e,t)=>({...e,[t.name]:t.column})),{}),true:b.Z.t("Yes"),false:b.Z.t("No")}})(g),O=E?null:va(g),Z=Ca(g),R=d?h:h.filter((e=>{let{id:t}=e;return void 0!==Z[t]})),A=Pa(g);let k=A[0],D=A[A.length-1];const F=N[c.id],U=[];let j=e.legendSet;j||!c.legendSet||void 0!==e.method&&1!==e.method||(j=c.legendSet);const G=j?1:e.method;j&&(j=await zt(j));let V=[];C||(V=j?Wt(j):Yt(A,G,r,i));const $={title:F,period:P?N[P.id]||P.id:S(_(e.startDate),_(e.endDate)),items:V};T&&T.length&&($.filters=T.map((e=>`${N[e.dimension]}: ${e.items.map((e=>N[e.id])).join(", ")}`))),E&&$.items.forEach((e=>e.count=0)),v&&($.bubbles={radiusLow:a,radiusHigh:n,color:C?i:null});const H=(0,l.curry)(Vt)($.items);j&&Array.isArray($.items)&&$.items.length>=2&&(k=$.items[0].startValue,D=$.items[$.items.length-1].endValue);const z=(0,ha._b)().range([a,n]).domain([k,D]).clamp(!0);if(R.length||(h.length?U.push({warning:!0,message:`${F}: ${b.Z.t("No data found")}`}):U.push({warning:!0,message:b.Z.t("Selected org units: No coordinates found",{nsSeparator:";"})})),f&&!y.length&&U.push({warning:!0,message:b.Z.t("{{name}}: No coordinates found",{name:f.name,nsSeparator:";"})}),O){Object.keys(O).forEach((e=>{Object.keys(O[e]).forEach((t=>{const a=O[e][t],n=Number(a.value),r=H(n);a.color=C?i:r?r.color:"#CCCCCC",a.radius=z(n)}))}))}else R.forEach((e=>{let{id:t,geometry:a,properties:n}=e;const r=Z[t],s=H(r),o="Point"===a.type,{hasAdditionalGeometry:d}=n;C?n.color=i:s&&(d||s.count++,n.color=d&&o?B:s.color,n.legend=s.name,n.range=`${s.startValue} - ${s.endValue}`),n.value=r,n.radius=d?q:z(r)}));return d&&Array.isArray($.items)&&!v&&$.items.push({color:d,name:b.Z.t("No data")}),{...e,data:R,periods:w,valuesByPeriod:O,name:F,legend:$,method:G,alerts:U,isLoaded:!0,isExpanded:!0,isVisible:!0}},wa=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{_a(t).then(a)}),[t,a]),null};wa.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const Ta=wa,Na="TRACKED_ENTITY_INSTANCE",Oa=e=>e.trackedEntityInstance.trackedEntityInstance,Za=(e,t,a,n,r)=>{const i=t.relationships.filter((e=>((e,t,a)=>e.relationshipType===t&&Oa(e.from)===a)(e,n,t.id)));i.forEach((i=>{const s=i.relationship;if(e[s])return;const o=a[Oa(i.to)];o&&(e[s]={id:s,from:t,to:o},r&&Za(e,o,a,n,!0))}))},Ra=["trackedEntityInstance~rename(id)","featureType","coordinates","relationships"],xa=async(e,t,a)=>{let{orgUnits:n,organisationUnitSelectionMode:r}=a;const i=t.fromConstraint,s=t.toConstraint;if(i.relationshipEntity!==Na||s.relationshipEntity!==Na)return[];const o=i.trackedEntityType.id===s.trackedEntityType.id,d=(l=o?e:await(async e=>{let{type:t,orgUnits:a,fields:n,organisationUnitSelectionMode:r}=e,i=`/trackedEntityInstances?skipPaging=true&fields=${n}&ou=${a}`;return r&&(i+=`&ouMode=${r}`),i+=`&trackedEntityType=${t.id}`,(await me(i)).trackedEntityInstances})({type:s.trackedEntityType,fields:Ra,orgUnits:n,organisationUnitSelectionMode:r}),l.filter((e=>!!e.coordinates)).reduce(((e,t)=>(e[t.id]=t,e)),{}));var l;const c=o?e.filter((e=>((e,t)=>{let a=!1;for(let n=0;n<e.relationships.length;++n){const r=e.relationships[n];if(r.relationshipType===t){if(Oa(r.to)===e.id)return!1;Oa(r.from)===e.id&&(a=!0)}}return a})(e,t.id))):e,f={};return c.forEach((e=>Za(f,e,d,t.id,o))),c.forEach((e=>{delete d[e.id]})),{primary:c,relationships:Object.values(f),secondary:Object.values(d)}},Aa=["trackedEntityInstance~rename(id)","featureType","coordinates"],ka={POINT:"Point",POLYGON:"Polygon",MULTI_POLYGON:"MultiPolygon"},La=Object.keys(ka),Ia=e=>e.map((e=>{let{id:t,featureType:a,coordinates:n}=e;return{type:"Feature",geometry:{type:ka[a],coordinates:JSON.parse(n)},properties:{id:t}}})),Ma=async e=>{if(e.config&&"string"==typeof e.config){try{const t=JSON.parse(e.config);e.relationshipType=t.relationships.type,e.relatedPointColor=t.relationships.pointColor,e.relatedPointRadius=t.relationships.pointRadius,e.relationshipLineColor=t.relationships.lineColor,e.relationshipOutsideProgram=t.relationships.relationshipOutsideProgram,e.periodType=t.periodType}catch(e){}delete e.config}const{trackedEntityType:t,program:a,programStatus:n,followUp:r,relationshipType:i,periodType:s,startDate:o,endDate:d,rows:l,organisationUnitSelectionMode:c,eventPointColor:f,eventPointRadius:u,areaRadius:p,relatedPointColor:m,relatedPointRadius:g,relationshipLineColor:y}=e,h=a?a.name:b.Z.t("Tracked entity"),E={title:h,period:S(_(o),_(d)),items:[{name:t.name+(p?` + ${p} m buffer`:""),color:f||U,radius:u||6}]},v=Xe(l).map((e=>e.id)).join(";");let C,P,w=`/trackedEntityInstances?skipPaging=true&fields=${[...Aa,"relationships"]}&ou=${v}`;c&&(w+=`&ouMode=${c}`),a?(w+=`&program=${a.id}`,n&&(w+=`&programStatus=${n}`,P=`${b.Z.t("Program status")}: ${[{id:"ALL",name:b.Z.t("All")},{id:"ACTIVE",name:b.Z.t("Active")},{id:"COMPLETED",name:b.Z.t("Completed")},{id:"CANCELLED",name:b.Z.t("Cancelled")}].find((e=>e.id===n)).name}`),void 0!==r&&(w+="&followUp="+(r?"TRUE":"FALSE"))):w+=`&trackedEntityType=${t.id}`,w+="program"===s?`&programStartDate=${o}&programEndDate=${d}`:`&lastUpdatedStartDate=${o}&lastUpdatedEndDate=${d}`;const T=(await me(w)).trackedEntityInstances.filter((e=>La.includes(e.featureType)&&e.coordinates));let N,O,Z;if(T.length||(C={warning:!0,message:`${t.name}: ${b.Z.t("No tracked entities found")}`}),i){const e=await me(`/relationshipTypes/${i}`),t=e.toConstraint.trackedEntityType.id,a=await me(`/trackedEntityTypes/${t}?fields=displayName,featureType`),n="POINT"===a.featureType;E.items.push({type:"LineString",name:e.displayName,color:y||G,weight:1},{name:`${a.displayName} (${b.Z.t("related")})`,color:m||j,radius:n?g||3:void 0,weight:n?void 0:1});const r=await xa(T,e,{orgUnits:v,organisationUnitSelectionMode:c});N=Ia(r.primary),O=r.relationships,Z=Ia(r.secondary)}else N=Ia(T);return P&&(E.explanation=[P]),{...e,name:h,data:N,relationships:O,secondaryData:Z,legend:E,...C?{alerts:[C]}:{},isLoaded:!0,isExpanded:!0,isVisible:!0}},Da=e=>{let{config:t,onLoad:a}=e;return(0,u.useEffect)((()=>{Ma(t).then(a)}),[t,a]),null};Da.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const Fa={earthEngine:xt,event:da,external:fa,facility:ma,orgUnit:ya,thematic:Ta,trackedEntity:Da},Ua=e=>{let{config:t,onLoad:a}=e;const n=Fa[t.layer];return n?u.createElement(n,{config:t,onLoad:a}):(console.log("Unknown layer type",t.layer,t),null)};Ua.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const ja=Ua;var Ga=a(44977);const Ba=[{type:"zoom"},{type:"fullscreen"},{type:"fitBounds"},{type:"scale",imperial:!1},{type:"search"},{type:"measure"}],Va=[{type:"zoom"},{type:"fullscreen"},{type:"fitBounds"},{type:"attribution",prefix:!1}],qa=[{type:"zoom"}],$a=(e,t,a)=>{let n;return n=e?a||qa:a||t?Va:Ba,t?n.map((e=>({...e,isSplitView:t}))):n},Ha=(0,u.createContext)({}),za=e=>{let{children:t}=e;const a=(0,n.zw)();return u.createElement(Ha.Provider,{value:a.baseUrl},t)};za.propTypes={children:f().node};const Wa=za;var Ya=a(11864),Ja=a(26059),Qa=a.n(Ja);const Ka={critical:!0},Xa=e=>{let{msg:t}=e;return t},en=(e,t)=>{let{id:a,config:n,opacity:r,isVisible:i}=e,{map:s,isPlugin:o}=t;const d=(0,Ya.VY)(Xa,Ka),l=(0,Ya.VY)(Xa,Ka),c=(0,u.useMemo)((()=>s.createLayer({...n,id:a,index:0})),[s,a,n]);return(0,u.useEffect)((()=>(s.addLayer(c).catch((e=>{if(Qa().error(`Basemap could not be added: ${e}`),!o){const a=(t=e,{msg:b.Z.t("Basemap could not be added: {{message}}",{message:t,nsSeparator:";"})});e.includes("not found")?d.show(a):l.show(a)}var t})),()=>s.removeLayer(c))),[s,c,o]),(0,u.useEffect)((()=>{c.setOpacity(r)}),[c,r]),(0,u.useEffect)((()=>{c.setVisibility(i)}),[c,i]),null};en.contextTypes={map:f().object},en.propTypes={config:f().object,id:f().string,isVisible:f().bool,opacity:f().number},en.defaultProps={opacity:1,isVisible:!0};const tn=en;var an=a(70783);const nn=(e,t)=>{if(!t)return e;let a=[...e];return Object.keys(t).forEach((e=>{const n=t[e];a=a.filter((t=>{const a=(t.properties||t)[e];return(0,an.Z)(a)?sn(a,n):rn(a,n)}))})),a},rn=(e,t)=>(""+e).toLowerCase().includes(t.toLowerCase()),sn=(e,t)=>t.split(",").some((t=>t.split("&").every((t=>on(e,t))))),on=(e,t)=>t.includes(">")?e>=Number(t.split(">")[1]):t.includes("<")?e<=Number(t.split("<")[1]):e===Number(t),dn="MapLoadingMask_cover__lW6Me",ln=()=>u.createElement(Ga.Y,{translucent:!0,className:dn},u.createElement(i.M,null,u.createElement(s.V,null)));var cn=a(1498);const fn="Alert_alert__ozfEk",un=e=>{let{message:t,critical:a,warning:n,onHidden:r}=e;return u.createElement("div",{className:fn},u.createElement(cn.N,{critical:a,warning:n,duration:1e4,onHidden:r},t))};un.propTypes={message:f().string.isRequired,onHidden:f().func.isRequired,critical:f().string.boolean,warning:f().string.boolean};const pn=un;function mn(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class bn extends u.PureComponent{constructor(){super(...arguments),mn(this,"state",{}),mn(this,"onPopupClose",(()=>{this.setState({popup:null})})),this.setPeriod(),this.createLayer()}componentDidUpdate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:a,data:n,index:r,opacity:i,isVisible:s,editCounter:o,dataFilters:d,feature:l}=this.props,{period:c}=this.state,{period:f}=t||{},u=o!==e.editCounter;(a!==e.id||n!==e.data||(null==c?void 0:c.id)!==(null==f?void 0:f.id)||d!==e.dataFilters||u)&&(u?this.setPeriod(this.updateLayer.bind(this)):this.updateLayer(d!==e.dataFilters)),void 0!==r&&r!==e.index&&this.setLayerOrder(),i!==e.opacity&&this.setLayerOpacity(),s!==e.isVisible&&this.setLayerVisibility(),l!==e.feature&&this.highlightFeature(l)}componentWillUnmount(){this.removeLayer()}async createLayer(){const{id:e,index:t=0,config:a,opacity:n,isVisible:r}=this.props,{map:i}=this.context;this.layer=i.createLayer({...a,id:e,index:t,opacity:n,isVisible:r}),await i.addLayer(this.layer)}async updateLayer(){await this.removeLayer(),await this.createLayer(!0),this.setLayerOrder()}setPeriod(e){e&&e()}setLayerVisibility(){this.layer.setVisibility(this.props.isVisible)}setLayerOpacity(){this.layer.setOpacity(this.props.opacity)}setLayerOrder(){this.layer&&this.layer.setIndex(this.props.index)}fitBounds(){const{map:e}=this.context;this.layer.getBounds&&e.fitBounds(this.layer.getBounds())}fitBoundsOnce(){this.isZoomed&&void 0!==this.context.map.getZoom()||(this.fitBounds(),this.isZoomed=!0)}async removeLayer(){if(this.layer){const{map:e}=this.context;this.layer.off("contextmenu",this.onFeatureRightClick,this),await e.removeLayer(this.layer),delete this.layer}}highlightFeature(e){this.layer.highlight&&this.layer.highlight(e?e.id:null)}render(){return null}onFeatureRightClick(e){const[t,a]=e.position,n={...this.props},{id:r,layer:i,renderingStrategy:s}=n,{map:o}=this.context,d=o.getContainer(),{left:l,top:c}=d.getBoundingClientRect(),f=s===A;this.props.openContextMenu({...e,position:[t,a],offset:[l,c],layerConfig:n,layerId:r,layerType:i,isSplitView:f,map:o,container:f?d.parentNode.parentNode:d}),this.setState({popup:null})}onError(e){const t=e.message||e;this.context.isPlugin?Qa().error(t):this.setState({error:t})}onErrorHidden(){this.setState({error:null})}}mn(bn,"contextTypes",{map:f().object,isPlugin:f().bool}),mn(bn,"propTypes",{id:f().string.isRequired,config:f().object,data:f().array,dataFilters:f().object,editCounter:f().number,feature:f().object,index:f().number,isVisible:f().bool,opacity:f().number,openContextMenu:f().func}),mn(bn,"defaultProps",{opacity:1,isVisible:!0});const gn=bn,yn=e=>{const{name:t,shortName:a}=(e=>{const t=[{id:"count",name:b.Z.t("Count")},{id:"min",name:b.Z.t("Min")},{id:"max",name:b.Z.t("Max")},{id:"mean",name:b.Z.t("Mean")},{id:"median",name:b.Z.t("Median")},{id:"sum",name:b.Z.t("Sum")},{id:"stdDev",name:b.Z.t("Standard deviation"),shortName:b.Z.t("Std dev")},{id:"variance",name:b.Z.t("Variance")}];return e?t.filter((t=>{let{id:a}=t;return e.includes(a)})):t})().find((t=>t.id===e))||{};return a||t};var hn=a(19176),En=a(87538),vn=a(87517);const Cn="OrgUnitButton_orgUnitButton__w6Jd1",Pn=e=>{let{id:t,orgUnitProfile:a,setOrgUnitProfile:n}=e;return u.createElement("div",{className:Cn},u.createElement(En.z,{small:!0,disabled:t===a,onClick:()=>n(t)},b.Z.t("View profile")))};Pn.propTypes={id:f().string.isRequired,setOrgUnitProfile:f().func.isRequired,orgUnitProfile:f().string};const Sn=(0,vn.$j)((e=>{let{orgUnitProfile:t}=e;return{orgUnitProfile:t}}),{setOrgUnitProfile:e=>({type:"ORGANISATION_UNIT_PROFILE_SET",payload:e})})(Pn),_n=(e,t)=>{const{className:a="",coordinates:n,orgUnitId:r,onClose:i,children:s}=e,{map:o,isPlugin:d}=t,l=(0,u.useMemo)((()=>document.createElement("div")),[]);return(0,u.useEffect)((()=>{l.className=a,o.openPopup(l,n,i)}),[o,l,a,n,i]),(0,u.useEffect)((()=>()=>o.closePopup()),[o]),(0,hn.createPortal)(u.createElement(u.Fragment,null,s,!1===d&&r&&u.createElement(Sn,{id:r})),l)};_n.contextTypes={map:f().object,isPlugin:f().bool},_n.propTypes={coordinates:f().array.isRequired,onClose:f().func.isRequired,children:f().node,className:f().string};const wn=_n,Tn="EarthEnginePopup_popup__1k3Y7",Nn="EarthEnginePopup_title__sFc3Q",On="EarthEnginePopup_table__uIYZy",Zn="EarthEnginePopup_unit__fSQsf",Rn="EarthEnginePopup_classes__AN8t3",xn="EarthEnginePopup_loading__P2TKS",An=e=>{const{coordinates:t,feature:a,data:n,legend:r,valueType:i,onClose:o}=e,{id:d,name:l}=a.properties,{title:c,period:f="",unit:p,items:m=[],groups:g}=r,y="object"==typeof n?n[d]:null,h=je(i),E="percentage"===i,v="loading"===n;let C=null;if(y)if(h){const e=st(E?2:0);C=u.createElement("table",{className:On},u.createElement("thead",null,u.createElement("tr",null,u.createElement("th",{colSpan:"2"},c," ",f),u.createElement("th",null,i))),u.createElement("tbody",null,m.filter((e=>y[e.id])).sort(((e,t)=>y[t.id]-y[e.id])).map((t=>{let{id:a,name:n,color:r}=t;return u.createElement("tr",{key:a,className:Rn},u.createElement("th",{style:{backgroundColor:r}}),u.createElement("th",null,n),u.createElement("td",null,e(y[a]),E?"%":""))}))))}else{const e=1===i.length&&"sum"===i[0],t=(e,t)=>1===g.length?e:1===i.length?t:`${t}_${e}`,a=e=>st(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){const t=[...e].sort(((e,t)=>e-t)),a=t[0],n=t[t.length-1],r=n-a,i=Math.abs(n);return i>=1e4?0:i>=1e3?r>10?0:1:i>=100?r>1?1:2:i>=10?r>.1?2:3:i>=1?r>.01?3:4:r>.001?4:5}return 0}(Object.values(n).map((t=>Object.keys(t).filter((t=>t.includes(e))).map((e=>t[e])))).flat())),r=i.reduce(((e,t)=>(e[t]=a(t),e)),{}),s=u.createElement("caption",null,c," ",f,!e&&u.createElement("div",{className:Zn},p));C=g?u.createElement("table",{className:On},s,u.createElement("thead",null,u.createElement("tr",null,u.createElement("th",null,"Group"),i.map((e=>u.createElement("th",{key:e},yn(e)))))),u.createElement("tbody",null,g.map((e=>{let{id:a,name:n}=e;return u.createElement("tr",{key:a},u.createElement("th",null,n),i.map((e=>u.createElement("td",{key:e},r[e](y[t(e,a)])))))}))),g.length>1&&u.createElement("tfoot",null,u.createElement("tr",null,u.createElement("th",null,b.Z.t("All groups")),i.map((e=>u.createElement("td",{key:e},r[e](y[e]))))))):u.createElement("table",{className:On},s,u.createElement("tbody",null,i.map((e=>u.createElement("tr",{key:e},u.createElement("th",null,yn(e),":"),u.createElement("td",null,r[e](y[e])))))))}return u.createElement(wn,{coordinates:t,orgUnitId:d,onClose:o,className:"dhis2-map-popup-orgunit"},u.createElement("div",{className:Tn},u.createElement("div",{className:Nn},l),C,v&&u.createElement("div",{className:xn},u.createElement(s.V,{small:!0}),b.Z.t("Loading data"))))};An.propTypes={coordinates:f().array.isRequired,feature:f().object.isRequired,legend:f().object.isRequired,onClose:f().func.isRequired,data:f().oneOfType([f().string,f().object]),valueType:f().oneOfType([f().string,f().array])};const kn=An;function Ln(){return Ln=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ln.apply(this,arguments)}function In(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Mn extends gn{constructor(){super(...arguments),In(this,"state",{isLoading:!0,popup:null,aggregations:null,error:null}),In(this,"updateLayer",(async e=>{e?this.applyFilter():(this.clearAggregations(),await this.removeLayer(),await this.createLayer(!0),this.setLayerOrder())}))}componentDidUpdate(e){super.componentDidUpdate(e),console.log("this.context",this.context);const{coordinate:t}=this.props;if(t&&t!==e.coordinate)try{this.layer.showValue({lng:t[0],lat:t[1]})}catch(e){this.setState({error:b.Z.t("Google Earth Engine failed. Is the service configured for this DHIS2 instance?")})}}async createLayer(e){const{id:t,index:a,format:n,opacity:r,isVisible:i,datasetId:s,band:o,mask:d,attribution:l,filter:c,methods:f,mosaic:u,name:p,unit:m,legend:g,value:y,resolution:h,projection:E,params:v,popup:C,data:P,aggregationType:S,areaRadius:_,tileScale:w}=this.props,{map:T,isPlugin:N}=this.context,O={type:Z,id:t,index:a,format:n,opacity:r,isVisible:i,datasetId:s,band:o,mask:d,attribution:l,filter:c,methods:f,mosaic:u,name:p,unit:m,value:y,noValue:b.Z.t("no value"),legend:g.items,resolution:h,projection:E,data:P,aggregationType:S,tileScale:w,preload:!N&&this.hasAggregations(),onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this),onLoad:this.onLoad.bind(this)};v&&(O.params=v),_&&(O.buffer=_),C&&(O.popup=C),e&&this.setState({isLoading:!0}),O.getAuthToken=Be;try{this.layer=T.createLayer(O),await T.addLayer(this.layer)}catch(e){this.onError(e)}this.fitBoundsOnce()}hasAggregations(){const{data:e,aggregationType:t}=this.props;return e&&("string"==typeof t||Array.isArray(t)&&t.length)}getAggregations(){this.hasAggregations()&&!this.state.aggregations&&(this.setState({aggregations:"loading"}),this.layer.getAggregations().then(this.addAggregationValues.bind(this)).catch(this.onError.bind(this)))}addAggregationValues(e){const{id:t,data:a,setAggregations:n}=this.props;n&&n({[t]:e}),this.setState({data:a.map((t=>({...t,properties:{...t.properties,...e[t.id]}}))),aggregations:e})}clearAggregations(){if(this.hasAggregations()){const{id:e,setAggregations:t}=this.props;this.setState({aggregations:void 0}),t&&t({[e]:void 0})}}applyFilter(){const{data:e,dataFilters:t}=this.props,a=nn(this.state.data||e,t).map((e=>e.id));this.layer&&this.layer.filter&&this.layer.filter(a)}render(){const{legend:e,aggregationType:t}=this.props,{isLoading:a,popup:n,aggregations:r,error:i}=this.state;return u.createElement(u.Fragment,null,a&&u.createElement(ln,null),i&&u.createElement(pn,{critical:!0,message:i,onHidden:()=>this.setState({error:null})}),n&&u.createElement(kn,Ln({data:r||{},legend:e,valueType:t,onClose:this.onPopupClose},n)))}onFeatureClick(e){this.getAggregations(),this.setState({popup:e})}onLoad(){this.setState({isLoading:!1,popup:null}),this.context.isPlugin||this.getAggregations()}onError(e){let t=e.message||e;t.includes("memory limit exceeded")&&this.props.error&&(t=this.props.error),this.setState({error:t,isLoading:!1,aggregations:"error"})}}In(Mn,"contextType",Ha);const Dn=e=>void 0!==e||null!==e,Fn={events:{resource:"events",id:e=>{let{id:t}=e;return t}}},Un=e=>{let{displayElements:t,dataValues:a,styleDataItem:n,value:r}=e;const i=[];return n&&!t.find((e=>e.id===n.id))&&i.push(u.createElement("tr",{key:n.id},u.createElement("th",null,n.name),u.createElement("td",null,Dn(r)?r:b.Z.t("Not set")))),t.forEach((e=>{let{id:t,name:n,valueType:r,options:s}=e;const{value:o}=a.find((e=>e.dataElement===t))||{};let d=o;"COORDINATE"===r&&o?d=(e=>{try{return JSON.parse(e).map((e=>e.toFixed(6))).join(", ")}catch(t){return e}})(o):s?d=s[o]:Dn(o)||(d=b.Z.t("Not set")),i.push(u.createElement("tr",{key:t},u.createElement("th",null,n),u.createElement("td",null,d)))})),i.length&&i.push(u.createElement("tr",{key:"divider",style:{height:5}})),i},jn=e=>{let{coordinates:t,feature:a,styleDataItem:r,displayElements:i,eventCoordinateFieldName:s,onClose:o}=e;const{error:d,data:l,refetch:c}=(0,n.u_)(Fn,{lazy:!0});(0,u.useEffect)((()=>{c({id:a.properties.id||a.properties[It]})}),[a,c]);const{type:f,coordinates:p}=a.geometry,{value:m}=a.properties,{dataValues:g=[],eventDate:y,orgUnitName:h}=(null==l?void 0:l.events)||{};return u.createElement(wn,{coordinates:t,onClose:o,className:"dhis2-map-popup-event"},d&&u.createElement("span",null,b.Z.t("Could not retrieve event data")),!d&&u.createElement("table",null,u.createElement("tbody",null,(null==l?void 0:l.events)&&Un({displayElements:i,dataValues:g,styleDataItem:r,value:m}),"Point"===f&&u.createElement("tr",null,u.createElement("th",null,s||b.Z.t("Event location")),u.createElement("td",null,p[0].toFixed(6)," ",p[1].toFixed(6))),h&&u.createElement("tr",null,u.createElement("th",null,b.Z.t("Organisation unit")),u.createElement("td",null,h)),y&&u.createElement("tr",null,u.createElement("th",null,b.Z.t("Event time")),u.createElement("td",null,Ee(y))))))};jn.propTypes={coordinates:f().array.isRequired,displayElements:f().array.isRequired,feature:f().object.isRequired,onClose:f().func.isRequired,eventCoordinateFieldName:f().string,styleDataItem:f().object};const Gn=jn;function Bn(){return Bn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Bn.apply(this,arguments)}function Vn(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const qn=class extends gn{constructor(){super(...arguments),Vn(this,"clusterCount",0),Vn(this,"state",{popup:null,dataElements:null,eventCoordinateFieldName:null}),Vn(this,"onPopupClose",(()=>{this.setState({popup:null})}))}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,bounds:r,data:i,eventClustering:s,eventPointColor:o,eventPointRadius:d,program:l,programStage:c,serverCluster:f,areaRadius:u,styleDataItem:p,legend:m,dataFilters:b}=this.props,g=nn(i,b),y=o&&"#"!==o.charAt(0)?"#"+o:o,h=y||F,E=p?void 0:yt(h),v=E,C=d||6,P=this.context.map;let S,_;this.displayElements={};const w={type:"events",id:e,index:t,opacity:a,isVisible:n,data:g,fillColor:h,strokeColor:E,countColor:v,radius:C,onClick:this.onEventClick.bind(this)};s?f?(w.type="serverCluster",w.bounds=r,w.load=async(e,t)=>{S=S||await(0,ue.s8)(),_=_||await Gt(this.props,{d2:S,nameProperty:S.currentUser.settings.keyAnalysisDisplayProperty}),_=_.withBbox(e.bbox).withClusterSize(e.clusterSize).withIncludeClusterPoints(e.includeClusterPoints);const a=await S.analytics.events.getCluster(_);t(e.tileId,this.toGeoJson(a))}):(w.clusterPane=e,p&&m?(w.type="donutCluster",w.groups=m.items):w.type="clientCluster"):u&&(w.buffer=u,w.bufferStyle={color:y||F,weight:1,opacity:.2,fillOpacity:.1}),l&&c&&this.loadDisplayElements(),this.layer=P.createLayer(w),P.addLayer(this.layer),this.fitBoundsOnce()}render(){const{styleDataItem:e}=this.props,{popup:t,displayElements:a,eventCoordinateFieldName:n}=this.state;return t&&a?u.createElement(Gn,Bn({},t,{styleDataItem:e,displayElements:a,eventCoordinateFieldName:n,onClose:this.onPopupClose})):null}onEventClick(e){let{feature:t,coordinates:a}=e;this.setState({popup:{feature:t,coordinates:a}})}toGeoJson(e){const t={},a=[];return e.headers.forEach(((e,a)=>t[e.name]=a)),Array.isArray(e.rows)&&e.rows.forEach((e=>{const n=e[t.extent].match(/([-\d.]+)/g),r=parseInt(e[t.count],10),i=++this.clusterCount;a.push({type:"Feature",id:i,geometry:JSON.parse(e[t.center]),properties:{cluster:r>1,cluster_id:i,point_count:r,point_count_abbreviated:it(r),bounds:[[n[0],n[1]],[n[2],n[3]]],id:e[t.points]}})})),a}async loadDisplayElements(){const{programStage:e,eventCoordinateField:t}=this.props,a=await(0,ue.s8)(),n=await a.models.programStage.get(e.id,{fields:"programStageDataElements[displayInReports,dataElement[id,displayName~rename(name),optionSet,valueType]]",paging:!1}),{programStageDataElements:r}=n;let i,s=[];if(Array.isArray(r)){s=r.filter((e=>e.displayInReports)).map((e=>e.dataElement));for(const e of s)await this.loadOptionSet(e);if(t){const e=r.find((e=>e.dataElement.id===t));e&&(i=e.dataElement.name)}}this.setState({displayElements:s,eventCoordinateFieldName:i})}async loadOptionSet(e){const{optionSet:t}=e;if(!t||!t.id)return e;const a=await(0,ue.s8)();if(t&&t.id){const n=await a.models.optionSets.get(t.id,{fields:"id,displayName~rename(name),options[code,displayName~rename(name)]",paging:!1});n&&n.options&&(e.options=n.options.reduce(((e,t)=>(e[t.code]=t.name,e)),{}))}}};const $n=e=>{let{labelFontSize:t,labelFontStyle:a,labelFontWeight:n,labelFontColor:r}=e;const i=t||Y;return{fontSize:i,fontStyle:a||"normal",fontWeight:n||"normal",lineHeight:1.2*parseInt(i,10)+"px",color:mt(r)||J,paddingTop:"10px"}};function Hn(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const zn=class extends gn{constructor(){super(...arguments),Hn(this,"state",{popup:null})}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,dataFilters:i,labels:s,areaRadius:o,orgUnitFieldDisplayName:d,associatedGeometries:l,organisationUnitColor:c=B,organisationUnitGroupSet:f}=this.props,u=nn(r,i),p=this.context.map,m=f?c:yt(c),b=p.createLayer({type:"group",id:e,index:t,opacity:a,isVisible:n}),g={type:R,data:u,hoverLabel:"{name}",style:{color:c,strokeColor:m},onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this),onError:this.onError.bind(this)};s&&(g.label=W,g.labelStyle={...$n(this.props),paddingTop:"10px"}),o&&(g.buffer=o),l&&b.addLayer({type:R,data:l,hoverLabel:`{name}: ${d}`,style:{color:"rgb(149, 200, 251)",opacityFactor:.5},onClick:this.onAssociatedGeometryClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this)}),b.addLayer(g),this.layer=b,p.addLayer(this.layer).catch(this.onError.bind(this)),this.fitBoundsOnce()}getPopup(){const{coordinates:e,feature:t}=this.state.popup,{id:a,name:n,dimensions:r,pn:i}=t.properties,{orgUnitFieldDisplayName:s}=this.props;return u.createElement(wn,{coordinates:e,orgUnitId:a,onClose:this.onPopupClose,className:"dhis2-map-popup-orgunit"},u.createElement("em",null,n),this.state.isAssociatedGeometry&&u.createElement("div",null,s),(0,l.isPlainObject)(r)&&u.createElement("div",null,b.Z.t("Groups"),":",Object.keys(r).map((e=>r[e])).join(", ")),i&&u.createElement("div",null,b.Z.t("Parent unit"),": ",i))}render(){const{popup:e,error:t}=this.state;return u.createElement(u.Fragment,null,e&&this.getPopup(),t&&u.createElement(pn,{warning:!0,message:t,onHidden:this.onErrorHidden.bind(this)}))}onFeatureClick(e){this.setState({popup:e})}onAssociatedGeometryClick(e){this.setState({popup:e,isAssociatedGeometry:!0})}};function Wn(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var Yn=a(36206),Jn=a.n(Yn),Qn=a(50575),Kn=a(51175),Xn=a(54500),er=a(31102),tr=a(67717),ar=a(7780),nr=a(94492),rr=a(1416),ir=a(43922),sr=a(74345),or=a(17406),dr=a(14056),lr=a(87302);const cr=1e3,fr=60*cr,ur=60*fr,pr=24*ur,mr=7*pr,br=30*pr,gr=365*pr;const yr=function(e,t,a,n,r,i){const s=[[ar.E,1,cr],[ar.E,5,5*cr],[ar.E,15,15*cr],[ar.E,30,30*cr],[i,1,fr],[i,5,5*fr],[i,15,15*fr],[i,30,30*fr],[r,1,ur],[r,3,3*ur],[r,6,6*ur],[r,12,12*ur],[n,1,pr],[n,2,2*pr],[a,1,mr],[t,1,br],[t,3,3*br],[e,1,gr]];return function(t,a,n){const r=a<t;r&&([t,a]=[a,t]);const i=n&&"function"==typeof n.range?n:function(t,a,n){const r=Math.abs(a-t)/n,i=(0,er.Z)((e=>{let[,,t]=e;return t})).right(s,r);if(i===s.length)return e.every((0,tr.ly)(t/gr,a/gr,n));if(0===i)return nr.A.every(Math.max((0,tr.ly)(t,a,n),1));const[o,d]=s[r/s[i-1][2]<s[i][2]/r?i-1:i];return o.every(d)}(t,a,n),o=i?i.range(t,+a+1):[];return r?o.reverse():o}}(rr.jB,ir.F0,sr.Ox,or.rr,dr.WQ,lr.Z_),hr="Timeline_timeline__J5EdJ map_box__Qmg+b",Er="Timeline_play__LOGhW",vr="Timeline_period__-pJEz",Cr="Timeline_selected__2SuNH";function Pr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Sr=u.createElement("path",{d:"M8 5v14l11-7z"}),_r=u.createElement("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}),wr=["LAST_6_BIMONTHS","BIMONTHS_THIS_YEAR"];class Tr extends u.Component{constructor(){super(...arguments),Pr(this,"state",{width:null,mode:"start"}),Pr(this,"getPeriodRects",(()=>{const{period:e,periods:t}=this.props;return t.map((t=>{const a=e.id===t.id,{id:n,startDate:r,endDate:i}=t,s=this.timeScale(r),o=this.timeScale(i)-s;return u.createElement("rect",{key:n,className:Jn()(vr,{[Cr]:a}),x:s,y:"0",width:o,height:"16",onClick:()=>this.onPeriodClick(t)})}))})),Pr(this,"setTimeScale",(()=>{const{periods:e}=this.props,{width:t}=this.state;if(!e.length)return;const{startDate:a}=e[0],{endDate:n}=e[e.length-1];this.timeScale=(0,Kn.Z)().domain([a,n]).range([0,t])})),Pr(this,"setTimeAxis",(()=>{const{periodId:e,periods:t}=this.props,a=t.length*(wr.includes(e)?2:1),{width:n}=this.state,r=Math.round(n/80),i=r<a?r:a,s=(0,Qn.LL)(this.timeScale),[o,d]=this.timeScale.domain(),l=yr(o,d,i);s.tickValues(l),(0,Xn.Z)(this.node).call(s)})),Pr(this,"setWidth",(()=>{if(this.node){const e=this.node.parentNode.getBoundingClientRect(),t=e.right-e.left-40-20;this.setState({width:t})}})),Pr(this,"onPlayPause",(()=>{"play"===this.state.mode?this.stop():this.play()})),Pr(this,"play",(()=>{const{period:e,periods:t,onChange:a}=this.props,n=t.findIndex((t=>t.id===e.id)),r=n===t.length-1;if(this.timeout){if(r)return void this.stop();a(t[n+1])}else r&&a(t[0]),this.setState({mode:"play"});this.timeout=setTimeout(this.play,1500)})),Pr(this,"stop",(()=>{this.setState({mode:"stop"}),clearTimeout(this.timeout),delete this.timeout}))}componentDidMount(){this.setWidth(),this.context.map.on("resize",this.setWidth)}componentDidUpdate(){this.setTimeAxis()}componentWillUnmount(){this.context.map.off("resize",this.setWidth)}render(){const{mode:e}=this.state;return this.setTimeScale(),u.createElement("svg",{className:`dhis2-map-timeline ${hr}`},u.createElement("g",{onClick:this.onPlayPause,transform:"translate(7,5)",className:Er},u.createElement("path",{d:"M0 0h24v24H0z",fillOpacity:"0.0"}),"play"===e?_r:Sr),u.createElement("g",{transform:"translate(40,10)"},this.getPeriodRects()),u.createElement("g",{transform:"translate(40,25)",ref:e=>this.node=e}))}onPeriodClick(e){e.id!==this.props.period.id&&this.props.onChange(e),this.stop()}}Pr(Tr,"contextTypes",{map:f().object}),Pr(Tr,"propTypes",{period:f().object.isRequired,periodId:f().string.isRequired,periods:f().array.isRequired,onChange:f().func.isRequired});const Nr=Tr,Or="PeriodName_periodName__7TNSd",Zr="PeriodName_period__J0Yxx map_box__Qmg+b",Rr=e=>{let{period:t,isTimeline:a}=e;return u.createElement("div",{className:`dhis2-map-period ${Or}`,style:a?{bottom:86}:null},u.createElement("div",{className:Zr},t))};Rr.propTypes={period:f().string.isRequired,isTimeline:f().bool};const xr=Rr;function Ar(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const kr=class extends gn{constructor(){super(...arguments),Ar(this,"onPeriodChange",(e=>this.setState({period:e})))}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,dataFilters:i,labels:s,valuesByPeriod:o,renderingStrategy:d=x,thematicMapType:l=k,noDataColor:c}=this.props,{period:f}=this.state,u=l===L;let p=u?r.map((e=>({...e,geometry:{type:"Point",coordinates:(0,Me.mC)(e.geometry)}}))):r;if(d!==x){const e=o[f.id]||{};p=p.map((t=>({...t,properties:{...t.properties,...e[t.id],...t.properties.hasAdditionalGeometry&&"Point"===t.geometry.type&&{color:B,radius:q}}}))),c||(p=p.filter((t=>void 0!==e[t.id])))}const m=this.context.map,b={type:"choropleth",id:e,index:t,opacity:a,isVisible:n,data:nn(p,i),hoverLabel:"{name} ({value})",color:c,onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this)};s&&(b.label=this.props.labelTemplate||W,b.labelStyle=$n(this.props)),u?(this.layer=m.createLayer({type:"group",id:e,index:t,opacity:a,isVisible:n}),this.layer.addLayer({type:"boundary",data:r.map((e=>({...e,properties:{...e.properties,style:{color:B,weight:.5}}}))),style:{}}),this.layer.addLayer(b)):this.layer=m.createLayer(b),m.addLayer(this.layer),this.fitBoundsOnce()}setPeriod(e){const{period:t,periods:a,renderingStrategy:n=x}=this.props;if(!t&&!a)return;const r={period:n===x?null:t||a[0]};e?this.setState(r,e):this.state=r}getPopup(){const{columns:e,aggregationType:t,legend:a}=this.props,{popup:n,period:r}=this.state,{coordinates:i,feature:s}=n,{id:o,name:d,value:l}=s.properties,c=e[0].items[0].name||"",f=r?r.name:a.period;return u.createElement(wn,{coordinates:i,orgUnitId:o,onClose:this.onPopupClose,className:"dhis2-map-popup-orgunit"},u.createElement("em",null,d),u.createElement("div",null,c),u.createElement("div",null,f),u.createElement("div",null,b.Z.t("Value"),": ",l),t&&"DEFAULT"!==t&&u.createElement("div",null,t))}render(){const{periods:e,renderingStrategy:t,filters:a}=this.props,{period:n,popup:r}=this.state,{id:i}=et(a)||{};return u.createElement(u.Fragment,null,"TIMELINE"===t&&n&&u.createElement(u.Fragment,null,u.createElement(xr,{period:n.name,isTimeline:!0}),u.createElement(Nr,{periodId:i,period:n,periods:e,onChange:this.onPeriodChange})),r&&this.getPopup())}onFeatureClick(e){this.setState({popup:e})}},Lr=e=>{let{children:t}=e;const{baseUrl:a,apiVersion:r}=(0,n.zw)();return t({baseUrl:`${a}/api/${r}`})};function Ir(){return Ir=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ir.apply(this,arguments)}function Mr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Dr=async(e,t,a)=>{const n=await(async e=>{let{url:t,method:a,body:n,baseUrl:r}=e;const i={headers:{"Content-Type":"application/json"},credentials:"include"};return a&&n&&(i.method=a,(0,l.isString)(n)?(i.headers["Content-Type"]="text/html",i.body=n):(0,l.isObject)(n)&&(i.body=JSON.stringify(n))),fetch(encodeURI(r+t),i).then((e=>["POST","PUT","PATCH"].includes(a)?e:pe(e))).catch((e=>console.log("Error: ",e)))})({url:`/trackedEntityInstances/${e}?fields=${t}`,baseUrl:a});return n},Fr=(e,t)=>{switch(e){case"POINT":return JSON.parse(t);case"POLYGON":return(e=>{const t=e.reduce(((e,t)=>(e[0]+=t[0],e[1]+=t[1],e)),[0,0]);return[t[0]/e.length,t[1]/e.length]})(JSON.parse(t)[0]);default:return null}},Ur=e=>{let{from:t,to:a}=e;const n=Fr(t.featureType,t.coordinates),r=Fr(a.featureType,a.coordinates);return n&&r?{type:"Feature",geometry:{type:"LineString",coordinates:[n,r]},properties:{}}:null};class jr extends gn{constructor(){super(...arguments),Mr(this,"state",{popup:null})}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,relationships:i,secondaryData:s,eventPointColor:o,eventPointRadius:d,areaRadius:l,relatedPointColor:c,relatedPointRadius:f,relationshipLineColor:u}=this.props,{map:p}=this.context,m=o||U,b={type:"geoJson",data:r,style:{color:m,weight:1,radius:d||6},onClick:this.onEntityClick.bind(this)};l&&(b.buffer=l,b.bufferStyle={color:m,weight:1,opacity:.2,fillOpacity:.1});const g=p.createLayer({type:"group",id:e,index:t,opacity:a,isVisible:n});if(i){const e={type:"geoJson",data:s,style:{color:c||j,weight:1,radius:f||3},onClick:this.onEntityClick.bind(this)},t=((e,t,a)=>({type:"geoJson",data:e.map(Ur).filter((e=>!!e)),style:{color:t,weight:a}}))(i,u||G,1);g.addLayer(t),g.addLayer(e)}g.addLayer(b),this.layer=g,p.addLayer(this.layer),this.fitBoundsOnce()}getPopup(){const{coordinates:e,data:t}=this.state.popup,{attributes:a=[],lastUpdated:n}=t;return u.createElement(wn,{coordinates:e,onClose:this.onPopupClose},u.createElement("table",null,u.createElement("tbody",null,a.map((e=>{let{name:t,value:a}=e;return u.createElement("tr",{key:t},u.createElement("th",null,t,":"),u.createElement("td",null,a))})),u.createElement("tr",null,u.createElement("th",null,b.Z.t("Last updated"),":"),u.createElement("td",null,Ee(n))))))}render(){return this.state.popup?this.getPopup():null}async onEntityClick(e){const{feature:t,coordinates:a}=e,n=await Dr(t.properties.id,"lastUpdated,attributes[displayName~rename(name),value],relationships",this.props.baseUrl);this.setState({popup:{feature:t,coordinates:a,data:n}})}}const Gr="Map_map__R97nG";function Br(){return Br=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Br.apply(this,arguments)}function Vr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const qr={event:qn,trackedEntity:e=>u.createElement(Lr,null,(t=>{let{baseUrl:a}=t;return u.createElement(jr,Ir({baseUrl:a},e))})),facility:zn,thematic:kr,orgUnit:class extends gn{constructor(){super(...arguments),Wn(this,"state",{popup:null})}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,labels:i,radiusLow:s,dataFilters:o,organisationUnitColor:d=B}=this.props,l=nn(r,o),c=this.context.map,f={type:R,id:e,index:t,opacity:a,isVisible:n,data:l,hoverLabel:"{name}",style:{color:"transparent",strokeColor:d},onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this)};i&&(f.label=W,f.labelStyle=$n(this.props)),s&&(f.style.radius=s),this.layer=c.createLayer(f),c.addLayer(this.layer),this.fitBoundsOnce()}getPopup(){const{coordinates:e,feature:t}=this.state.popup,{id:a,name:n,level:r,parentName:i}=t.properties;return u.createElement(wn,{coordinates:e,orgUnitId:a,onClose:this.onPopupClose,className:"dhis2-map-popup-orgunit"},u.createElement("em",null,n),r&&u.createElement("div",null,b.Z.t("Level"),": ",r),i&&u.createElement("div",null,b.Z.t("Parent unit"),": ",i))}render(){return this.state.popup?this.getPopup():null}onFeatureClick(e){this.setState({popup:e})}},earthEngine:Mn,external:class extends gn{createLayer(){const{id:e,index:t,opacity:a,isVisible:n,config:r}=this.props,{map:i}=this.context;this.layer=i.createLayer({id:e,index:t,opacity:a,isVisible:n,...r}),i.addLayer(this.layer)}}};class $r extends u.Component{constructor(e,t){super(e,t),Vr(this,"state",{}),Vr(this,"onRightClick",(e=>{const[t,a]=e.position,{left:n,top:r}=this.map.getContainer().getBoundingClientRect();this.props.openContextMenu({...e,position:[t,a],offset:[n,r]})})),Vr(this,"onMapReady",(e=>this.setState({map:e}))),Vr(this,"onFullscreenChange",(e=>{let{isFullscreen:t}=e;Le(this.map,t)}));const{isPlugin:a}=e,n=Fe({scrollZoom:!a});a?(n.toggleMultiTouch(!0),n.on("fullscreenchange",this.onFullscreenChange)):n.on("contextmenu",this.onRightClick,this),this.map=n,n.on("ready",this.onMapReady)}getChildContext(){return{map:this.map,isPlugin:this.props.isPlugin}}componentDidMount(){const{controls:e,bounds:t,latitude:a,longitude:n,zoom:r}=this.props,{map:i}=this;this.node.appendChild(i.getContainer()),i.resize(),e&&e.filter((e=>Me.s9.includes(e.type))).forEach((e=>i.addControl(e)));const s=i.getLayersBounds();Array.isArray(s)?i.fitBounds(s):t?i.fitBounds(t):a&&n&&r?i.setView([n,a],r):i.fitWorld()}componentDidUpdate(e){const{resizeCount:t,isFullscreen:a,isPlugin:n}=this.props;t!==e.resizeCount&&this.map.resize(),n&&a!==e.isFullscreen&&Le(this.map,a)}componentWillUnmount(){this.map&&(this.map.off("ready",this.onMapReady),this.map.remove(),delete this.map)}render(){const{basemap:e,layers:t,feature:a,coordinatePopup:n,closeCoordinatePopup:r,openContextMenu:i,setAggregations:s}=this.props,{map:o}=this.state,d=t.filter((e=>e.isLoaded));return u.createElement("div",{ref:e=>this.node=e,className:Gr},o&&u.createElement(u.Fragment,null,d.map(((e,t)=>{const n=qr[e.layer]||gn,r=a&&a.layerId===e.id?a:null;return u.createElement(n,Br({key:e.id,index:d.length-t,feature:r,openContextMenu:i,setAggregations:s},e))})),u.createElement(tn,e),n&&u.createElement(wn,{coordinates:n,onClose:r},b.Z.t("Longitude"),":"," ",n[0].toFixed(6),u.createElement("br",null),b.Z.t("Latitude"),":"," ",n[1].toFixed(6))))}}Vr($r,"propTypes",{openContextMenu:f().func.isRequired,basemap:f().object,bounds:f().array,closeCoordinatePopup:f().func,controls:f().array,coordinatePopup:f().array,feature:f().object,isFullscreen:f().bool,isPlugin:f().bool,latitude:f().number,layers:f().array,longitude:f().number,resizeCount:f().number,setAggregations:f().func,zoom:f().number}),Vr($r,"defaultProps",{isPlugin:!1}),Vr($r,"childContextTypes",{map:f().object.isRequired,isPlugin:f().bool.isRequired});const Hr=$r,zr="MapItem_mapItem__MhRhp";function Wr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Yr extends u.PureComponent{constructor(e,t){super(e,t),Wr(this,"state",{}),Wr(this,"onMapReady",(e=>this.setState({map:e})));const{isPlugin:a}=e;this.map=Fe({attributionControl:!1,scrollZoom:!a}),a&&this.map.toggleMultiTouch(!0),this.map.on("ready",this.onMapReady)}getChildContext(){return{map:this.map,isPlugin:this.props.isPlugin}}componentDidMount(){const{layerId:e,index:t,setMapControls:a}=this.props,{map:n}=this;this.node.appendChild(n.getContainer()),this.fitLayerBounds(),n.sync(e),0==t&&a(n)}componentDidUpdate(e){const{count:t,isFullscreen:a,isPlugin:n}=this.props;t!==e.count&&this.fitLayerBounds(),n&&a!==e.isFullscreen&&Le(this.map,a),this.map.resize()}componentWillUnmount(){this.map.off("ready",this.onMapReady),this.map.unsync(this.props.layerId),this.map.remove(),delete this.map}render(){const{count:e,children:t}=this.props,{map:a}=this.state;return u.createElement("div",{ref:e=>this.node=e,className:zr,style:{width:4===e?"50%":"33.3333%"}},a&&t)}fitLayerBounds(){this.map.resize();const e=this.map.getLayersBounds();e?this.map.fitBounds(e):this.map.fitWorld()}}Wr(Yr,"childContextTypes",{map:f().object.isRequired,isPlugin:f().bool.isRequired}),Wr(Yr,"propTypes",{children:f().node.isRequired,count:f().number.isRequired,index:f().number.isRequired,layerId:f().string.isRequired,setMapControls:f().func.isRequired,isFullscreen:f().bool,isPlugin:f().bool}),Wr(Yr,"defaultProps",{isPlugin:!1});const Jr=Yr,Qr="SplitView_splitView__YbEsG";function Kr(){return Kr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Kr.apply(this,arguments)}const Xr=e=>{let{isPlugin:t,basemap:a,layer:n,feature:r,controls:i,openContextMenu:s,isFullscreen:o,interpretationModalOpen:d}=e;const[l,c]=(0,u.useState)(),[f,p]=(0,u.useState)(),m=(0,u.useRef)(),b=(0,u.useCallback)((e=>{let{isFullscreen:t}=e;return c(t)}),[]);(0,u.useEffect)((()=>{f&&i&&m.current&&i.forEach((e=>{f.addControl(e),m.current.append(f.getControlContainer(e.type))}))}),[f,i,m]),(0,u.useEffect)((()=>(f&&t&&f.on("fullscreenchange",b),()=>{f&&t&&f.off("fullscreenchange",b)})),[f,t,b]),(0,u.useEffect)((()=>{c(o)}),[o]);const{id:g,periods:y=[]}=n;return d?null:u.createElement("div",{ref:m,className:Jn()("dhis2-map-split-view",Qr)},y.map(((e,i)=>u.createElement(Jr,{key:e.id,index:i,count:y.length,layerId:g,setMapControls:p,isPlugin:t,isFullscreen:l},u.createElement(tn,a),u.createElement(kr,Kr({index:1,period:e,feature:r},n,{openContextMenu:s})),u.createElement(xr,{period:e.name})))))};Xr.propTypes={layer:f().object.isRequired,openContextMenu:f().func.isRequired,basemap:f().object,controls:f().array,feature:f().object,interpretationModalOpen:f().bool,isFullscreen:f().bool,isPlugin:f().bool},Xr.defaultProps={openContextMenu:()=>{}};const ei=Xr,ti=e=>{const{isPlugin:t,isFullscreen:a,basemap:n,layers:r,controls:o,feature:d,bounds:l,coordinatePopup:c,interpretationModalOpen:f,closeCoordinatePopup:p,openContextMenu:m,setAggregations:b,resizeCount:g}=e,y=he(r),h=!!y,E=(0,u.useMemo)((()=>$a(t,h,o)),[t,h,o]);return u.createElement(u.Fragment,null,void 0===n.id?u.createElement(Ga.Y,null,u.createElement(i.M,null,u.createElement(s.V,null))):u.createElement(u.Fragment,null,h?u.createElement(ei,{isPlugin:t,isFullscreen:a,basemap:n,layer:y,controls:E,feature:d,interpretationModalOpen:f,openContextMenu:m,resizeCount:g}):u.createElement(Wa,null,u.createElement(Hr,{isPlugin:t,isFullscreen:a,basemap:n,layers:[...r].reverse(),bounds:l,controls:E,feature:d,coordinatePopup:c,closeCoordinatePopup:p,openContextMenu:m,setAggregations:b,resizeCount:g}))))};ti.propTypes={basemap:f().object,bounds:f().array,closeCoordinatePopup:f().func,controls:f().array,coordinatePopup:f().array,feature:f().object,interpretationModalOpen:f().bool,isFullscreen:f().bool,isPlugin:f().bool,layers:f().array,openContextMenu:f().func,resizeCount:f().number,setAggregations:f().func};const ai=ti;var ni=a(17775),ri=a(89308),ii=a(25029),si=a(7448),oi=a(69666),di=a(75023),li=a(47756);const ci="Checkbox_checkbox__VD9Z7",fi=e=>{let{label:t,checked:a=!1,disabled:n,dense:r=!0,onChange:i,className:s}=e;return u.createElement("div",{className:Jn()(ci,s)},u.createElement(li.X,{label:t,checked:a,dense:r,disabled:n,onChange:e=>{let{checked:t}=e;return i(t)}}))};fi.propTypes={onChange:f().func.isRequired,checked:f().bool,className:f().string,dense:f().bool,disabled:f().bool,label:f().string};const ui="ColorButton_colorButton__R+Adn",pi=e=>{let{color:t,onChange:a,className:n}=e;return u.createElement("label",{className:Jn()(ui,n),style:{backgroundImage:`radial-gradient(\n                        circle, ${t} 35%, transparent 40%\n                    )`}},u.createElement("input",{type:"color",value:t,onChange:e=>a(e.target.value.toUpperCase())}))};pi.propTypes={color:f().string.isRequired,onChange:f().func.isRequired,className:f().string};const mi=pi;var bi=a(63429);const gi="ColorPicker_colorPicker__cDBFg",yi="ColorPicker_label__2MEbh",hi="ColorPicker_icon__YLETT",Ei="ColorPicker_dark__ScuM6",vi=e=>{let{color:t,label:a,width:n,height:r,onChange:i,className:s}=e;return u.createElement(u.Fragment,null,u.createElement("div",{className:Jn()(gi,s)},a&&u.createElement("div",{className:yi},a),u.createElement("label",{style:{backgroundColor:t,width:n||"100%",height:r||32}},u.createElement("span",{className:Jn()(hi,{[Ei]:!gt(t)})},u.createElement(bi.Z,null)),u.createElement("input",{type:"color",value:t,onChange:e=>i(e.target.value.toUpperCase())}))))};vi.propTypes={color:f().string.isRequired,onChange:f().func.isRequired,className:f().string,height:f().oneOfType([f().string,f().number]),label:f().string,width:f().oneOfType([f().string,f().number])};const Ci="ColorScale_colorScale__49vdu",Pi="ColorScale_item__pC2V1",Si=e=>{let{scale:t,bins:a,width:n,onClick:r}=e;const i=lt[t][a],s=n?n/a:36;return u.createElement("ul",{onClick:()=>r(t),className:Ci,style:{...n&&{width:n}}},i.map(((e,t)=>u.createElement("li",{key:t,className:Pi,style:{backgroundColor:e,width:s}}))))};Si.propTypes={bins:f().number.isRequired,scale:f().string.isRequired,onClick:f().func.isRequired,width:f().number};const _i=Si,wi="ColorScaleSelect_colorScale__4hvzQ",Ti="ColorScaleSelect_popover__y0bcu",Ni=e=>{let{palette:t,width:a,onChange:n,className:r}=e;const[i,s]=(0,u.useState)(!1),o=(0,u.useRef)(),d=t.split(",").length,l=(e=>{const t=e.split(",").length;return ct.find((a=>lt[a][t].join(",")===e))})(t),c=e=>{const a=t.split(",").length;n(ft(e,a)),s(!1)};return u.createElement(u.Fragment,null,u.createElement("div",{ref:o,className:Jn()(wi,r)},u.createElement(_i,{bins:d,scale:l,onClick:()=>s(!0),width:a||260})),i&&u.createElement(ni.J,{reference:o,arrow:!1,placement:"right",onClickOutside:()=>s(!1)},u.createElement("div",{className:Ti,style:{width:a+24||260}},ct.map(((e,t)=>u.createElement(_i,{key:t,scale:e,bins:d,onClick:c,width:a||260}))))))};Ni.propTypes={palette:f().string.isRequired,onChange:f().func.isRequired,className:f().string,width:f().number};const Oi=e=>{let{condition:t,wrapper:a,children:n}=e;return t?a(n):n};Oi.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired,condition:f().bool.isRequired,wrapper:f().elementType.isRequired};const Zi=Oi,Ri="DatePicker_datePicker__o+7IX",xi="DatePicker_label__dxJ2X",Ai="DatePicker_content__rClMi",ki="DatePicker_box__g-fUm",Li="DatePicker_inputDiv__YD05P",Ii="DatePicker_input__3iMEB",Mi=e=>{let{label:t,name:a,defaultVal:n,onBlur:r,className:i}=e;const s=(0,u.useRef)(null);return(0,u.useEffect)((()=>{s.current&&(s.current.defaultValue=n)}),[n]),u.createElement("div",{className:Jn()(Ri,i)},u.createElement("label",{className:xi},t),u.createElement("div",{className:Ai},u.createElement("div",{className:ki},u.createElement("div",{className:Li},u.createElement("input",{className:Ii,ref:s,type:"date",name:a,onBlur:e=>r(e.target.value)})))))};Mi.propTypes={label:f().string.isRequired,onBlur:f().func.isRequired,className:f().string,defaultVal:f().string,name:f().string};var Di=a(25330),Fi=a(15648),Ui=a(93883);const ji="InputField_inputField__kOwID",Gi=e=>{let{label:t,value:a,min:n,max:r,step:i=1,dense:s=!0,disabled:o,onChange:d,className:l}=e;return u.createElement("div",{className:Jn()(ji,l)},u.createElement(Ui.U,{dense:s,type:"number",min:String(n),max:String(r),step:String(i),label:t,value:Number.isNaN(a)?"":String(a),disabled:o,onChange:e=>{let{value:t}=e;return d(t)}}))};Gi.propTypes={label:f().string.isRequired,onChange:f().func.isRequired,className:f().string,dense:f().bool,disabled:f().bool,max:f().number,min:f().number,step:f().number,value:f().oneOfType([f().number,f().string])};const Bi=Gi,Vi="FontStyle_fontStyle__1hQJn",qi="FontStyle_textSize__U8QDq",$i=e=>{let{color:t,size:a,weight:n,fontStyle:r,onColorChange:i,onSizeChange:s,onWeightChange:o,onStyleChange:d,className:l}=e;return u.createElement("div",{className:Jn()(Vi,l)},s&&u.createElement(Bi,{dense:!0,label:b.Z.t("Size"),min:6,max:100,value:parseInt(void 0!==a?a:Y,10),onChange:e=>s(e+"px"),className:qi}),i&&u.createElement(mi,{color:mt(t)||J,onChange:i,button:!0}),o&&u.createElement(En.z,{icon:u.createElement(Di.Z,null),onClick:()=>{o("bold"===n?"normal":"bold")},secondary:!0,toggled:"bold"===n}),d&&u.createElement(En.z,{icon:u.createElement(Fi.Z,null),onClick:()=>{d("italic"===r?"normal":"italic")},secondary:!0,toggled:"italic"===r}))};$i.propTypes={className:f().string,color:f().string,fontStyle:f().string,size:f().oneOfType([f().string,f().number]),weight:f().string,onColorChange:f().func,onSizeChange:f().func,onStyleChange:f().func,onWeightChange:f().func};var Hi=a(61223);const zi="Help_help__7P-ad",Wi="Help_content__dogcj",Yi=e=>{let{children:t}=e;return u.createElement("div",{className:zi},u.createElement(Hi.Z,null),u.createElement("div",{className:Wi},t))};Yi.propTypes={children:f().node.isRequired};const Ji="IconButton_iconButton__7QtUX",Qi="IconButton_icon__uW+9Z",Ki=e=>{let{tooltip:t,onClick:a,className:n,children:r,dataTest:i}=e;const s=u.createElement("div",{className:Qi},r);return u.createElement("div",{onClick:a,className:Jn()(Ji,n),"data-test":i},t?u.createElement(ri.u,{content:t},s):s)};Ki.propTypes={children:f().node,className:f().string,dataTest:f().string,tooltip:f().string,onClick:f().func};const Xi="ImageSelect_imageSelect__S8yu-",es="ImageSelect_title__xJ8wS",ts="ImageSelect_imageContainer__dV03s",as="ImageSelect_imageContainerSelected__XcG8R",ns="ImageSelect_image__RTHOQ",rs="ImageSelect_noImage__fcKtR",is=e=>{let{id:t,img:a,title:n,isSelected:r,onClick:i,className:s}=e;return u.createElement("div",{className:Jn()(Xi,s),title:n,onClick:()=>i(t)},n?u.createElement("div",{className:es},n):null,u.createElement("div",{className:Jn()(ts,{[as]:r})},a?u.createElement("img",{src:a,className:ns}):u.createElement("div",{className:rs})))};is.propTypes={id:f().string.isRequired,onClick:f().func.isRequired,className:f().string,img:f().string,isSelected:f().bool,title:f().string};const ss=e=>{let{option:t,onDisplayOptionChange:a}=e;return u.createElement(Cs,{label:b.Z.t("Display"),loading:!1,items:[{id:W,name:b.Z.t("Name")},{id:"{name}\n{value}",name:b.Z.t("Name and value")},{id:"{value}",name:b.Z.t("Value")}],value:t||null,onChange:e=>{let{id:t}=e;return a(t)}})};ss.propTypes={onDisplayOptionChange:f().func.isRequired,option:f().string};const os="MenuButton_menuButton__tGXHP",ds=e=>{let{children:t,dataTest:a,disabled:n,name:r,onBlur:i,onClick:s,onFocus:o}=e;return u.createElement("button",{className:os,"data-test":a,disabled:n,name:r,onBlur:i,onClick:s,onFocus:o},t)};ds.propTypes={children:f().node,dataTest:f().string,disabled:f().bool,name:f().string,onBlur:f().func,onClick:f().func,onFocus:f().func};var ls=a(92718),cs=a(75125);const fs="RadioGroup_radioGroup__WKKLI",us="RadioGroup_row__B5Px0",ps=u.createContext(),ms=e=>{let{value:t,label:a,helpText:n,display:r,onChange:i,children:s,dataTest:o}=e;const[d,l]=(0,u.useState)(t);return(0,u.useEffect)((()=>{t!==d&&l(t)}),[t,d]),u.createElement(ps.Provider,{value:{radio:d,onChange:i}},u.createElement("div",{className:Jn()(fs,{[us]:"row"===r})},u.createElement(cs.N,{label:a,helpText:n,dataTest:o},s)))};ms.propTypes={onChange:f().func.isRequired,children:f().arrayOf(f().node),dataTest:f().string,display:f().string,helpText:f().string,label:f().string,value:f().oneOfType([f().string,f().number])};const bs=e=>{let{value:t,disabled:a,dense:n=!0,dataTest:r,label:i}=e;const{radio:s,onChange:o}=(0,u.useContext)(ps);return u.createElement(ls.Y,{label:i,dense:n,disabled:a,checked:t===s,onChange:()=>{t!==s&&o(t)},dataTest:r})};bs.propTypes={label:f().string.isRequired,dataTest:f().string,dense:f().bool,disabled:f().bool,value:f().oneOfType([f().string,f().number])};var gs=a(3376),ys=a(18275),hs=a(37126),Es=a(86484);const vs=e=>{const{dense:t=!0,errorText:a,helpText:n,warning:r,items:i,label:s,prefix:o,loading:d,multiple:l,disabled:c,onChange:f,className:p,value:m,dataTest:b}=e,g=!0===d,y=l?gs.n:ys.n,h=l?hs.M:Es.a;let E;E=l?Array.isArray(m)?m.map((e=>String(e))):[]:null!=m?String(m):"";const v=(0,u.useCallback)((e=>{let{selected:t}=e;return f(l?i.filter((e=>t.includes(String(e.id)))).map((e=>e.id)):i.find((e=>String(e.id)===t)))}),[i,l,f]);return u.createElement("div",{className:Jn()(ji,p)},u.createElement(y,{dense:t,label:s,prefix:o,selected:g?void 0:E,disabled:c,loading:g,error:!!a,warning:!!r,validationText:r||a,helpText:n,onChange:v,dataTest:b},i&&i.map((e=>{let{id:t,name:a}=e;return u.createElement(h,{key:t,value:String(t),label:a})}))))};vs.propTypes={className:f().string,dataTest:f().string,dense:f().bool,disabled:f().bool,errorText:f().string,helpText:f().string,items:f().arrayOf(f().shape({id:f().oneOfType([f().string,f().number]).isRequired,name:f().string})),label:f().string,loading:f().oneOfType([f().bool,f().string]),multiple:f().bool,prefix:f().string,value:f().oneOfType([f().string,f().number,f().arrayOf(f().oneOfType([f().string,f().number]))]),warning:f().string,onChange:f().func};const Cs=vs;var Ps=a(48556),Ss=a(61462);const _s=u.createContext(),ws=e=>{let{value:t,onChange:a,children:n}=e;const[r,i]=(0,u.useState)(t);return(0,u.useEffect)((()=>{t!==r&&i(t)}),[t,r]),u.createElement(_s.Provider,{value:{tab:r,onChange:a}},u.createElement(Ss.n,{fixed:!0},n))};ws.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired,value:f().string.isRequired,onChange:f().func.isRequired};const Ts=e=>{let{value:t,dataTest:a,children:n}=e;const{tab:r,onChange:i}=(0,u.useContext)(_s);return u.createElement(Ps.O,{selected:t===r,onClick:()=>{t!==r&&i(t)},dataTest:a},n)};Ts.propTypes={children:f().node.isRequired,value:f().string.isRequired,dataTest:f().string};const Ns=e=>{let{type:t,label:a,value:n,dense:r=!0,onChange:i,className:s}=e;return u.createElement("div",{className:Jn()(ji,s)},u.createElement(Ui.U,{dense:r,type:t,label:a,value:n,onChange:e=>{let{value:t}=e;return i(t)}}))};Ns.propTypes={label:f().string.isRequired,onChange:f().func.isRequired,className:f().string,dense:f().bool,type:f().string,value:f().string};const Os="ContextMenu_anchor__creaN",Zs="ContextMenu_menu__2SOPg",Rs=e=>{const{position:t,offset:a,feature:n,container:r,isSplitView:i,isOffline:s,onDrill:o,onClose:d}=e,l=(0,u.useRef)(),[c,f]=(0,u.useState)();(0,u.useEffect)((()=>{if(t){const[e,n]=t;if(i){const[t,i]=a,{left:s,top:o}=r.getBoundingClientRect();f({left:t-s+e,top:i-o+n})}else f({left:e,top:n})}}),[t,a,r,i]);const{hasCoordinatesUp:p,hasCoordinatesDown:m}=n.properties;return u.createElement(u.Fragment,null,u.createElement("div",{ref:l,className:Os,style:c}),u.createElement(ni.J,{reference:l,arrow:!1,placement:"right",onClickOutside:d},u.createElement("div",{className:Zs},u.createElement(Zi,{condition:s,wrapper:e=>u.createElement(ri.u,{content:b.Z.t("Not available offline")},e)},u.createElement(ii.v,{dense:!0},u.createElement(si.s,{label:b.Z.t("Drill up one level"),icon:u.createElement(oi.Z,null),disabled:!p||s,onClick:()=>o("up")}),u.createElement(si.s,{label:b.Z.t("Drill down one level"),icon:u.createElement(di.Z,null),disabled:!m||s,onClick:()=>o("down")}))))))};Rs.propTypes={onClose:f().func.isRequired,onDrill:f().func.isRequired,container:f().instanceOf(Element),feature:f().object,isOffline:f().bool,isSplitView:f().bool,offset:f().array,position:f().array};const xs=Rs,As=e=>{let{radius:t,maxRadius:a,text:n,textAlign:r,color:i,stroke:s,pattern:o}=e;const d="left"===r,l=a,c=2*a-t,f=d?l-a-Ms:l+a+Ms,p=2*a-2*t,m=f+(d?-Ds:Ds),b=d?"end":"start";return u.createElement("g",null,u.createElement("circle",{cx:l,cy:c,r:t,stroke:s||"#000",style:{fill:o?`url(#${o})`:i||"none",strokeWidth:.5}}),n&&u.createElement("g",null,u.createElement("line",{x1:l,x2:f,y1:p,y2:p,stroke:"black",style:{strokeDasharray:"2, 2",strokeWidth:.5}}),u.createElement("text",{x:m,y:p,textAnchor:b,alignmentBaseline:"middle",style:{fontSize:12}},n)))};As.propTypes={maxRadius:f().number.isRequired,radius:f().number.isRequired,color:f().string,pattern:f().string,stroke:f().string,text:f().string,textAlign:f().oneOf(["left","right"])};const ks=As;function Ls(){return Ls=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Ls.apply(this,arguments)}const Is={paddingTop:10},Ms=16,Ds=4,Fs=e=>{let{radiusLow:t,radiusHigh:a,color:n,classes:r}=e;const i=2*a+4,s=(0,ha._b)().range([t,a]),o=s(.5);if(isNaN(t)||isNaN(a))return null;let d=[];if(Array.isArray(r)&&r.length){const e=r[0].startValue,t=r[r.length-1].endValue,n=s.domain([e,t]);d=[...r].reverse().map((e=>({radius:n(e.endValue),maxRadius:a,color:e.color,text:String(e.endValue)}))),d.push({radius:n(e),maxRadius:a,text:String(e)})}else{const e=n&&yt(n);d=[{radius:a,maxRadius:a,color:n,stroke:e,text:b.Z.t("Max")},{radius:o,maxRadius:a,color:n,stroke:e,text:b.Z.t("Mid")},{radius:t,maxRadius:a,color:n,stroke:e,text:b.Z.t("Min")}]}let l=Math.ceil(6.8*Math.max(ve(r,"startValue"),ve(r,"endValue")));const c=2*(a+Ms+Ds+l);let f=d.reduce(((e,t,a)=>{const n=e.radius-t.radius,r=void 0===e.gap||n<e.gap?n:e.gap;return a===d.length-1?Math.round(2*r):{radius:t.radius,gap:r}}));const p=c<245,m=p&&f>5&&f<12;if(p||(f/=2),f<6){const[e]=d,t=d[d.length-1],a=e.radius-t.radius,n=[0];if(a>6&&n.push(d.length-1),a>15){const e=t.radius+a/2,r=d.reduce(((t,a)=>a.radius>=e&&a.radius-e<t.radius-e?a:t));n.push(d.indexOf(r))}d.forEach(((e,t)=>{n.includes(t)||delete e.text}))}l=Math.ceil(6.8*ve(d,"text"));const g=l+Ms+Ds;return u.createElement("div",{style:Is},u.createElement("svg",{width:245,height:i+20},u.createElement("g",{transform:`translate(${m?g:"2"} 10)`},d.map(((e,t)=>u.createElement(ks,Ls({key:t},e,{textAlign:m&&t%2==0?"left":"right"})))))))};Fs.propTypes={radiusHigh:f().number.isRequired,radiusLow:f().number.isRequired,classes:f().array,color:f().string};const Us=Fs,js="LegendItemRange_legendItemRange__IgIK+",Gs=e=>{let{name:t="",startValue:a,endValue:n,count:r}=e;return u.createElement("td",{className:js},isNaN(a)?t:`${t} ${a} - ${n}`,void 0!==r?` (${r})`:"")};Gs.propTypes={count:f().number,endValue:f().number,name:f().string,startValue:f().number};const Bs=Gs,Vs=e=>{let{color:t,weight:a}=e;return u.createElement("svg",{viewBox:"0 0 24 24",style:{width:24,height:24}},u.createElement("path",{stroke:t,fill:t,strokeWidth:a/2,d:"M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"}))};Vs.propTypes={color:f().string,weight:f().number};const qs=Vs,$s=e=>{let{color:t,fill:a="none",weight:n}=e;return u.createElement("svg",{viewBox:"0 0 24 24",style:{width:24,height:24}},u.createElement("path",{fill:a,stroke:t,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",d:"M 3.5 18.5 l 7.5 2.5 l 11 -2 L 19 12 l 3 -4 l -8 -3 l -8 2 L 2 14 z"}))};$s.propTypes={color:f().string,fill:f().string,weight:f().number};const Hs=$s,zs="LegendItem_legendItem__Jjz38",Ws=e=>{let{type:t,image:a,color:n,strokeColor:r,fillColor:i,radius:s,weight:o,name:d,startValue:l,endValue:c,count:f}=e;if(!d&&void 0===l)return null;const p={backgroundImage:a?`url(${a})`:"none",backgroundColor:n||"transparent"};if(r&&(p.border=`1px solid ${r}`),s){const e=2*Math.min(s,15);p.width=`${e}px`,p.height=`${e}px`,p.borderRadius="50%"}return u.createElement("tr",{className:zs,"data-test":"layerlegend-item"},u.createElement("th",null,o?"LineString"===t?u.createElement(qs,{color:n,weight:o}):u.createElement(Hs,{color:r||n,fill:i,weight:o}):u.createElement("span",{style:p})),u.createElement(Bs,{name:d,startValue:l,endValue:c,count:f}))};Ws.propTypes={color:f().string,count:f().number,endValue:f().number,fillColor:f().string,image:f().string,name:f().string,radius:f().number,startValue:f().number,strokeColor:f().string,type:f().string,weight:f().number};const Ys=Ws,Js="Legend_legend__eAr+e",Qs="Legend_description__EmtXT",Ks="Legend_legendImage__bYIN+",Xs="Legend_filters__eMkd8",eo="Legend_group__J8bob",to="Legend_unit__7lYDI",ao="Legend_explanation__eeeOy",no="Legend_source__0a062";function ro(){return ro=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ro.apply(this,arguments)}const io=e=>{let{description:t,filters:a,groups:n,unit:r,items:i,bubbles:s,explanation:o,url:d,source:l,sourceUrl:c}=e;return u.createElement("dl",{className:Js,"data-test":"layerlegend"},t&&u.createElement("div",{className:Qs},t),n&&u.createElement("div",{className:eo},n.length>1?b.Z.t("Groups"):b.Z.t("Group"),n.map((e=>{let{id:t,name:a}=e;return u.createElement("div",{key:t},a)}))),r&&i&&u.createElement("div",{className:to},r),s?u.createElement(Us,ro({},s,{classes:i})):Array.isArray(i)&&u.createElement("table",null,u.createElement("tbody",null,i.map(((e,t)=>u.createElement(Ys,ro({},e,{key:`item-${t}`})))))),d&&u.createElement("img",{className:Ks,src:d}),Array.isArray(a)&&u.createElement("div",{className:Xs},u.createElement("div",null,b.Z.t("Filters"),":"),a.map(((e,t)=>u.createElement("div",{key:t},e)))),Array.isArray(o)&&u.createElement("div",{className:ao},o.map(((e,t)=>u.createElement("div",{key:t},e)))),l&&u.createElement("div",{className:no},b.Z.t("Source"),": ",c?u.createElement("a",{href:c,target:"_blank",rel:"noreferrer"},l):u.createElement("span",null,l)))};io.propTypes={bubbles:f().shape({radiusHigh:f().number.isRequired,radiusLow:f().number.isRequired,color:f().string}),description:f().string,explanation:f().array,filters:f().array,groups:f().array,items:f().array,source:f().string,sourceUrl:f().string,unit:f().string,url:f().string};const so=io,oo=e=>{let{id:t,legend:a,alerts:n=[]}=e;return u.createElement("div",{key:t},a&&u.createElement(u.Fragment,null,u.createElement("h2",{className:"dhis2-map-legend-title"},a.title,u.createElement("span",{className:"dhis2-map-legend-period"},a.period)),u.createElement(so,a)),n.map(((e,t)=>u.createElement("div",{key:t,className:"dhis2-map-legend-alert"},e.message))))};oo.propTypes={id:f().string.isRequired,alerts:f().array,data:f().array,layer:f().string,legend:f().object,serverCluster:f().bool};const lo=oo;function co(){return co=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},co.apply(this,arguments)}const fo=e=>{let{layers:t}=e;const[a,n]=(0,u.useState)(!1),r=t.filter((e=>e.legend||e.alerts)).reverse();return u.createElement("div",{className:"dhis2-map-legend"},a?u.createElement("div",{className:"dhis2-map-legend-content",onMouseLeave:()=>n(!1)},r.map((e=>u.createElement(lo,co({key:e.id},e))))):u.createElement("div",{className:"dhis2-map-legend-button",title:b.Z.t("Legend"),onMouseEnter:()=>n(!0)}))};fo.propTypes={layers:f().array.isRequired};const uo=fo,po="MapName_mapName__AmPf2",mo="MapName_name__L6ybp map_box__Qmg+b",bo=e=>{let{name:t}=e;return u.createElement("div",{className:po},u.createElement("div",{className:mo},t))};bo.propTypes={name:f().string};const go=bo,yo="Plugin_plugin__WWp2m";function ho(){return ho=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ho.apply(this,arguments)}const Eo=[[-18.7,-34.9],[50.2,35.9]],vo=(0,u.forwardRef)(((e,t)=>{const{offline:a}=(0,n.kr)(),[r,o]=(0,u.useState)([]),[d,l]=(0,u.useState)(),[c,f]=(0,u.useState)(0),{name:p,basemap:m,mapViews:b,hideTitle:g,controls:y,getResizeFunction:h}=e,E=()=>f((e=>e+1)),v=(0,u.useCallback)((e=>o((t=>t.map((t=>e.id===t.id?e:t))))),[]);(0,u.useEffect)((()=>{o(b)}),[b]),(0,u.useEffect)((()=>{h&&h(E)}),[h]);return r.find((e=>!e.isLoaded))?u.createElement(i.M,null,u.createElement(s.V,null),r.map((e=>u.createElement(ja,{key:e.id,config:e,onLoad:v})))):u.createElement("div",{ref:t,className:`dhis2-map-plugin ${yo}`},u.createElement(Oe.z,null),u.createElement(Ze.k,{colors:!0,spacers:!0,theme:!0}),!g&&u.createElement(go,{name:p}),u.createElement(ai,{isPlugin:!0,isFullscreen:!1,basemap:m,layers:r,controls:y,bounds:Eo,openContextMenu:l,resizeCount:c}),u.createElement(uo,{layers:r}),d&&u.createElement(xs,ho({},d,{onDrill:async e=>{const{layerId:t,feature:a}=d;let n;if(t&&a){const{level:i,id:s,parentGraph:d,grandParentId:c,grandParentParentGraph:f}=a.properties,u=r.find((e=>e.id===t));n="up"===e?ke(u,c,f,parseInt(i)-1):ke(u,s,d,parseInt(i)+1),o(r.map((e=>e.id===t?n:e))),l()}},onClose:()=>l(),isOffline:a})))}));vo.displayName="Plugin",vo.propTypes={basemap:f().object,controls:f().array,getResizeFunction:f().func,hideTitle:f().bool,mapViews:f().array,name:f().string},vo.defaultProps={hideTitle:!1};const Co=vo;function Po(){return Po=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Po.apply(this,arguments)}const So=e=>{let{visualization:t}=e;const{basemap:a,mapViews:r,userOrgUnit:i,...s}=t,o=(0,n.bQ)(),{keyBingMapsApiKey:d,keyDefaultBaseMap:l}=(0,u.useContext)(ae),[c,f]=(0,u.useState)(null),p=(0,u.useMemo)((()=>((e,t)=>ce(le(oe(e,t))))({basemapId:a,mapViews:r},l)),[a,r,l]);return(0,u.useEffect)((()=>{p.mapViews&&(async()=>{var e;const{basemap:t}=await Ne({basemapId:a,keyDefaultBaseMap:l,keyBingMapsApiKey:d,engine:o});f({...p,mapViews:i?null===(e=p.mapViews)||void 0===e?void 0:e.map((e=>({...e,userOrgUnit:i}))):p.mapViews,basemap:t})})()}),[a,o,p,d,l,i]),c?u.createElement(Co,Po({},c,s)):u.createElement(m,null)};So.propTypes={visualization:f().object};const _o=So,wo={schemas:["dataElement","dataSet","externalMapLayer","indicator","legendSet","map","optionSet","organisationUnitGroup","organisationUnitGroupSet","organisationUnitLevel","programStage"]},To=e=>u.createElement(p.D,{d2Config:wo},(t=>{let{d2:a,d2Error:n}=t;return a||n?u.createElement(se,null,u.createElement(ae.Consumer,null,(t=>t.keyDefaultBaseMap?u.createElement(_o,e):null))):u.createElement(m,null)}));function No(){return No=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},No.apply(this,arguments)}const Oo=()=>u.createElement(r.m,null,u.createElement(i.M,null,u.createElement(s.V,null))),Zo=e=>{let{id:t,children:a,cacheNow:r,isParentCached:i}=e;const{startRecording:s,isCached:o,remove:l}=(0,n.Of)(t);return(0,u.useEffect)((()=>{r&&s({onError:console.error})}),[r]),(0,u.useEffect)((()=>{const e=d().on("removeCachedData",{window:window.top},(()=>l()));return()=>e.cancel()}),[l]),(0,u.useEffect)((()=>{!i&&o&&l()}),[i]),u.createElement(n.MW,{id:t,loadingMask:Oo},a)};Zo.propTypes={cacheNow:f().bool,children:f().node,id:f().string,isParentCached:f().bool};const Ro=()=>{const[e,t]=(0,u.useState)(),[a,n]=(0,u.useState)(null),r=e=>t(e.data);return(0,u.useEffect)((()=>{d().send(window.top,"getProps").then(r).catch((e=>console.error(e)));const e=d().on("newProps",{window:window.top},r);return()=>e.cancel()}),[]),(0,u.useLayoutEffect)((()=>{const e=(0,l.debounce)(300,(()=>n((e=>"number"==typeof e?e+1:1))));return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e?u.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},u.createElement(Zo,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},u.createElement(To,No({id:a},e)))):null}}}]);