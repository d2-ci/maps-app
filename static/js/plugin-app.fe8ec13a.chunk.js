"use strict";(self.webpackChunkmaps_app=self.webpackChunkmaps_app||[]).push([[2143],{37987:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Jl});var n=a(55642),r=a(78594),i=a(54479),o=a(46329),s=a(1006),l=a.n(s),d=a(91982),c=a(63665),f=a.n(c),u=a(2085),p=a(52430),m=a(53853),g=a(24710);const b="tileLayer",y="bingLayer",h="thematic",v="external",E="earthEngine",C="geoJson",S="BASEMAP",w="SINGLE",_="TIMELINE",P="SPLIT_BY_PERIOD",k="CHOROPLETH",A="BUBBLE",T=5,N=30,L=1e5,O="#333333",Z="psigeometry",R="#BB0000",x="#000000",M="#0000BB",D="#333333",F=6,I=1,U=2,G="COLOR",j="SYMBOL",V="{name}",q="14px",B="#333333",$="osmLight",z=()=>W()[0],W=()=>[{id:$,name:g.Z.t("OSM Light"),img:"images/osmlight.png",config:{type:b,url:"//cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="http://cartodb.com/attributions">CartoDB</a>'},isDark:!1},{id:"openStreetMap",name:g.Z.t("OSM Detailed"),img:"images/osm.png",config:{type:b,url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'},isDark:!1},{id:"bingLight",name:g.Z.t("Bing Road"),img:"images/bingroad.png",config:{type:y,style:"CanvasLight",apiKey:"AotYGLQC0RDcofHC5pWLaW7k854n-6T9mTunsev9LEFwVqGaVnG8b4KERNY9PeKA"},isDark:!1},{id:"bingDark",name:g.Z.t("Bing Dark"),img:"images/bingdark.png",config:{type:y,style:"CanvasDark"},isDark:!0},{id:"bingAerial",name:g.Z.t("Bing Aerial"),img:"images/bingaerial.jpeg",config:{type:y,style:"Aerial"},isDark:!0},{id:"bingHybrid",name:g.Z.t("Bing Aerial Labels"),img:"images/binghybrid.jpeg",config:{type:y,style:"AerialWithLabelsOnDemand"},isDark:!0}],Y={keyDefaultBaseMap:$};var H=a(68943),J=a(1789),Q=a(97363);const K=[Q.O5,Q.fW,Q.Nn,Q.MA,Q.GN,Q.P8,Q.FJ,Q.AP,Q.hy],X=e=>[...e?[{id:"RELATIVE_PERIODS",name:g.Z.t("Relative")}]:[],{id:Q.O5,name:g.Z.t("Daily"),group:Q.O5},{id:Q.fW,name:g.Z.t("Weekly"),group:Q.fW},{id:Q.At,name:g.Z.t("Weekly (Start Wednesday)"),group:Q.fW},{id:Q.bk,name:g.Z.t("Weekly (Start Thursday)"),group:Q.fW},{id:Q.BI,name:g.Z.t("Weekly (Start Saturday)"),group:Q.fW},{id:Q.Eu,name:g.Z.t("Weekly (Start Sunday)"),group:Q.fW},{id:Q.Nn,name:g.Z.t("Bi-weekly"),group:Q.Nn},{id:Q.MA,name:g.Z.t("Monthly"),group:Q.MA},{id:Q.GN,name:g.Z.t("Bi-monthly"),group:Q.GN},{id:Q.P8,name:g.Z.t("Quarterly"),group:Q.P8},{id:Q.FJ,name:g.Z.t("Six-monthly"),group:Q.FJ},{id:Q.xP,name:g.Z.t("Six-monthly April"),group:Q.FJ},{id:Q.AP,name:g.Z.t("Yearly"),group:Q.AP},{id:Q.y9,name:g.Z.t("Financial year (Start November)"),group:Q.hy},{id:Q.F9,name:g.Z.t("Financial year (Start October)"),group:Q.hy},{id:Q.tA,name:g.Z.t("Financial year (Start July)"),group:Q.hy},{id:Q.VG,name:g.Z.t("Financial year (Start April)"),group:Q.hy},{id:"START_END_DATES",name:g.Z.t("Start/end dates")}],ee="BY_YEAR",te="EE_MONTHLY",ae=["id","user","displayName~rename(name)","description","longitude","latitude","zoom","basemap","publicAccess","created","lastUpdated","access","update","manage","delete","href"],ne=e=>e.find((e=>e.renderingStrategy===P)),re=e=>{try{return JSON.parse(e).map((e=>e.toFixed(6))).join(", ")}catch(t){return e}},ie=e=>`${e.substring(0,10)} ${e.substring(11,16)}`,oe=(e,t)=>e.reduce(((e,a)=>a[t]&&String(a[t]).length>e.length?String(a[t]):e),"").length,se=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return X(e).filter((e=>{let{group:a}=e;return!t.includes(a)}))},le=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return K.filter((t=>!e.includes(t))).map((e=>(0,H.CU)(e).getPeriods())).flat()},de=/keyHide(.*)Periods/,ce=e=>Object.keys(e).filter((t=>de.test(t)&&e[t])).map((e=>e.match(de)[1].toUpperCase())),fe=e=>{const t=e.map((e=>{const t=(e=>{if(!e)throw new Error("The periodId cannot be null or empty.");const t=Object.keys(J._5).find((t=>e.match(J._5[t])));if(!t)throw new Error(`No matching period type found for periodId: ${e}`);return t})(e.id),a=(n=t,[Q.O5,Q.fW,Q.At,Q.bk,Q.BI,Q.Eu,Q.Nn,Q.MA,Q.GN,Q.P8,Q.FJ,Q.xP,Q.AP,Q.hy,Q.y9,Q.F9,Q.tA,Q.VG].indexOf(n));var n;return{...e,type:t,level:a}})),a=[...new Set(t.map((e=>e.level)))].sort(((e,t)=>t-e));const n=a.length;return{periodsWithTypeLevelAndRank:t.map((e=>({...e,levelRank:a.indexOf(e.level)}))),distinctLevelsCount:n}},ue=e=>e?e.sort(((e,t)=>t.level-e.level)).sort(((e,t)=>new Date(e.startDate)-new Date(t.startDate))):[],pe=()=>u.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",top:0}},u.createElement(i.M,null,u.createElement(o.V,null)));var me=a(57328),ge=a.n(me);const be={id:"operand",value:"operand",param:"dc",dimensionName:"dx",objectName:"dc",itemType:"DATA_ELEMENT_OPERAND"},ye={id:"organisationUnit",value:"organisationUnit",param:"ou",dimensionName:"ou",objectName:"ou"},he="abcdefghijklmnopqrstuvwxyz",ve=he.concat(he.toUpperCase()),Ee=`0123456789${ve}`,Ce=Ee.length,Se=11;function we(e){return Math.floor(Math.random()*e)}function _e(){let e=ve.charAt(we(ve.length));for(let t=1;t<Se;t+=1)e+=Ee.charAt(we(Ce));return e}const Pe=/^[a-zA-Z]{1}[a-zA-Z0-9]{10}$/,ke=e=>!!e&&Pe.test(e),Ae=(e,t)=>{const a=((e,t)=>t.filter((t=>t.dimension===e))[0])(e,t);return a&&a.items?a.items:[]},Te=function(){return Ae("dx",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0]},Ne=function(){return Ae("ou",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]},Le=function(){return Ae("pe",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])[0]},Oe=function(){return Ae("pe",arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])},Ze=e=>({...se().reduce(((e,t)=>{let{id:a,name:n}=t;return e[a]=n,e}),{}),...le().reduce(((e,t)=>{let{id:a,name:n}=t;return e[a]=n,e}),{})}[e]),Re=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>ke(e.dimension)||null===e.dimension))},xe=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>ke(e.dimension)&&e.items&&e.items.length))},Me=(e,t)=>{if(!t.includes(";")){if("IN"===e)return g.Z.t("is");if("!IN"===e)return g.Z.t("is not")}return{EQ:"=",GT:">",GE:">=",LT:"<",LE:"<=",NE:"!=",IN:g.Z.t("one of"),"!IN":g.Z.t("not one of"),LIKE:g.Z.t("contains"),"!LIKE":g.Z.t("doesn't contains")}[e]},De=(e,t,a)=>{if("IN"===t){if("1"===e)return g.Z.t("true");if("0"===e)return g.Z.t("false")}return e.split(";").map((e=>a[e]||e)).join(", ")};var Fe=a(65133),Ie=a(10002);const Ue=e=>{let t;return e>=1e3&&e<9500?t=(e/1e3).toFixed(1)+"k":e>=9500&&e<999500?t=Math.round(e/1e3)+"k":e>=999500&&e<195e4?t=(e/1e6).toFixed(1)+"M":e>195e4&&(t=Math.round(e/1e6)+"M"),t||e},Ge=e=>{if(void 0===e)return e=>e;const t=Math.pow(10,e);return e=>Math.round(e*t)/t},je=(e,t)=>e.find(((a,n)=>t>=a.startValue&&(t<a.endValue||(t=>t===e.length-1)(n)&&t==a.endValue))),Ve=(e,t,a)=>{const n=e[0],r=e[e.length-1];let i;return t===U?i=qe(n,r,a):3===t&&(i=Be(e,a)),i},qe=(e,t,a)=>{const n=[],r=(t-e)/a,i=(0,Ie.Z)(r,t),o=Ge(i);for(let i=0;i<a;i++){const s=e+i*r,l=i<a-1?s+r:t;n.push({startValue:o(s),endValue:o(l)})}return n},Be=(e,t)=>{const a=e[0],n=e[e.length-1],r=[],i=e.length/t,o=(0,Ie.Z)((n-a)/t,n),s=Ge(o);let l=0===i?0:i;if(e.length>0){r[0]=a;for(let a=1;a<t;a++)r[a]=e[Math.round(l)],l+=i}return r.filter((e=>void 0!==e)).map(((e,t)=>({startValue:s(e),endValue:s(r[t+1]||n)})))};var $e=a(9184);const ze={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:["#ffffcc","#d9f0a3","#addd8e","#78c679","#31a354","#006837"],7:["#ffffcc","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],8:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#005a32"],9:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"]},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#2c7fb8","#253494"],7:["#ffffcc","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],8:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#0c2c84"],9:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]},GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"],7:["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],8:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#08589e"],9:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"]},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2","#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#2ca25f","#006d2c"],7:["#edf8fb","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],8:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#005824"],9:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"]},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],6:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#1c9099","#016c59"],7:["#f6eff7","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],8:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016450"],9:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"]},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#2b8cbe","#045a8d"],7:["#f1eef6","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],8:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#034e7b"],9:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"]},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8856a7","#810f7c"],7:["#edf8fb","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],8:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#6e016b"],9:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"]},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#c51b8a","#7a0177"],7:["#feebe2","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],8:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177"],9:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"]},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:["#f1eef6","#d4b9da","#c994c7","#df65b0","#dd1c77","#980043"],7:["#f1eef6","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],8:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#91003f"],9:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"]},OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#e34a33","#b30000"],7:["#fef0d9","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],8:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#990000"],9:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"]},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c","#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:["#ffffb2","#fed976","#feb24c","#fd8d3c","#f03b20","#bd0026"],7:["#ffffb2","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],8:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],9:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"]},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e","#993404"],6:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"],7:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],8:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"],9:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"]},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#756bb1","#54278f"],7:["#f2f0f7","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],8:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#4a1486"],9:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"]},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"],7:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],8:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],9:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"]},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#31a354","#006d2c"],7:["#edf8e9","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],8:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#005a32"],9:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"]},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#e6550d","#a63603"],7:["#feedde","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],8:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#8c2d04"],9:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"]},Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"],7:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],8:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#99000d"],9:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc","#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#636363","#252525"],7:["#f7f7f7","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],8:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525"],9:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"]},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2","#5e3c99"],6:["#b35806","#f1a340","#fee0b6","#d8daeb","#998ec3","#542788"],7:["#b35806","#f1a340","#fee0b6","#f7f7f7","#d8daeb","#998ec3","#542788"],8:["#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788"],9:["#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788"],10:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],11:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"]},BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:["#8c510a","#d8b365","#f6e8c3","#c7eae5","#5ab4ac","#01665e"],7:["#8c510a","#d8b365","#f6e8c3","#f5f5f5","#c7eae5","#5ab4ac","#01665e"],8:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e"],9:["#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e"],10:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],11:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"]},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:["#762a83","#af8dc3","#e7d4e8","#d9f0d3","#7fbf7b","#1b7837"],7:["#762a83","#af8dc3","#e7d4e8","#f7f7f7","#d9f0d3","#7fbf7b","#1b7837"],8:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837"],9:["#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837"],10:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],11:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"]},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:["#c51b7d","#e9a3c9","#fde0ef","#e6f5d0","#a1d76a","#4d9221"],7:["#c51b7d","#e9a3c9","#fde0ef","#f7f7f7","#e6f5d0","#a1d76a","#4d9221"],8:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221"],9:["#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221"],10:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],11:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"]},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:["#b2182b","#ef8a62","#fddbc7","#d1e5f0","#67a9cf","#2166ac"],7:["#b2182b","#ef8a62","#fddbc7","#f7f7f7","#d1e5f0","#67a9cf","#2166ac"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"]},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],6:["#b2182b","#ef8a62","#fddbc7","#e0e0e0","#999999","#4d4d4d"],7:["#b2182b","#ef8a62","#fddbc7","#ffffff","#e0e0e0","#999999","#4d4d4d"],8:["#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d"],9:["#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d"],10:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],11:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"]},RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:["#d73027","#fc8d59","#fee090","#e0f3f8","#91bfdb","#4575b4"],7:["#d73027","#fc8d59","#fee090","#ffffbf","#e0f3f8","#91bfdb","#4575b4"],8:["#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4"],9:["#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"]},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:["#d53e4f","#fc8d59","#fee08b","#e6f598","#99d594","#3288bd"],7:["#d53e4f","#fc8d59","#fee08b","#ffffbf","#e6f598","#99d594","#3288bd"],8:["#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd"],9:["#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd"],10:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],11:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"]},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:["#d73027","#fc8d59","#fee08b","#d9ef8b","#91cf60","#1a9850"],7:["#d73027","#fc8d59","#fee08b","#ffffbf","#d9ef8b","#91cf60","#1a9850"],8:["#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850"],9:["#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850"],10:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],11:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f"],7:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17"],8:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02"],7:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d"],8:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"]},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a","#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c"],7:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f"],8:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00"],9:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6"],10:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a"],11:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99"],12:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"]},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc"],7:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd"],8:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec"],9:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae"],7:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc"],8:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"]},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33"],7:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628"],8:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf"],9:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"]},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f"],7:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494"],8:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"]},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462"],7:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69"],8:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5"],9:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9"],10:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd"],11:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5"],12:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"]},YlOrBr_reverse:{3:["#d95f0e","#fec44f","#fff7bc"],4:["#cc4c02","#fe9929","#fed98e","#ffffd4"],5:["#993404","#d95f0e","#fe9929","#fed98e","#ffffd4"],6:["#993404","#d95f0e","#fe9929","#fec44f","#fee391","#ffffd4"],7:["#8c2d04","#cc4c02","#ec7014","#fe9929","#fec44f","#fee391","#ffffd4"],8:["#8c2d04","#cc4c02","#ec7014","#fe9929","#fec44f","#fee391","#fff7bc","#ffffe5"],9:["#662506","#993404","#cc4c02","#ec7014","#fe9929","#fec44f","#fee391","#fff7bc","#ffffe5"]},Reds_reverse:{3:["#de2d26","#fc9272","#fee0d2"],4:["#cb181d","#fb6a4a","#fcae91","#fee5d9"],5:["#a50f15","#de2d26","#fb6a4a","#fcae91","#fee5d9"],6:["#a50f15","#de2d26","#fb6a4a","#fc9272","#fcbba1","#fee5d9"],7:["#99000d","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee5d9"],8:["#99000d","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee0d2","#fff5f0"],9:["#67000d","#a50f15","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee0d2","#fff5f0"]},YlGn_reverse:{3:["#31a354","#addd8e","#f7fcb9"],4:["#238443","#78c679","#c2e699","#ffffcc"],5:["#006837","#31a354","#78c679","#c2e699","#ffffcc"],6:["#006837","#31a354","#78c679","#addd8e","#d9f0a3","#ffffcc"],7:["#005a32","#238443","#41ab5d","#78c679","#addd8e","#d9f0a3","#ffffcc"],8:["#005a32","#238443","#41ab5d","#78c679","#addd8e","#d9f0a3","#f7fcb9","#ffffe5"],9:["#004529","#006837","#238443","#41ab5d","#78c679","#addd8e","#d9f0a3","#f7fcb9","#ffffe5"]},Greens_reverse:{3:["#31a354","#a1d99b","#e5f5e0"],4:["#238b45","#74c476","#bae4b3","#edf8e9"],5:["#006d2c","#31a354","#74c476","#bae4b3","#edf8e9"],6:["#006d2c","#31a354","#74c476","#a1d99b","#c7e9c0","#edf8e9"],7:["#005a32","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#edf8e9"],8:["#005a32","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#e5f5e0","#f7fcf5"],9:["#00441b","#006d2c","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#e5f5e0","#f7fcf5"]},Blues_reverse:{3:["#3182bd","#9ecae1","#deebf7"],4:["#2171b5","#6baed6","#bdd7e7","#eff3ff"],5:["#08519c","#3182bd","#6baed6","#bdd7e7","#eff3ff"],6:["#08519c","#3182bd","#6baed6","#9ecae1","#c6dbef","#eff3ff"],7:["#084594","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#eff3ff"],8:["#084594","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#deebf7","#f7fbff"],9:["#08306b","#08519c","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#deebf7","#f7fbff"]},BuPu_reverse:{3:["#8856a7","#9ebcda","#e0ecf4"],4:["#88419d","#8c96c6","#b3cde3","#edf8fb"],5:["#810f7c","#8856a7","#8c96c6","#b3cde3","#edf8fb"],6:["#810f7c","#8856a7","#8c96c6","#9ebcda","#bfd3e6","#edf8fb"],7:["#6e016b","#88419d","#8c6bb1","#8c96c6","#9ebcda","#bfd3e6","#edf8fb"],8:["#6e016b","#88419d","#8c6bb1","#8c96c6","#9ebcda","#bfd3e6","#e0ecf4","#f7fcfd"],9:["#4d004b","#810f7c","#88419d","#8c6bb1","#8c96c6","#9ebcda","#bfd3e6","#e0ecf4","#f7fcfd"]},RdPu_reverse:{3:["#c51b8a","#fa9fb5","#fde0dd"],4:["#ae017e","#f768a1","#fbb4b9","#feebe2"],5:["#7a0177","#c51b8a","#f768a1","#fbb4b9","#feebe2"],6:["#7a0177","#c51b8a","#f768a1","#fa9fb5","#fcc5c0","#feebe2"],7:["#7a0177","#ae017e","#dd3497","#f768a1","#fa9fb5","#fcc5c0","#feebe2"],8:["#7a0177","#ae017e","#dd3497","#f768a1","#fa9fb5","#fcc5c0","#fde0dd","#fff7f3"],9:["#49006a","#7a0177","#ae017e","#dd3497","#f768a1","#fa9fb5","#fcc5c0","#fde0dd","#fff7f3"]},PuRd_reverse:{3:["#dd1c77","#c994c7","#e7e1ef"],4:["#ce1256","#df65b0","#d7b5d8","#f1eef6"],5:["#980043","#dd1c77","#df65b0","#d7b5d8","#f1eef6"],6:["#980043","#dd1c77","#df65b0","#c994c7","#d4b9da","#f1eef6"],7:["#91003f","#ce1256","#e7298a","#df65b0","#c994c7","#d4b9da","#f1eef6"],8:["#91003f","#ce1256","#e7298a","#df65b0","#c994c7","#d4b9da","#e7e1ef","#f7f4f9"],9:["#67001f","#980043","#ce1256","#e7298a","#df65b0","#c994c7","#d4b9da","#e7e1ef","#f7f4f9"]},Greys_reverse:{3:["#636363","#bdbdbd","#f0f0f0"],4:["#525252","#969696","#cccccc","#f7f7f7"],5:["#252525","#636363","#969696","#cccccc","#f7f7f7"],6:["#252525","#636363","#969696","#bdbdbd","#d9d9d9","#f7f7f7"],7:["#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f7f7f7"],8:["#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f0f0f0","#ffffff"],9:["#000000","#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f0f0f0","#ffffff"]}},We=["YlOrBr","Reds","YlGn","Greens","Blues","BuPu","RdPu","PuRd","Greys","YlOrBr_reverse","Reds_reverse","YlGn_reverse","Greens_reverse","Blues_reverse","BuPu_reverse","RdPu_reverse","PuRd_reverse","Greys_reverse","PuOr","BrBG","PRGn","PiYG","RdBu","RdGy","RdYlBu","Spectral","RdYlGn","Paired","Pastel1","Set1","Set3"],Ye=(e,t)=>ze[e][t],He=5,Je=Ye("YlOrBr",He),Qe=e=>(0,d.isString)(e)?"##normal"===e?null:(/(^[0-9A-F]{6}$)|(^[0-9A-F]{3}$)/i.test(e)?"#":"")+e:e,Ke=e=>{const t=[...e];function a(){const e="#000000".replace(/0/g,(()=>(~~(16*Math.random())).toString(16)));return t.includes(e)?a():(t.push(e),e)}return e=>t[e]||a()},Xe=e=>(0,$e.Uc)(e).l<70,et=e=>Xe(e)?"#fff":"#000",tt={dimension:{resource:"indicators",id:e=>{let{id:t}=e;return t},params:{fields:"legendSet[id,displayName~rename(name)]"}}},at={dimension:{resource:"dataElements",id:e=>{let{id:t}=e;return t},params:{fields:"legendSet[id,displayName~rename(name)]"}}},nt={dimension:{resource:"dataSets",id:e=>{let{id:t}=e;return t},params:{fields:"legendSet[id,displayName~rename(name)]"}}},rt=e=>{const t=(0,d.pick)(["name","startValue","endValue","color"]);return(0,d.sortBy)("startValue",e.legends).map(t).map((e=>e.name===`${e.startValue} - ${e.endValue}`?{...e,name:""}:e))},it=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:He,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Je;return(e.length?Ve(e,t,a):[]).map(((e,t)=>({...e,color:n[t]})))},ot=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{columns:t=[],rows:a=[],filters:n=[]}=e;return[...t,...a,...n]},st=async e=>{let{ao:t={},dataId:a,isVisible:n=!0,engine:r}=e;const{yearlySeries:i,aggregationType:o="DEFAULT"}=t,s=(e=>{const t=ot(e).find((e=>"dx"===e.dimension));return t?t.items:[]})(t),l=ot(t),d=l.find((e=>"ou"===e.dimension)),c=Re(l);let f=l.find((e=>"pe"===e.dimension)),u=s[0];if(a&&(u=s.find((e=>e.id===a))),!u||!d||!f)return;const p=await(async(e,t)=>{if(!e)return null;let a=null;switch(e.dimensionItemType){case Fe.QB:a=await t.query(tt,{variables:{id:e.id}});break;case Fe.P6:a=await t.query(at,{variables:{id:e.id}});break;case Fe.MB:a=await t.query(nt,{variables:{id:e.id}});break;default:return null}return a.dimension.legendSet})(u,r);return i&&i.length&&(f={dimension:"pe",items:[{id:i[0],name:Ze(i[0])}]}),{layer:h,columns:[{dimension:"dx",items:[u]}],rows:[d],filters:[f,...c],aggregationType:o,legendSet:p,isVisible:n,opacity:.9}},lt=(e,t)=>ut(ft(dt(e,t))),dt=(e,t)=>{const a=e.mapViews.find((e=>e.layer===v&&"BASEMAP"===JSON.parse(e.config||{}).mapLayerPosition));let n,r=e.mapViews;return a?(n=JSON.parse(a.config),r=e.mapViews.filter((e=>e.id!==a.id))):n=(0,d.isString)(e.basemap)?"none"===e.basemap?{id:t,isVisible:!1}:{id:e.basemap}:(0,d.isObject)(e.basemap)?e.basemap:{id:t},{...e,basemap:n,mapViews:r}},ct={externalLayer:1,earthEngine:2,thematic4:3,thematic3:4,thematic2:5,thematic1:6,boundary:7,facility:8,event:9},ft=e=>{const{mapViews:t}=e;if(!t.some((e=>e.layer.match(/thematic[1-4]/))))return e;const a=(0,d.sortBy)((e=>ct[e.layer]),t).map((e=>({...e,layer:e.layer.replace(/\d$/,"")})));return{...e,mapViews:a}},ut=e=>e.mapViews.find((e=>"boundary"===e.layer||"string"==typeof e.colorScale))?{...e,mapViews:e.mapViews.map((e=>({...e,layer:"boundary"===e.layer?"orgUnit":e.layer,colorScale:"string"==typeof e.colorScale?e.colorScale.split(","):e.colorScale})))}:e,pt={resource:"maps",id:e=>{let{id:t}=e;return t},params:{fields:(()=>{const e=(()=>{const e="displayName~rename(name)";return["*",`columns[dimension,filter,items[dimensionItem~rename(id),dimensionItemType,${e}]]`,`rows[dimension,filter,items[dimensionItem~rename(id),dimensionItemType,${e}]]`,`filters[dimension,filter,items[dimensionItem~rename(id),dimensionItemType,${e}]]`,"organisationUnits[id,path]","dataDimensionItems",`program[id,${e}]`,"programStage[id,displayName~rename(name)]","legendSet[id,displayName~rename(name)]","trackedEntityType[id,displayName~rename(name)]","organisationUnitSelectionMode","!href","!publicAccess","!rewindRelativePeriods","!userOrganisationUnit","!userOrganisationUnitChildren","!userOrganisationUnitGrandChildren","!externalAccess","!access","!relativePeriods","!columnDimensions","!rowDimensions","!filterDimensions","!user","!organisationUnitGroups","!itemOrganisationUnitGroups","!userGroupAccesses","!indicators","!dataElements","!dataElementOperands","!dataElementGroups","!dataSets","!periods","!organisationUnitLevels","!sortOrder","!topLimit"]})();return`${ae.join(",")}, mapViews[${e.join(",")}]`})()}},mt={resource:"externalMapLayers",params:{fields:"id,displayName~rename(name),service,url,attribution,mapService,layers,imageFormat,mapLayerPosition,legendSet,legendSetUrl",paging:!1}},gt={resource:"externalMapLayers",id:e=>{let{id:t}=e;return t},params:{fields:"id,displayName~rename(name),service,url,attribution,mapService,layers,imageFormat,mapLayerPosition,legendSet,legendSetUrl"}},bt={optionSet:{resource:"optionSets",id:e=>{let{id:t}=e;return t},params:{fields:["id","displayName~rename(name)","options[id,code,displayName~rename(name)]"],paging:!1}}},yt={legendSet:{resource:"legendSets",id:e=>{let{id:t}=e;return t},params:{fields:["id","displayName~rename(name)","legends[id,displayName~rename(name),startValue,endValue,color]"],paging:!1}}},ht="GEOJSON_URL",vt={WMS:"wmsLayer",XYZ:b,TMS:b,VECTOR_STYLE:"vectorStyle",[ht]:C},Et=(Object.keys(vt),e=>({layer:v,id:e.id,name:e.name,opacity:1,config:Ct(e)})),Ct=e=>{const{id:t,name:a,attribution:n,mapService:r,url:i,layers:o,imageFormat:s,legendSet:l,legendSetUrl:d}=e;return{id:t,type:vt[r],url:i,attribution:n,name:a,layers:o,tms:"TMS"===r,format:"JPG"===s?"image/jpeg":"image/png",legendSet:l,legendSetUrl:d}},St=async(e,t)=>{let a;try{a=JSON.parse(e)}catch(e){return}if(a.id)try{const{externalLayer:e}=await t.query({externalLayer:gt},{variables:{id:a.id}});Ct(e).featureStyle={...a.featureStyle}}catch(e){return a}return a};const wt=async function(e){let{basemapId:t,basemapVisible:a,keyDefaultBaseMap:n,keyBingMapsApiKey:r,engine:i}=e;const o=await async function(e,t,a){try{let n=[];if(ke(e)||ke(t)){const{externalLayers:e}=await a.query({externalLayers:mt});n=e.externalMapLayers.filter((e=>e.mapLayerPosition===S)).map(Et)}return W().concat(n)}catch(e){return W()}}(t,n,i),s=o.find((e=>{let{id:a}=e;return a===t}))||o.find((e=>{let{id:t}=e;return t===n}))||z();return"bing"===s.id.substring(0,4)&&(s.config.apiKey=r),"boolean"==typeof a&&(s.isVisible=a),{basemap:s}};var _t=a(44829),Pt=a(93338);const kt=e=>(0,d.sortBy)("le",e).map((e=>{const t=JSON.parse(e.co);let a="",n="",r="Point";if(2===e.ty&&(r="Polygon","[[[["===e.co.substring(0,4)&&(r="MultiPolygon")),(0,d.isString)(e.pg)&&e.pg.length){const t=(0,d.compact)(e.pg.split("/"));t.length>=2&&(a=t[t.length-2]),t.length>2&&(n="/"+t.slice(0,t.length-2).join("/"))}return{type:"Feature",id:e.id,geometry:{type:r,coordinates:t},properties:{type:r,id:e.id,name:e.na,hasCoordinatesDown:e.hcd,hasCoordinatesUp:e.hcu,level:e.le,grandParentParentGraph:n,grandParentId:a,parentGraph:e.pg,parentId:e.pi,parentName:e.pn,dimensions:e.dimensions}}})).filter((e=>{let{geometry:t}=e;return Array.isArray(t.coordinates)&&t.coordinates.length&&t.coordinates.flat().length})),At=(e,t,a,n)=>({...e,rows:[{dimension:ye.objectName,items:[{id:t,path:`${a}/${t}`},{id:"LEVEL-"+n}]}],isLoaded:!1,isLoading:!1}),Tt=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.resize(),!t){const t=e.getLayersBounds();Array.isArray(t)&&e.fitBounds(t)}e.toggleMultiTouch(!t),e.toggleScrollZoom(t)};var Nt=a(67637);const Lt={critical:!0},Ot=e=>{let{msg:t}=e;return t},Zt="WARNING_NO_DATA",Rt="WARNING_NO_OU_COORD",xt="WARNING_NO_GEOMETRY_COORD",Mt="ERROR_CRITICAL",Dt="CUSTOM_ALERT",Ft={layer:E,layerId:"GOOGLE/Research/open-buildings/v3/polygons",datasetId:"GOOGLE/Research/open-buildings/v3/polygons",format:"FeatureCollection",img:"images/buildings.png",name:g.Z.t("Building footprints"),description:g.Z.t("The outlines of buildings derived from high-resolution satellite imagery. Only for Sub-Saharan Africa, South and South-East Asia, Latin America and the Caribbean."),notice:g.Z.t("Building counts are only available for smaller organisation unit areas."),error:g.Z.t("Select a smaller area or single organization unit to see the count of buildings."),source:"Google Research",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_Research_open-buildings_v3_polygons",unit:g.Z.t("Number of buildings"),resolution:{spatial:g.Z.t("0.5 meter"),temporal:g.Z.t("Single point in time"),temporalCoverage:g.Z.t("May 2023")},aggregations:["count"],defaultAggregations:["count"],style:{color:"#FFA500",strokeWidth:1},opacity:.9},It={layer:E,layerId:"USGS/SRTMGL1_003",datasetId:"USGS/SRTMGL1_003",format:"Image",img:"images/elevation.png",name:g.Z.t("Elevation"),description:g.Z.t("Elevation above sea-level."),source:"NASA / USGS / JPL-Caltech / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/USGS_SRTMGL1_003",unit:g.Z.t("meters"),resolution:{spatial:g.Z.t("~30 meters"),temporal:g.Z.t("Single point in time"),temporalCoverage:g.Z.t("Febuary 2000")},aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],band:"elevation",style:{min:0,max:1500,palette:["#ffffd4","#fee391","#fec44f","#fe9929","#d95f0e","#993404"]},maskOperator:"gte",opacity:.9},Ut={layer:E,layerId:"MODIS/006/MCD12Q1",datasetId:"MODIS/061/MCD12Q1",format:"ImageCollection",img:"images/landcover.png",name:g.Z.t("Landcover"),description:g.Z.t("Distinct landcover types collected from satellites."),source:"NASA LP DAAC / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/MODIS_061_MCD12Q1",resolution:{spatial:g.Z.t("0.5 meter"),temporal:g.Z.t("Single point in time"),temporalCoverage:g.Z.t("May 2023")},defaultAggregations:"percentage",periodType:"YEARLY",filters:[{type:"eq",arguments:["system:index","$1"]}],band:"LC_Type1",style:[{value:1,name:g.Z.t("Evergreen Needleleaf forest"),color:"#162103"},{value:2,name:g.Z.t("Evergreen Broadleaf forest"),color:"#235123"},{value:3,name:g.Z.t("Deciduous Needleleaf forest"),color:"#399b38"},{value:4,name:g.Z.t("Deciduous Broadleaf forest"),color:"#38eb38"},{value:5,name:g.Z.t("Mixed forest"),color:"#39723b"},{value:6,name:g.Z.t("Closed shrublands"),color:"#6a2424"},{value:7,name:g.Z.t("Open shrublands"),color:"#c3a55f"},{value:8,name:g.Z.t("Woody savannas"),color:"#b76124"},{value:9,name:g.Z.t("Savannas"),color:"#d99125"},{value:10,name:g.Z.t("Grasslands"),color:"#92af1f"},{value:11,name:g.Z.t("Permanent wetlands"),color:"#10104c"},{value:12,name:g.Z.t("Croplands"),color:"#cdb400"},{value:13,name:g.Z.t("Urban and built-up"),color:"#cc0202"},{value:14,name:g.Z.t("Cropland/Natural vegetation mosaic"),color:"#332808"},{value:15,name:g.Z.t("Snow and ice"),color:"#d7cdcc"},{value:16,name:g.Z.t("Barren or sparsely vegetated"),color:"#f7e174"},{value:17,name:g.Z.t("Water"),color:"#aec3d6"}],popup:"{name}: {value}",opacity:.9},Gt="GOOGLE/Research/open-buildings/v1/polygons",jt={legacy:!0,layer:E,layerId:Gt,datasetId:Gt,format:"FeatureCollection",name:g.Z.t("Building footprints"),unit:g.Z.t("Number of buildings"),description:g.Z.t("The outlines of buildings derived from high-resolution satellite imagery. Only for the continent of Africa."),notice:g.Z.t("Building counts are only available for smaller organisation unit areas."),error:g.Z.t("Select a smaller area or single organization unit to see the count of buildings."),source:"Google Research",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/GOOGLE_Research_open-buildings_v1_polygons",img:"images/buildings.png",aggregations:["count"],defaultAggregations:["count"],style:{color:"#FFA500",strokeWidth:1},opacity:.9},Vt="NOAA/DMSP-OLS/NIGHTTIME_LIGHTS",qt={legacy:!0,layer:E,format:"ImageCollection",layerId:Vt,datasetId:Vt,name:g.Z.t("Nighttime lights"),unit:g.Z.t("light intensity"),description:g.Z.t("Light intensity from cities, towns, and other sites with persistent lighting, including gas flares."),source:"NOAA / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/NOAA%2FDMSP-OLS%2FNIGHTTIME_LIGHTS",periodType:"YEARLY",filters:[{type:"eq",arguments:["system:index","$1"]}],band:"stable_lights",img:"images/nighttime.png",style:{min:0,max:63,palette:["#ffffd4","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#8c2d04"]},maskOperator:"gte",opacity:.9},Bt={layer:E,legacy:!0,layerId:"WorldPop/POP",datasetId:"WorldPop/POP",format:"ImageCollection",name:g.Z.t("Population"),unit:g.Z.t("people per km²"),description:g.Z.t("Estimated number of people living in an area."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/WorldPop%2FPOP",img:"images/population.png",periodType:"YEARLY",band:"population",filters:[{type:"eq",arguments:["year","$1"]},{type:"eq",arguments:["UNadj","yes"]}],mosaic:!0,style:{min:0,max:1e3,palette:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"]},methods:{multiply:[100]},maskOperator:"gt",opacity:.9},$t={layer:E,legacy:!0,layerId:"WorldPop/GP/100m/pop",datasetId:"WorldPop/GP/100m/pop",name:g.Z.t("Population"),unit:g.Z.t("people per hectare"),description:g.Z.t("Estimated number of people living in an area."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/WorldPop_GP_100m_pop",img:"images/population.png",defaultAggregations:["sum","mean"],periodType:"YEARLY",band:"population",filters:[{type:"eq",arguments:["year","$1"]}],mosaic:!0,style:{min:0,max:10,palette:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"]},maskOperator:"gt",opacity:.9},zt={legacy:!0,layer:E,format:"ImageCollection",layerId:"UCSB-CHG/CHIRPS/PENTAD",datasetId:"UCSB-CHG/CHIRPS/PENTAD",name:g.Z.t("Precipitation"),unit:g.Z.t("millimeter"),description:g.Z.t("Precipitation collected from satellite and weather stations on the ground. The values are in millimeters within 5 days periods. Updated monthly, during the 3rd week of the following month."),source:"UCSB / CHG / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/UCSB-CHG%2FCHIRPS%2FPENTAD",periodType:ee,filters:[{type:"eq",arguments:["system:index","$1"]}],band:"precipitation",aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],img:"images/precipitation.png",style:{min:0,max:100,palette:["#eff3ff","#c6dbef","#9ecae1","#6baed6","#3182bd","#08519c"]},maskOperator:"gte",opacity:.9},Wt={legacy:!0,layer:E,format:"ImageCollection",layerId:"MODIS/006/MOD11A2",datasetId:"MODIS/006/MOD11A2",img:"images/temperature.png",name:g.Z.t("Temperature MODIS"),unit:g.Z.t("°C during daytime"),description:g.Z.t("Land surface temperatures collected from satellite. Blank spots will appear in areas with a persistent cloud cover."),source:"NASA LP DAAC / Google Earth Engine",sourceUrl:"https://explorer.earthengine.google.com/#detail/MODIS%2FMOD11A2",aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],band:"LST_Day_1km",periodType:ee,filters:[{type:"eq",arguments:["system:index","$1"]}],methods:[{name:"toFloat",arguments:[]},{name:"multiply",arguments:[.02]},{name:"subtract",arguments:[273.15]}],style:{min:0,max:40,palette:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},maskOperator:"gte",opacity:.9},Yt={layer:E,layerId:"WorldPop/GP/100m/pop_age_sex_cons_unadj",datasetId:"WorldPop/GP/100m/pop_age_sex_cons_unadj",format:"ImageCollection",img:"images/population.png",name:g.Z.t("Population age groups"),description:g.Z.t("Estimated number of people living in an area, grouped by age and gender."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/WorldPop_GP_100m_pop_age_sex_cons_unadj",unit:g.Z.t("people per hectare"),resolution:{spatial:g.Z.t("~100 meters"),temporal:g.Z.t("Single point in time"),temporalCoverage:g.Z.t("2020")},aggregations:["min","max","mean","median","sum","stdDev","variance"],defaultAggregations:["sum","mean"],unmaskAggregation:!0,periodType:"YEARLY",filters:[{type:"eq",arguments:["year","$1"]}],bands:[{id:"M_0",name:g.Z.t("Male 0 - 1 years")},{id:"M_1",name:g.Z.t("Male 1 - 4 years")},{id:"M_5",name:g.Z.t("Male 5 - 9 years")},{id:"M_10",name:g.Z.t("Male 10 - 14 years")},{id:"M_15",name:g.Z.t("Male 15 - 19 years")},{id:"M_20",name:g.Z.t("Male 20 - 24 years")},{id:"M_25",name:g.Z.t("Male 25 - 29 years")},{id:"M_30",name:g.Z.t("Male 30 - 34 years")},{id:"M_35",name:g.Z.t("Male 35 - 39 years")},{id:"M_40",name:g.Z.t("Male 40 - 44 years")},{id:"M_45",name:g.Z.t("Male 45 - 49 years")},{id:"M_50",name:g.Z.t("Male 50 - 54 years")},{id:"M_55",name:g.Z.t("Male 55 - 59 years")},{id:"M_60",name:g.Z.t("Male 60 - 64 years")},{id:"M_65",name:g.Z.t("Male 65 - 69 years")},{id:"M_70",name:g.Z.t("Male 70 - 74 years")},{id:"M_75",name:g.Z.t("Male 75 - 79 years")},{id:"M_80",name:g.Z.t("Male 80 years and above")},{id:"F_0",name:g.Z.t("Female 0 - 1 years")},{id:"F_1",name:g.Z.t("Female 1 - 4 years")},{id:"F_5",name:g.Z.t("Female 5 - 9 years")},{id:"F_10",name:g.Z.t("Female 10 - 14 years")},{id:"F_15",name:g.Z.t("Female 15 - 19 years")},{id:"F_20",name:g.Z.t("Female 20 - 24 years")},{id:"F_25",name:g.Z.t("Female 25 - 29 years")},{id:"F_30",name:g.Z.t("Female 30 - 34 years")},{id:"F_35",name:g.Z.t("Female 35 - 39 years")},{id:"F_40",name:g.Z.t("Female 40 - 44 years")},{id:"F_45",name:g.Z.t("Female 45 - 49 years")},{id:"F_50",name:g.Z.t("Female 50 - 54 years")},{id:"F_55",name:g.Z.t("Female 55 - 59 years")},{id:"F_60",name:g.Z.t("Female 60 - 64 years")},{id:"F_65",name:g.Z.t("Female 65 - 69 years")},{id:"F_70",name:g.Z.t("Female 70 - 74 years")},{id:"F_75",name:g.Z.t("Female 75 - 79 years")},{id:"F_80",name:g.Z.t("Female 80 years and above")}],style:{min:0,max:10,palette:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"]},maskOperator:"gt",opacity:.9,mosaic:!0,tileScale:4},Ht={layer:E,layerId:"WorldPop/GP/100m/pop_age_sex_cons_unadj_TOTAL",datasetId:"WorldPop/GP/100m/pop_age_sex_cons_unadj",format:"ImageCollection",img:"images/population.png",name:g.Z.t("Population"),description:g.Z.t("Estimated number of people living in an area."),source:"WorldPop / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/WorldPop_GP_100m_pop_age_sex_cons_unadj",unit:g.Z.t("people per hectare"),resolution:{spatial:g.Z.t("~100 meters"),temporal:g.Z.t("Single point in time"),temporalCoverage:g.Z.t("2020")},aggregations:["min","max","mean","median","sum","stdDev","variance"],defaultAggregations:["sum","mean"],unmaskAggregation:!0,periodType:"YEARLY",filters:[{type:"eq",arguments:["year","$1"]}],band:"population",style:{min:0,max:25,palette:["#fee5d9","#fcbba1","#fc9272","#fb6a4a","#de2d26","#a50f15"]},maskOperator:"gt",opacity:.9,mosaic:!0},Jt={layer:E,layerId:"ECMWF/ERA5_LAND/MONTHLY_AGGR/total_precipitation_sum",datasetId:"ECMWF/ERA5_LAND/MONTHLY_AGGR",format:"ImageCollection",img:"images/precipitation.png",name:g.Z.t("Precipitation monthly"),description:g.Z.t("Accumulated liquid and frozen water, including rain and snow, that falls to the surface. Combines model data with observations from across the world."),source:"Copernicus Climate Data Store / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/ECMWF_ERA5_LAND_MONTHLY_AGGR",unit:g.Z.t("millimeter"),resolution:{spatial:g.Z.t("~11 kilometers"),temporal:g.Z.t("Monthly"),temporalCoverage:g.Z.t("Febuary 1950 - One month ago")},aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],periodType:te,filters:[{type:"eq",arguments:["system:index","$1"]}],band:"total_precipitation_sum",methods:[{name:"multiply",arguments:[1e3]}],style:{min:0,max:700,palette:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"]},maskOperator:"gt",opacity:.9},Qt={layer:E,layerId:"ECMWF/ERA5_LAND/MONTHLY_AGGR/temperature_2m",datasetId:"ECMWF/ERA5_LAND/MONTHLY_AGGR",format:"ImageCollection",img:"images/temperature.png",name:g.Z.t("Temperature monthly"),description:g.Z.t("Temperature at 2m above the surface. Combines model data with observations from across the world."),source:"Copernicus Climate Data Store / Google Earth Engine",sourceUrl:"https://developers.google.com/earth-engine/datasets/catalog/ECMWF_ERA5_LAND_MONTHLY_AGGR",unit:"°C",resolution:{spatial:g.Z.t("~11 kilometers"),temporal:g.Z.t("Monthly"),temporalCoverage:g.Z.t("Febuary 1950 - One month ago")},aggregations:["min","max","mean","median","stdDev","variance"],defaultAggregations:["mean","min","max"],periodType:te,filters:[{type:"eq",arguments:["system:index","$1"]}],band:"temperature_2m",methods:[{name:"toFloat",arguments:[]},{name:"subtract",arguments:[273.15]}],style:{min:0,max:35,palette:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"]},opacity:.9},Kt=[Ht,Yt,Ft,It,Jt,Qt,Ut,jt,qt,$t,Bt,zt,Wt],Xt=([Ht,Yt,Ft,It,Jt,Qt,Ut].map((e=>e.layerId)),e=>Kt.find((t=>t.layerId===e)));var ea=a(17682);const ta=()=>({acres:g.Z.t("acres"),Area:g.Z.t("Area"),Cancel:g.Z.t("Cancel"),"Center map on area":g.Z.t("Center map on area"),"Center map on line":g.Z.t("Center map on line"),"Click the next position":g.Z.t("Click the next position"),"Click where you want to start the measurement":g.Z.t("Click where you want to start the measurement"),Delete:g.Z.t("Delete"),Distance:g.Z.t("Distance"),"Enter fullscreen":g.Z.t("Enter fullscreen"),"Exit fullscreen":g.Z.t("Exit fullscreen"),"Finish measurement":g.Z.t("Finish measurement"),ha:g.Z.t("ha"),km:g.Z.t("km"),"Measure distances and areas":g.Z.t("Measure distances and areas"),mi:g.Z.t("mi"),"No data":g.Z.t("No data"),Perimeter:g.Z.t("Perimeter"),"Reset bearing to north":g.Z.t("Reset bearing to north"),"Search for place or address":g.Z.t("Search for place or address"),"Zoom in":g.Z.t("Zoom in"),"Zoom out":g.Z.t("Zoom out"),"Zoom to content":g.Z.t("Zoom to content")}),aa=e=>{const t=`${e.baseUrl}/dhis-web-maps/fonts/{fontstack}/{range}.pbf`,a=document.createElement("div");return a.className="dhis2-map",a.style.width="100%",a.style.height="100%",new ea.ZP(a,{...e,locale:ta(),glyphs:t})},na=async(e,t,a)=>{const n=await(0,Nt.s8)(),r={headers:{"Content-Type":"application/json"},credentials:"include"};t&&a&&(r.method=t,(0,d.isString)(a)?(r.headers["Content-Type"]="text/html",r.body=a):(0,d.isObject)(a)&&(r.body=JSON.stringify(a)));const i=n.Api.getApi().baseUrl;return fetch(encodeURI(i+e),r).then((e=>["POST","PUT","PATCH"].includes(t)?e:(async e=>{const t=await e.text();return""===t?void 0:JSON.parse(t)})(e))).catch((e=>console.log("Error: ",e)))},ra="en",ia=e=>e&&e.includes("_")?e.replace("_","-"):e,oa=e=>Array.isArray(e)?new Date(e[0],e[1],e[2]):new Date(e),sa=e=>e.substr(0,10),la=void 0!==a.g.Intl&&Intl.DateTimeFormat,da=function(e,t){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return la?new Intl.DateTimeFormat(ia(t||g.Z.language||ra),{year:a?"numeric":void 0,month:"short",day:"numeric"}).format(oa(e)):sa(e)},ca=(e,t,a,n)=>{const r=a||g.Z.language||ra;return`${da(e,r,n)} - ${da(t,a,n)}`},fa=e=>[parseInt(e.substring(0,4)),parseInt(e.substring(5,7))-1,parseInt(e.substring(8,10))],ua=["percentage","hectares","acres"],pa=e=>ua.includes(e),ma=(e,t)=>{if(e&&t)return function(e){for(var t=arguments.length,a=new Array(t>1?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];return e.map((e=>({...e,arguments:e.arguments.map((e=>{const t=e.match(/^\$([0-9]+)$/);return t?a[t[1]-1]:e}))})))}(t,e.id)},ga=/^\D+/g,ba=()=>new Promise((async(e,t)=>{const a=await na("/tokens/google").catch((()=>t(new Error(g.Z.t("Cannot get authorization token for Google Earth Engine.")))));a&&"ERROR"===a.status&&t(new Error(g.Z.t("This layer requires a Google Earth Engine account. Check the DHIS2 documentation for more information."))),e({token_type:"Bearer",...a})}));const ya=["#1f78b4","#ff7f00","#33a02c","#a6cee3","#b2df8a","#fb9a99","#fdbf6f","#cab2d6","#ffff99","#b15928","#6a3d9a","#e31a1c"],ha=e=>{let{organisationUnitGroups:t}=e;t.sort(((e,t)=>e.name.localeCompare(t.name)));const a=(e=>{const t=e.filter((e=>!e.color)),a=Ke(ya);return e=>{const n=t.findIndex((t=>t.id===e.id));return a(n)}})(t),n=(e=>{const t=e.filter((e=>!e.symbol));return e=>{const a=t.findIndex((t=>t.id===e.id));return a<5?`${21+a}.png`:"25.png"}})(t);return t.map((e=>({...e,color:e.color||a(e),symbol:e.symbol||n(e)})))},va={groupSets:{resource:"organisationUnitGroupSets",id:e=>{let{id:t}=e;return t},params:{fields:["organisationUnitGroups[id,name,color,symbol]"]}}},Ea={orgUnit:{resource:"organisationUnits",id:e=>{let{id:t}=e;return t},params:e=>{let{nameProperty:t}=e;return{fields:[`${t}~rename(name)`]}}}},Ca=e=>e.filter((e=>1===e.ty)),Sa=e=>e.filter((e=>2===e.ty)),wa=(e,t)=>t&&t.organisationUnitGroups&&e&&e[t.id]?t.organisationUnitGroups.find((a=>a.id===e[t.id])):{},_a=function(){let e=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((a=>{let{name:n,color:r=!0,symbol:i}=a;return e?{name:n,color:r}:{name:n,image:`${t}/images/orgunitgroup/${i}`}}))},Pa=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{organisationUnitColor:a=D,radiusLow:n=F}=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;const{name:o,styleType:s=(i?G:j),organisationUnitGroups:l=[]}=t,c=!i;let f,u=[];if(!c){const t=(0,d.uniqBy)((e=>e.properties.level),e).map((e=>e.properties.level)).sort();f=e=>Math.pow(t.length-t.indexOf(e),1.2),u=t.map((e=>({name:i[e],color:a,weight:f(e)})))}const p=s===G;let m=e.map((e=>{const a="Point"===e.geometry.type,{hasAdditionalGeometry:i}=e.properties,{color:o,symbol:s}=wa(e.properties.dimensions,t);let l;a&&(l=i?I+1:n);const d={...e.properties,radius:l};return p&&o?d.color=i?D:o:s&&(d.iconUrl=`${r}/images/orgunitgroup/${s}`),d.level&&f&&(d.weight=f(e.properties.level)),{...e,properties:d}}));c&&t.id&&!p&&(m=m.filter((e=>e.properties.iconUrl)));const b=_a(l,p,r),y=c&&!t.id?[{name:g.Z.t("Facility"),color:a,radius:n}]:[];return{styledFeatures:m,legend:{unit:o,items:[...u,...b,...y]}}},ka=e=>{let{orgUnitField:t,orgUnitFieldDisplayName:a}=e;return t&&"none"!==t?{id:t,name:a}:null},Aa=(e,t)=>t?e.filter((e=>{const a=t.find((t=>t.id===e.id));return"Point"===e.geometry.type&&(!a||"Point"!==a.geometry.type)})).map((e=>t.find((t=>t.id===e.id))?{...e,properties:{...e.properties,hasAdditionalGeometry:!0}}:e)).concat(t):e,Ta=(e,t)=>{let{min:a,max:n,palette:r}=e;const i=(n-a)/(r.length-(t?2:1)),o=(0,Ie.Z)(i,n),s=Ge(o);let l=s(a),d=s(a+i);return r.map(((e,r)=>{const o={color:e};return 0===r&&t?(o.from=-1/0,o.to=a,o.name="< "+a,d=a):+l<n?(o.from=+l,o.to=+d,o.name=l+" - "+d):(o.from=+l,o.name="> "+l),l=d,d=s(a+i*(r+(t?1:2))),o}))},Na=async e=>{let{config:t,nameProperty:a}=e;const{format:n,rows:r,aggregationType:i}=t,o=Ne(r),s=ka(t),l=[];let d,c,f={};if(o&&o.length){const e=await(0,Nt.s8)(),t=o.map((e=>e.id));let n,r;const i=e.geoFeatures.byOrgUnit(t).displayProperty(a);try{n=await i.getAll().then(kt),s&&(r=await i.getAll({coordinateField:s.id}).then(kt),r.length||l.push({code:xt,message:s.name})),c=Aa(n,r),c.length||l.push({code:Rt,message:g.Z.t("Earth Engine layer")})}catch(e){l.push({code:Mt,message:e.message||e})}}if("string"==typeof t.config){if(f=JSON.parse(t.config),f.image){var u;const e=null===(u=f.filter)||void 0===u?void 0:u[0];if(e){var p;const t=null===(p=e.arguments)||void 0===p?void 0:p[1],a=String(f.image),n="string"==typeof t&&t.length>4?parseInt(t.substring(0,4),10):void 0;f.period={id:t,name:a,year:n},delete f.filter}delete f.image}else f.filter&&(f.period=((e,t)=>{if(!Array.isArray(e)||!e.length)return null;const a=t===Vt,{id:n,name:r,year:i,arguments:o}=e[0];let s=n||o[1];return!a&&ga.test(s)&&(s=Number(s.replace(ga,""))),{id:s,name:r,year:i}})(L,f.id),delete f.filter);f.params&&(f.style=f.params,"string"==typeof f.params.palette&&(f.style.palette=f.params.palette.split(",")),delete f.params),d=Xt(f.id),d&&delete f.id,delete t.config,delete t.filters}else d=Xt(f.id);const m={...d,...t,...f},{unit:b,period:y,filters:h,description:v,source:E,sourceUrl:C,band:S,bands:w,style:_,maskOperator:P}=m,{name:k}=d||t,A=Array.isArray(c)&&c.length?c:void 0,T=S&&Array.isArray(w)&&w.length?w.filter((e=>Array.isArray(S)?S.includes(e.id):S===e.id)):null,N={...m.legend,items:Array.isArray(_)?_:null,title:k,period:null==y?void 0:y.name,groups:T,unit:b,description:v,source:E,sourceUrl:C};"FeatureCollection"!==n&&!pa(i)&&null!=_&&_.palette&&(N.items=Ta(_,!P));const L=ma(y,h);return{...m,legend:N,name:k,data:A,filter:L,alerts:l,isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0}};var La=a(11864);const Oa=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Function.prototype;const t=(0,La.VY)(Ot,{critical:!0,onHidden:e}),a=(0,La.VY)(Ot,{warning:!0,onHidden:e}),n=(0,La.VY)(Ot,{info:!0,duration:5e3,onHidden:e}),r=(0,La.VY)(Ot,{warning:!0,onHidden:e}),i=(0,La.VY)((e=>{let{msg:t}=e;return t}),{warning:!0,onHidden:e}),o=(0,La.VY)(Ot,{warning:!0,onHidden:e});return{showAlerts:e=>{e.forEach((e=>{let{message:s,code:l,warning:d,critical:c}=e;switch(l){case Zt:r.show({msg:`${s}: ${g.Z.t("No data found")}`});break;case Rt:i.show({msg:g.Z.t("Selected org units: No coordinates found",{nsSeparator:"^^"})});break;case xt:o.show({msg:`${s}: ${g.Z.t("No coordinates found")}`});break;case Mt:t.show({msg:`${g.Z.t("Error")}: ${s}`});break;case Dt:c?t.show({msg:s}):d?a.show({msg:s}):n.show({msg:s})}}))}}},Za=e=>{let{config:t,onLoad:a,loaderAlertAction:n}=e;const{showAlerts:r}=Oa(n),{currentUser:i}=(0,p.Z)(),o=i.keyAnalysisDisplayProperty.toUpperCase();return(0,u.useEffect)((()=>{Na({config:t,nameProperty:o}).then((e=>{var t;null!==(t=e.alerts)&&void 0!==t&&t.length&&n&&r(e.alerts),a(e)}))}),[t,a,r,n,o]),null};Za.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired,loaderAlertAction:f().func};const Ra=Za,xa="COMPLETED",Ma=["AGE","INTEGER","INTEGER_NEGATIVE","INTEGER_POSITIVE","INTEGER_ZERO_OR_POSITIVE","NUMBER","PERCENTAGE","UNIT_INTERVAL"];var Da=a(1051),Fa=a.n(Da);const Ia="psi",Ua=(e,t,a,n,r,i)=>{const o=i(n),s=n.reduce(((n,i,s)=>{const l=e[s];let d;return l.optionSet&&(d=a.find((e=>e.code===i))),{id:r,type:null==o?void 0:o.type,...n,[t[l.name]||l.name]:d?d.name:i}}),{});return{type:"Feature",id:r,properties:s,geometry:o}},Ga=e=>{const t=Fa()(e,(e=>"geometry"===e.name));return e=>JSON.parse(e[t])},ja=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const a={...e.headers.reduce(((e,t)=>({...e,[t.name]:t.column})),{}),...t.columnNames},n=t.idCol||Ia,r=Fa()(e.headers,(e=>e.name===n)),i=Ga(e.headers,t&&t.eventCoordinateField),o=Object.values(e.metaData.items),s=e.rows.map((n=>Ua(e.headers,"ID"!==t.outputIdScheme?a:{},o,n,n[r],i)));return s.sort((e=>"Polygon"===e.geometry.type?-1:0)),{data:s,names:a}},Va="number",qa="string",Ba="__dhis2propertyid__",$a="Point",za="Polygon",Wa="MultiPolygon",Ya="LineString",Ha="Feature",Ja="FeatureCollection",Qa=[$a,Ya,za,"MultiPoint","MultiLineString",Wa],Ka={programStage:{resource:"programStages",id:e=>{let{id:t}=e;return t},params:e=>{let{nameProperty:t}=e;return{fields:`programStageDataElements[displayInReports,dataElement[id,code,${t}~rename(name),optionSet,valueType]]`,paging:!1}}}},Xa=e=>{let{dimension:t,filter:a,items:n}=e;return Boolean(t&&(a||!n||n.length))},en="name",tn=async(e,t)=>{let{program:a,programStage:n,filters:r,startDate:i,endDate:o,rows:s,columns:l,styleDataItem:d,eventStatus:c,eventCoordinateField:f=Z,fallbackCoordinateField:u,relativePeriodDate:p,isExtended:m}=e,{d2:g,nameProperty:b,engine:y}=t;const h=Ne(s),v=Le(r),E=((e,t)=>t&&!e.find((e=>e.dimension===t.id))?[...e,{dimension:t.id,name:t.name}]:[...e])(l.filter(Xa),d);if(m){const e=await(async(e,t)=>{let{format:a=en,nameProperty:n,engine:r}=t;const{programStage:i}=await r.query(Ka,{variables:{id:e.programStage.id,nameProperty:n}});return i.programStageDataElements.filter((e=>e.displayInReports)).map((e=>({dimension:e.dataElement.id,name:e.dataElement[a]})))})({programStage:n},{engine:y,nameProperty:b});e.forEach((e=>{E.find((t=>t.dimension===e.dimension))||E.push(e)}))}let C=(new g.analytics.request).withProgram(a.id).withStage(n.id).withCoordinatesOnly(!0);return C=v?C.addPeriodFilter(v.id):C.withStartDate(i).withEndDate(o),p&&(C=C.withRelativePeriodDate(p)),C=C.addOrgUnitDimension(h.map((e=>e.id))),E&&E.forEach((e=>{C=C.addDimension(e.dimension,e.filter)})),C=C.withCoordinateField(f),u&&(C="cascading"===u?C.withParameters({defaultCoordinateFallback:!0}):C.withParameters({fallbackCoordinateField:u})),c&&"ALL"!==c&&(C=C.withEventStatus(c)),C},an=async(e,t)=>{const{styleDataItem:a,data:n,legend:r,eventPointRadius:i}=e,{id:o,name:s,values:l}=a;return e.data=n.map((e=>{const t=e.properties[o]||"0";return t?{...e,properties:{...e.properties,value:"1"===t?g.Z.t("Yes"):g.Z.t("No"),color:"1"===t?l.true:l.false}}:e})),r.unit=s||await t.query(sn,{variables:{id:o}}).then((e=>{let{dataElement:t}=e;return t.name})),r.items=[{name:g.Z.t("Yes"),color:l.true,radius:i||6}],l.false&&r.items.push({name:g.Z.t("No"),color:l.false,radius:i||6}),e},nn=async(e,t)=>{const{styleDataItem:a,method:n,classes:r,colorScale:i,eventPointRadius:o,data:s}=e;if(1===n){const{legendSet:a}=await t.query(yt,{variables:{id:e.legendSet.id}});e.legend.unit=a.name,e.legend.items=rt(a)}else{const o=s.map((e=>Number(e.properties[a.id]))).sort(((e,t)=>e-t));e.legend.unit=a.name||await t.query(sn,{variables:{id:a.id}}).then((e=>{let{dataElement:t}=e;return t.name})),e.legend.items=it(o,n,r,i)}e.legend.items.forEach((e=>{e.radius=o||6,e.count=0}));const l=(0,d.curry)(je)(e.legend.items);return e.data=e.data.map((e=>{const t=Number(e.properties[a.id]),n=l(t);return n&&n.count++,{...e,properties:{...e.properties,value:t,color:n?n.color:null}}})),e},rn=async(e,t)=>{const{styleDataItem:a}=e,n=await on(a.optionSet,t),r=a.id;e.styleDataItem={...a,name:n.name,optionSet:n};const i=n.options.reduce(((e,t)=>(e[t.name.toLowerCase()]=t,e)),{});return e.data=e.data.map((e=>{const t=e.properties[r];if(t){const a=i[t.toLowerCase()];if(a)return{...e,properties:{...e.properties,value:a.name,color:a.style.color}}}return e})),e.legend.unit=n.name,e.legend.items=n.options.map((t=>({name:t.name,color:t.style.color,radius:e.eventPointRadius||6}))),e},on=async(e,t)=>{if(e.name)return e;const{optionSet:a}=await t.query(bt,{variables:{id:e.id}});return{...e,name:a.name,options:e.options.map((e=>({...a.options.find((t=>t.id===e.id)),...e})))}},sn={dataElement:{resource:"dataElements",id:e=>{let{id:t}=e;return t},params:{fields:"displayName~rename(name)"}}},ln={warning:!0,code:Dt,message:g.Z.t("You don't have access to this layer data")},dn={warning:!0,code:Dt,message:g.Z.t("The event filter is not supported")},cn={critical:!0,code:Dt,message:g.Z.t("An unknown error occurred while reading layer data")},fn=async e=>{let{config:t,loadExtended:a,engine:n,nameProperty:r}=e;const{columns:i,endDate:o,eventStatus:s,eventClustering:l,eventPointColor:d,eventPointRadius:c,filters:f,programStage:u,startDate:p,styleDataItem:m,areaRadius:b}=t,y=Le(f),h=function(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((e=>e.filter));return e.length?e:null}(i),v=await(0,Nt.s8)();t.isExtended=a;const E=await tn(t,{d2:v,nameProperty:r,engine:n});let C;if(t.name=u.name,t.legend={title:t.name,period:y?Ze(y.id):ca(fa(p),fa(o)),items:[]},delete t.serverCluster,l&&!m){const e=await un(E);t.bounds=(e=>{if(!e)return null;const t=e.match(/([-\d.]+)/g);return[[t[0],t[1]],[t[2],t[3]]]})(e.extent),t.serverCluster=e.count>2e3}if(!t.serverCluster){t.outputIdScheme="ID";const{names:e,data:a,response:r}=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;const n=await a.analytics.events.getQuery(e.withPageSize(L)),{data:r,names:i}=ja(n,t);return{data:r,names:i,response:n}}(E,t,v),{total:i}=r.metaData.pager;t.data=a,Array.isArray(t.data)&&t.data.length?(m&&await(async(e,t)=>{const{styleDataItem:a}=e;return a.optionSet?await rn(e,t):Ma.includes(a.valueType)?await nn(e,t):"BOOLEAN"===a.valueType&&await an(e,t),e.legend.items.push({name:g.Z.t("Not set"),color:Qe(e.eventPointColor)||O,radius:e.eventPointRadius||6}),e})(t,n),i>L&&(C={warning:!0,code:Dt,message:`${t.name}: ${g.Z.t("Displaying first {{pageSize}} events out of {{total}}",{pageSize:L,total:i})}`})):C={code:Zt,message:t.name},t.legend.filters=h&&function(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((t=>{let{dimension:a,filter:n}=t;const[r,i]=n.split(":");return`${e[a]} ${Me(r,i)} ${De(i,r,e)}`}))}(h,{...e,...await pn(h,r.headers,n)}),t.headers=r.headers;const o=t.headers.filter((e=>ke(e.name)&&Ma.includes(e.valueType)));o.length&&(t.data=t.data.map((e=>{const t={...e};return o.forEach((a=>{t.properties[a.name]=parseFloat(e.properties[a.name])})),t})))}if(!m){const e=Qe(d)||O,a=et(e);t.legend.items=[{name:g.Z.t("Event"),color:e,strokeColor:a,radius:c||6}]}const S=[];s&&S.push(`${g.Z.t("Event status")}: ${[{id:"ALL",name:g.Z.t("All")},{id:"ACTIVE",name:g.Z.t("Active")},{id:xa,name:g.Z.t("Completed")}].find((e=>e.id===s)).name}`),b&&S.push(`${g.Z.t("Buffer")}: ${b} m`),S.length&&(t.legend.explanation=S),C&&(t.alerts=[C])},un=async e=>{const t=await(0,Nt.s8)();return await t.analytics.events.getCount(e)},pn=async(e,t,a)=>{if(!e)return null;const n=e.map((e=>t.find((t=>t.name===e.dimension)))).filter((e=>e.optionSet)).map((e=>e.optionSet));if(!n.length)return;return(await Promise.all(n.map((e=>a.query(bt,{variables:{id:e}}))))).map((e=>{let{optionSet:t}=e;return t.options.reduce(((e,t)=>{let{code:a,name:n}=t;return e[a]=n,e}),{})})).reduce(((e,t)=>({...e,...t})),{})},mn=async e=>{let{layerConfig:t,loadExtended:a,engine:n,nameProperty:r}=e;const i={...t};try{await fn({config:i,loadExtended:a,engine:n,nameProperty:r})}catch(e){403===e.httpStatusCode||409===e.httpStatusCode?i.alerts=[e.message.includes("filter is invalid")?dn:ln]:i.alerts=[cn]}return i.isLoaded=!0,i.isLoading=!1,i.isExpanded=!0,i.isVisible=!0,i},gn=e=>{let{config:t,dataTableOpen:a,onLoad:r,loaderAlertAction:i}=e;const{showAlerts:o}=Oa(i),{currentUser:s}=(0,p.Z)(),l=(0,n.bQ)(),d=s.keyAnalysisDisplayProperty;return(0,u.useEffect)((()=>{mn({layerConfig:t,loadExtended:a,engine:l,nameProperty:d}).then((e=>{var t;null!==(t=e.alerts)&&void 0!==t&&t.length&&i&&o(e.alerts),r(e)}))}),[t,r,a,l,d,o,i]),null};gn.propTypes={config:f().object.isRequired,dataTableOpen:f().bool.isRequired,onLoad:f().func.isRequired,loaderAlertAction:f().func};const bn=gn,yn=async e=>{let t,{config:a,engine:n}=e;t="string"==typeof a.config?await St(a.config,n):{...a.config};const r={title:t.name};if(t.legendSet){const{legendSet:e}=await n.query(yt,{variables:{id:t.legendSet.id}});r.items=rt(e)}return t.legendSetUrl&&(r.url=t.legendSetUrl),{...a,layer:v,name:t.name,legend:r,config:t,isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0}},hn=e=>{let{config:t,onLoad:a}=e;const r=(0,n.bQ)();return(0,u.useEffect)((()=>{yn({config:t,engine:r}).then(a)}),[t,a,r]),null};hn.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const vn=hn,En=async e=>{let{config:t,engine:a,nameProperty:n,baseUrl:r}=e;const{rows:i,organisationUnitGroupSet:o,areaRadius:s}=t,l=Ne(i),d=!!o,c=ka(t),f=[],u=l.map((e=>e.id));let p;const m=await(0,Nt.s8)(),b=g.Z.t("Facilities"),y=m.geoFeatures.byOrgUnit(u).displayProperty(n),h=[y.getAll({includeGroupSets:d}).then(Ca).then(kt).catch((e=>{(null!=e&&e.message||e)&&f.push({code:Mt,message:e.message})}))];if(d&&!o.organisationUnitGroups){const e=a.query(va,{variables:{id:o.id}});h.push(e)}const[v,E]=await Promise.all(h);if(E){const{groupSets:e}=E;o.organisationUnitGroups=ha({organisationUnitGroups:e.organisationUnitGroups})}const{styledFeatures:C,legend:S}=Pa(v,o,t,r);return S.title=b,c&&(p=await y.getAll({coordinateField:c.id,includeGroupSets:d}).then(Sa).then(kt),p.length||f.push({code:xt,message:c.name}),S.items.push({name:c.name,type:"polygon",strokeColor:"#333",fillColor:"rgba(149, 200, 251, 0.5)",weight:.5})),s&&(S.explanation=[`${s} m buffer`]),C.length||f.push({warning:!0,code:Dt,message:g.Z.t("No coordinates found for selected facilities")}),{...t,data:C,associatedGeometries:p,name:b,legend:S,alerts:f,isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0}},Cn=e=>{let{config:t,onLoad:a,loaderAlertAction:r}=e;const{showAlerts:i}=Oa(r),{currentUser:o}=(0,p.Z)(),{baseUrl:s}=(0,n.zw)(),l=o.keyAnalysisDisplayProperty.toUpperCase(),d=(0,n.bQ)();return(0,u.useEffect)((()=>{En({config:t,engine:d,nameProperty:l,baseUrl:s}).then((e=>{var t;null!==(t=e.alerts)&&void 0!==t&&t.length&&r&&i(e.alerts),a(e)}))}),[t,a,d,l,s,i,r]),null};Cn.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired,loaderAlertAction:f().func};const Sn=Cn,wn={},_n=async(e,t,a)=>{const{config:n}=e;let r,i,o,s;"string"==typeof n?(r=await St(n,t),i={...r.featureStyle}||wn,delete r.featureStyle):(r={...n},i=e.featureStyle||wn);try{o=await(async(e,t,a)=>{if(e.includes(a)){const a=e.indexOf("routes");if(-1===a)throw new Error;return t.query({geojson:{resource:e.slice(a)}}).then((async e=>e.geojson instanceof Blob?JSON.parse(await e.geojson.text()):e.geojson)).catch((()=>{throw new Error}))}return fetch(e).then((e=>{if(!e.ok)throw new Error;return e.json()})).catch((()=>{throw new Error}))})(r.url,t,a)}catch(e){s=g.Z.t("There was a problem with this layer. Contact a system administrator.")}let l=[];const d={title:r.name,items:[]};if(!s){const{featureCollection:e,types:t}=(e=>{let t=e;if(e.type===Ha)t={type:Ja,features:[e]};else if(Qa.includes(e.type))t={type:Ja,features:[{type:Ha,geometry:e,properties:{}}]};else if("GeometryCollection"===e.type){const a=e.geometries.map((e=>({type:Ha,geometry:e,properties:{}})));t={type:Ja,features:a}}const a=[];return{featureCollection:t.features.map(((e,t)=>{const n=e.geometry.type.replace("Multi","");return a.includes(n)||a.push(n),e.properties.id||(e.properties.id=`${Ba}${t}`),e})),types:a}})(o);l=e;const a=1===t.length;t.forEach((e=>{let t;t=e===za?{name:a?g.Z.t("Feature"):g.Z.t("Polygon"),type:za,...i,fillColor:i.color}:e===Ya?{name:a?g.Z.t("Feature"):g.Z.t("Line"),type:Ya,...i,color:i.strokeColor}:{name:a?g.Z.t("Feature"):g.Z.t("Point"),type:$a,radius:i.pointSize,color:i.color,strokeColor:i.strokeColor},d.items.push(t)}))}return{...e,name:r.name,legend:d,data:l,config:r,featureStyle:i,isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0,loadError:s}},Pn=e=>{let{config:t,onLoad:a}=e;const r=(0,La.VY)(Ot,Lt),i=(0,n.bQ)(),{systemInfo:o}=(0,n.zw)(),{instanceBaseUrl:s}=o;return(0,u.useEffect)((()=>{_n(t,i,s).then((e=>(e.loadError&&r.show({msg:g.Z.t("{{layername}}: {{message}}",{layername:e.name,message:e.loadError,nsSeparator:"^^"})}),a(e))))}),[t,a,i,s,r]),null};Pn.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired};const kn=Pn,An={orgUnitLevels:{resource:"organisationUnitLevels",params:{fields:"id,level,displayName~rename(name)",paging:!1}}},Tn=async e=>{let{config:t,engine:a,nameProperty:n,baseUrl:r}=e;const{rows:i,organisationUnitGroupSet:o}=t,s=Ne(i).map((e=>e.id)),l=!!o,d=ka(t),c=await(0,Nt.s8)(),f=g.Z.t("Organisation units"),u=[],p=c.geoFeatures.byOrgUnit(s).displayProperty(n);let m;const b=[p.getAll({includeGroupSets:l}).then(kt).catch((e=>{(null!=e&&e.message||e)&&u.push({code:Mt,message:(null==e?void 0:e.message)||e})}))],y=a.query(An);if(b.push(y),l&&!o.organisationUnitGroups){const e=a.query(va,{variables:{id:o.id}});b.push(e)}const[h=[],{orgUnitLevels:v},E]=await Promise.all(b);if(h.length||u.length||u.push({code:Rt,message:g.Z.t("Org unit layer")}),E){const{groupSets:e}=E;o.organisationUnitGroups=ha({organisationUnitGroups:e.organisationUnitGroups})}d&&(m=await p.getAll({coordinateField:d.id,includeGroupSets:l}).then(kt),m.length||u.push({code:xt,message:d.name}));const C=Aa(h,m),{styledFeatures:S,legend:w}=Pa(C,o,t,r,v.organisationUnitLevels.reduce(((e,t)=>({...e,[t.level]:t.name})),{}));return w.title=f,{...t,data:S,name:f,legend:w,alerts:u,isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0}},Nn=e=>{let{config:t,onLoad:a,loaderAlertAction:r}=e;const{showAlerts:i}=Oa(r),{currentUser:o}=(0,p.Z)(),{baseUrl:s}=(0,n.zw)(),l=o.keyAnalysisDisplayProperty.toUpperCase(),d=(0,n.bQ)();return(0,u.useEffect)((()=>{Tn({config:t,engine:d,nameProperty:l,baseUrl:s}).then((e=>{var t;null!==(t=e.alerts)&&void 0!==t&&t.length&&r&&i(e.alerts),a(e)}))}),[t,a,d,l,s,i,r]),null};Nn.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired,loaderAlertAction:f().func};const Ln=Nn;var On=a(77527);const Zn=e=>{let{dimensions:t,items:a}=e;return t.pe.map((e=>{const{name:t,startDate:n,endDate:r}=a[e],i=new Date(r);return i.setHours(24),{id:e,name:t,startDate:new Date(n),endDate:i}}))},Rn=e=>{const{headers:t,rows:a}=e,n=(0,d.findIndex)(["name","pe"],t),r=(0,d.findIndex)(["name","ou"],t),i=(0,d.findIndex)(["name","value"],t);return a.reduce(((e,t)=>{const a=t[n];return(e[a]=e[a]||{})[t[r]]={value:t[i]},e}),{})},xn=e=>{const{headers:t,rows:a}=e,n=(0,d.findIndex)(["name","ou"],t),r=(0,d.findIndex)(["name","value"],t);return a.reduce(((e,t)=>(e[t[n]]=parseFloat(t[r]),e)),{})},Mn=e=>{const{headers:t,rows:a}=e,n=(0,d.findIndex)(["name","value"],t);return a.map((e=>parseFloat(e[n]))).sort(((e,t)=>e-t))},Dn=async(e,t)=>{const{rows:a,columns:n,filters:r,startDate:i,endDate:o,userOrgUnit:s,valueType:l,relativePeriodDate:d,aggregationType:c,renderingStrategy:f=w,eventStatus:u}=e,p=Ne(a),m=Oe(r),g=xe(e.filters),b=Te(n)||{},y=ka(e),h=n[0].dimension===be.objectName,v=f===w,E=await(0,Nt.s8)(),C={},S=p.map((e=>e.id));let _=h?b.id.split(".")[0]:b.id;"ds"===l&&(_+=".REPORTING_RATE");let P=(new E.analytics.request).addOrgUnitDimension(p.map((e=>e.id))).addDataDimension(_).withDisplayProperty(t);P=v?m.length>0?P.addPeriodFilter(m.map((e=>e.id))):P.withStartDate(i.slice(0,10)).withEndDate(o.slice(0,10)):P.addPeriodDimension(m.map((e=>e.id))),g&&g.forEach((e=>P=P.addFilter(e.dimension,e.items.map((e=>e.id))))),Array.isArray(s)&&s.length&&(C.userOrgUnit=s.join(";"),P=P.withUserOrgUnit(s)),d&&(P=P.withRelativePeriodDate(d)),c&&(P=P.withAggregationType(c)),h&&(P=P.addDimension("co")),u===xa&&(P=P.withParameters({completedOnly:!0}));const k=E.geoFeatures.byOrgUnit(S).displayProperty(t),A=[k.getAll(C).then(kt),E.analytics.aggregate.get(P)];return y&&A.push(k.getAll({...C,coordinateField:y.id}).then(kt)),Promise.all(A)},Fn=async e=>{let{config:t,engine:a,nameProperty:n}=e;const{columns:r,radiusLow:i=T,radiusHigh:o=N,classes:s,colorScale:l,renderingStrategy:c=w,thematicMapType:f,noDataColor:u}=t,p=Te(r),m=ka(t);let b;const y=await Dn(t,n).catch((e=>{b=e,e.message&&(b="E7124"===e.errorCode&&e.message.includes("dx")?g.Z.t("Data item was not found"):e.message)}));if(!y)return{...t,...b?{alerts:[{code:Mt,message:b}]}:{},name:p?p.name:g.Z.t("Thematic layer"),data:[],legend:null,isLoaded:!0,isLoading:!1,isVisible:!0,loadError:b};const[h,v,E]=y,C=Aa(h,E),S=c===w,_=f===A,P=10===t.method,k=(e=>{let{metaData:t,headers:a}=e;return{...Object.keys(t.items).reduce(((e,a)=>({...e,[a]:t.items[a].name})),{}),...a.reduce(((e,t)=>({...e,[t.name]:t.column})),{}),true:g.Z.t("Yes"),false:g.Z.t("No")}})(v),L=Oe(t.filters).map((e=>(e.name=k[e.id],e))),O=Zn(v.metaData),Z=xe(t.filters),R=S?null:Rn(v),x=xn(v),M=u?C:C.filter((e=>{let{id:t}=e;return void 0!==x[t]})),F=Mn(v);let U=F[0],G=F[F.length-1];const j=k[p.id],V=[];let q=t.legendSet;q||!p.legendSet||void 0!==t.method&&1!==t.method||(q=p.legendSet);const B=q?1:t.method;if(q){q=(await a.query(yt,{variables:{id:t.legendSet.id}})).legendSet}let $=[];P||($=q?rt(q):it(F,B,s,l));const z={title:j,period:L.length>0?L.map((e=>e.name||e.id)).join(", "):ca(fa(t.startDate),fa(t.endDate)),items:$};Z&&Z.length&&(z.filters=Z.map((e=>`${k[e.dimension]}: ${e.items.map((e=>k[e.id])).join(", ")}`))),S&&z.items.forEach((e=>e.count=0)),_&&(z.bubbles={radiusLow:i,radiusHigh:o,color:P?l:null});const W=(0,d.curry)(je)(z.items);q&&Array.isArray(z.items)&&z.items.length>=2&&(U=z.items[0].startValue,G=z.items[z.items.length-1].endValue);const Y=(0,On._b)().range([i,o]).domain([U,G]).clamp(!0);if(M.length||(C.length?V.push({code:Zt,message:j}):V.push({code:Rt,message:g.Z.t("Thematic layer")})),m&&!E.length&&V.push({code:xt,message:m.name}),R){Object.keys(R).forEach((e=>{Object.keys(R[e]).forEach((t=>{const a=R[e][t],n=Number(a.value),r=W(n);a.color=P?l:r?r.color:"#CCCCCC",a.radius=Y(n)}))}))}else M.forEach((e=>{let{id:t,geometry:a,properties:n}=e;const r=x[t],i=W(r),o="Point"===a.type,{hasAdditionalGeometry:s}=n;P?n.color=l:i&&(s||i.count++,n.color=s&&o?D:i.color,n.legend=i.name,n.range=`${i.startValue} - ${i.endValue}`),n.value=r,n.radius=s?I:Y(r)}));return u&&Array.isArray(z.items)&&!_&&z.items.push({color:u,name:g.Z.t("No data")}),{...t,data:M,periods:O,valuesByPeriod:R,name:j,legend:z,method:B,alerts:V,isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0,loadError:b}},In=e=>{let{config:t,onLoad:a,loaderAlertAction:r}=e;const{showAlerts:i}=Oa(r),{currentUser:o}=(0,p.Z)(),s=(0,n.bQ)(),l=o.keyAnalysisDisplayProperty.toUpperCase();return(0,u.useEffect)((()=>{Fn({config:t,engine:s,nameProperty:l}).then((e=>{var t;null!==(t=e.alerts)&&void 0!==t&&t.length&&r&&i(e.alerts),a(e)}))}),[t,s,a,l,i,r]),null};In.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired,loaderAlertAction:f().func};const Un=In,Gn="TRACKED_ENTITY_INSTANCE",jn=e=>e.filter((e=>{var t;return!(null===(t=e.geometry)||void 0===t||!t.coordinates)})).reduce(((e,t)=>(e[t.id]=t,e)),{}),Vn=e=>e.trackedEntity.trackedEntity,qn=(e,t,a,n)=>{const r=t.relationships.filter((e=>((e,t,a)=>e.relationshipType===t&&(Vn(e.from)===a||Vn(e.to)===a))(e,n,t.id)));r.forEach((n=>{const r=n.relationship,i=n.bidirectional||false;if(e[r])return;const o=a[Vn(n.to)];if(o&&t.id!==o.id)e[r]={id:r,from:t,to:o,bidirectional:!!i};else{const o=a[Vn(n.from)];o&&t.id!==o.id&&i&&(e[r]={id:r,from:t,reversedTo:o,bidirectional:!!i})}}))},Bn=["trackedEntity~rename(id)","geometry","relationships"],$n=async(e,t,a)=>{var n,r;let{relationshipType:i,orgUnits:o,organisationUnitSelectionMode:s}=a;const l=i.fromConstraint,d=i.toConstraint;if(l.relationshipEntity!==Gn||d.relationshipEntity!==Gn)return[];const c=l.trackedEntityType.id===d.trackedEntityType.id,f="program"in l&&"program"in d&&(null==l||null===(n=l.program)||void 0===n?void 0:n.id)===(null==d||null===(r=d.program)||void 0===r?void 0:r.id)||!("program"in l||"program"in d),u="program"in d;let p=null;c&&!f&&u?p={program:d.program.id}:(!c||f||u)&&(c||f)||(p={type:d.trackedEntityType});const m=jn(t);let g;if(c&f)g=m;else{const t="2.40"==`${e.major}.${e.minor}`?"instances":"trackedEntities",a=await(async e=>{let{program:t,type:a,fields:n,orgUnits:r,organisationUnitSelectionMode:i}=e,o=`/tracker/trackedEntities?skipPaging=true&fields=${n}&orgUnit=${r}`;return i&&(o+=`&ouMode=${i}`),t&&(o+=`&program=${t}`),a&&(o+=`&trackedEntityType=${a.id}`),await na(o)})({...p,fields:Bn,orgUnits:o,organisationUnitSelectionMode:s});g=jn(a[t])}const b=[],y=t.filter((e=>((e,t,a)=>{let n=!1;for(let r=0;r<e.relationships.length;++r){const i=e.relationships[r];if(i.relationshipType!==t)continue;const o=Vn(i.to)===e.id,s=Vn(i.from)===e.id;(!i.bidirectional&&s&&!o||i.bidirectional&&(s||o))&&(n=!0,s?a.push(Vn(i.to)):a.push(Vn(i.from)))}return n})(e,i.id,b))),h={};y.forEach((e=>qn(h,e,g,i.id)));const v=Object.values(g).filter((e=>b.includes(e.id)));return{primary:Object.values(m),relationships:Object.values(h),secondary:v}},zn=["trackedEntity~rename(id)","geometry"],Wn=[$a,za,Wa],Yn=e=>e.map((e=>{let{id:t,geometry:a}=e;return{type:Ha,geometry:a,properties:{id:t}}})),Hn=async(e,t)=>{if(e.config&&"string"==typeof e.config){try{const t=JSON.parse(e.config);e.relationshipType=t.relationships.type,e.relatedPointColor=t.relationships.pointColor,e.relatedPointRadius=t.relationships.pointRadius,e.relationshipLineColor=t.relationships.lineColor,e.relationshipOutsideProgram=t.relationships.relationshipOutsideProgram,e.periodType=t.periodType}catch(e){}delete e.config}const{trackedEntityType:a,program:n,programStatus:r,followUp:i,relationshipType:o,periodType:s,startDate:l,endDate:d,rows:c,organisationUnitSelectionMode:f,eventPointColor:u,eventPointRadius:p,areaRadius:m,relatedPointColor:b,relatedPointRadius:y,relationshipLineColor:h}=e,v=n?n.name:g.Z.t("Tracked entity"),E={title:v,period:ca(fa(l),fa(d)),items:[{name:a.name+(m?` + ${m} m buffer`:""),color:u||R,radius:p||6}]},C=Ne(c).map((e=>e.id)).join(";");let S,w,_=`/tracker/trackedEntities?skipPaging=true&fields=${[...zn,"relationships"]}&orgUnit=${C}`;f&&(_+=`&ouMode=${f}`),n?(_+=`&program=${n.id}`,r&&(_+=`&programStatus=${r}`,w=`${g.Z.t("Program status")}: ${[{id:"ALL",name:g.Z.t("All")},{id:"ACTIVE",name:g.Z.t("Active")},{id:"COMPLETED",name:g.Z.t("Completed")},{id:"CANCELLED",name:g.Z.t("Cancelled")}].find((e=>e.id===r)).name}`),void 0!==i&&(_+="&followUp="+(i?"TRUE":"FALSE"))):_+=`&trackedEntityType=${a.id}`,_+="program"===s?`&enrollmentEnrolledAfter=${l}&enrollmentEnrolledBefore=${d}`:`&updatedAfter=${l}&updatedBefore=${d}`;const P=(await na(_))["2.40"==`${t.major}.${t.minor}`?"instances":"trackedEntities"].filter((e=>{var t,a;return Wn.includes(null===(t=e.geometry)||void 0===t?void 0:t.type)&&(null===(a=e.geometry)||void 0===a?void 0:a.coordinates)}));let k,A,T;if(P.length||(S={code:Zt,message:a.name}),o){const e=await na(`/relationshipTypes/${o}`),a=e.toConstraint.trackedEntityType.id,n=await na(`/trackedEntityTypes/${a}?fields=displayName,featureType`),r=n.featureType===$a.toUpperCase();E.items.push({type:Ya,name:e.displayName,color:h||M,weight:1},{name:`${n.displayName} (${g.Z.t("related")})`,color:b||x,radius:r?y||3:void 0,weight:r?void 0:1});const i=await $n(t,P,{relationshipType:e,orgUnits:C,organisationUnitSelectionMode:f});k=Yn(i.primary),A=i.relationships,T=Yn(i.secondary)}else k=Yn(P);return w&&(E.explanation=[w]),{...e,name:v,data:k,relationships:A,secondaryData:T,legend:E,...S?{alerts:[S]}:{},isLoaded:!0,isLoading:!1,isExpanded:!0,isVisible:!0}},Jn=e=>{let{config:t,onLoad:a,loaderAlertAction:r}=e;const{showAlerts:i}=Oa(r),{serverVersion:o}=(0,n.zw)();return(0,u.useEffect)((()=>{Hn(t,o).then((e=>{var t;null!==(t=e.alerts)&&void 0!==t&&t.length&&r&&i(e.alerts),a(e)}))}),[t,a,i,r,o]),null};Jn.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired,loaderAlertAction:f().func};const Qn={earthEngine:Ra,event:bn,external:vn,facility:Sn,orgUnit:Ln,thematic:Un,trackedEntity:Jn,geoJsonUrl:kn},Kn=e=>{let{config:t,dataTableOpen:a,onLoad:n,loaderAlertAction:r}=e;const i=Qn[t.layer];return i?u.createElement(i,{config:t,onLoad:n,dataTableOpen:a,loaderAlertAction:r}):(console.log("Unknown layer type",t.layer,t),null)};Kn.defaultProps={dataTableOpen:!1,onError:Function.prototype},Kn.propTypes={config:f().object.isRequired,onLoad:f().func.isRequired,dataTableOpen:f().bool,loaderAlertAction:f().func};const Xn=Kn;var er=a(44977);const tr=[{type:"zoom"},{type:"fullscreen"},{type:"fitBounds"},{type:"scale",imperial:!1},{type:"search"},{type:"measure"}],ar=[{type:"zoom"},{type:"fullscreen"},{type:"fitBounds"},{type:"attribution",prefix:!1}],nr=[{type:"zoom"}],rr=(e,t,a)=>{let n;return n=e?a||nr:a||t?ar:tr,t?n.map((e=>({...e,isSplitView:t}))):n};var ir=a(26059),or=a.n(ir);const sr=(e,t)=>{let{id:a,config:n,opacity:r,isVisible:i}=e,{map:o,isPlugin:s}=t;const l=(0,La.VY)(Ot,Lt),d=(0,La.VY)(Ot,Lt),c=(0,u.useMemo)((()=>o.createLayer({...n,id:a,index:0})),[o,a,n]);return(0,u.useEffect)((()=>(o.addLayer(c).catch((e=>{if(or().error(`Basemap could not be added: ${e}`),!s){const a=(t=e,{msg:g.Z.t("Basemap could not be added: {{message}}",{message:t,nsSeparator:";"})});e.includes("not found")?l.show(a):d.show(a)}var t})),()=>o.removeLayer(c))),[o,c,s]),(0,u.useEffect)((()=>{c.setOpacity(r)}),[c,r]),(0,u.useEffect)((()=>{c.setVisibility(i)}),[c,i]),null};sr.contextTypes={map:f().object},sr.propTypes={config:f().object,id:f().string,isVisible:f().bool,opacity:f().number},sr.defaultProps={opacity:1,isVisible:!0};const lr=sr,dr=(e,t)=>{if(!t)return e;let a=[...e];return Object.keys(t).forEach((e=>{const n=t[e];a=a.filter((t=>{const a=(t.properties||t)[e];return"number"==typeof a?fr(a,n):cr(a,n)}))})),a},cr=(e,t)=>(""+e).toLowerCase().includes(t.toLowerCase()),fr=(e,t)=>t.split(",").some((t=>t.split("&").every((t=>ur(e,t))))),ur=(e,t)=>t.includes(">")?e>=Number(t.split(">")[1]):t.includes("<")?e<=Number(t.split("<")[1]):e===Number(t);var pr=a(36206),mr=a.n(pr);const gr="MapLoadingMask_cover__lW6Me",br=()=>u.createElement(er.Y,{translucent:!0,className:mr()(gr,"dhis2-map-loading-mask"),dataTest:"map-loading-mask"},u.createElement(i.M,null,u.createElement(o.V,null)));var yr=a(67200);const hr="Alert_alert__ozfEk",vr=e=>{let{message:t,critical:a,warning:n,onHidden:r}=e;return u.createElement("div",{className:hr},u.createElement(yr.N,{critical:a,warning:n,duration:1e4,onHidden:r},t))};vr.propTypes={message:f().string.isRequired,onHidden:f().func.isRequired,critical:f().string.boolean,warning:f().string.boolean};const Er=vr;function Cr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class Sr extends u.PureComponent{constructor(){super(...arguments),Cr(this,"state",{}),Cr(this,"onPopupClose",(()=>{this.setState({popup:null})})),this.setPeriod(),this.createLayer()}componentDidUpdate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{id:a,data:n,index:r,opacity:i,isVisible:o,editCounter:s,dataFilters:l,feature:d}=this.props,{period:c}=this.state,{period:f}=t||{},u=s!==e.editCounter;(a!==e.id||n!==e.data||(null==c?void 0:c.id)!==(null==f?void 0:f.id)||l!==e.dataFilters||u)&&(u?this.setPeriod(this.updateLayer.bind(this)):this.updateLayer(l!==e.dataFilters)),void 0!==r&&r!==e.index&&this.setLayerOrder(),i!==e.opacity&&this.setLayerOpacity(),o!==e.isVisible&&this.setLayerVisibility(),d!==e.feature&&this.highlightFeature(d)}componentWillUnmount(){this.removeLayer()}async createLayer(){const{id:e,index:t=0,config:a,opacity:n,isVisible:r}=this.props,{map:i}=this.context;this.layer=i.createLayer({...a,id:e,index:t,opacity:n,isVisible:r}),await i.addLayer(this.layer)}async updateLayer(){await this.removeLayer(),await this.createLayer(!0),this.setLayerOrder(),this.setLayerVisibility()}setPeriod(e){e&&e()}setLayerVisibility(){this.layer.setVisibility(this.props.isVisible)}setLayerOpacity(){this.layer.setOpacity(this.props.opacity)}setLayerOrder(){this.layer&&this.layer.setIndex(this.props.index)}fitBounds(){const{map:e}=this.context;this.layer.getBounds&&e.fitBounds(this.layer.getBounds(),{padding:40,duration:0,bearing:e.getMapGL().getBearing()})}fitBoundsOnce(){this.isZoomed&&void 0!==this.context.map.getZoom()||(this.fitBounds(),this.isZoomed=!0)}async removeLayer(){if(this.layer){const{map:e}=this.context;this.layer.off("contextmenu",this.onFeatureRightClick,this),await e.removeLayer(this.layer),delete this.layer}}highlightFeature(e){this.layer.highlight&&this.layer.highlight(e?e.id:null)}render(){return null}onFeatureRightClick(e){const[t,a]=e.position,n={...this.props},{id:r,layer:i,renderingStrategy:o}=n,{map:s}=this.context,l=s.getContainer(),{left:d,top:c}=l.getBoundingClientRect(),f=o===P;this.props.openContextMenu({...e,position:[t,a],offset:[d,c],layerConfig:n,layerId:r,layerType:i,isSplitView:f,map:s,container:f?l.parentNode.parentNode:l}),this.setState({popup:null})}onError(e){const t=e.message||e;this.context.isPlugin?or().error(t):this.setState({error:t})}onErrorHidden(){this.setState({error:null})}}Cr(Sr,"contextTypes",{map:f().object,isPlugin:f().bool}),Cr(Sr,"propTypes",{id:f().string.isRequired,config:f().object,data:f().array,dataFilters:f().object,editCounter:f().number,feature:f().object,index:f().number,isVisible:f().bool,opacity:f().number,openContextMenu:f().func}),Cr(Sr,"defaultProps",{opacity:1,isVisible:!0});const wr=Sr,_r=e=>{const{name:t,shortName:a}=(e=>{const t=[{id:"count",name:g.Z.t("Count")},{id:"min",name:g.Z.t("Min")},{id:"max",name:g.Z.t("Max")},{id:"mean",name:g.Z.t("Mean")},{id:"median",name:g.Z.t("Median")},{id:"sum",name:g.Z.t("Sum")},{id:"stdDev",name:g.Z.t("Standard deviation"),shortName:g.Z.t("Std dev")},{id:"variance",name:g.Z.t("Variance")}];return e?t.filter((t=>{let{id:a}=t;return e.includes(a)})):t})().find((t=>t.id===e))||{};return a||t};var Pr=a(19176);const kr=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=(0,u.useRef)(null),r=(0,u.useMemo)((()=>Array.isArray(e)?e:[e]),[e]),i=(0,u.useCallback)((e=>{r.includes(e.key)&&(a?n.current=setTimeout((()=>t(e)),250):t(e))}),[r,t,a]),o=(0,u.useCallback)((e=>{r.includes(e.key)&&a&&clearTimeout(n.current)}),[r,a]);(0,u.useEffect)((()=>(window.addEventListener("keydown",i),window.addEventListener("keyup",o),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",o)})),[i,o])};var Ar=a(87538),Tr=a(87517);const Nr="OrgUnitButton_orgUnitButton__w6Jd1",Lr=e=>{let{id:t,orgUnitProfile:a,setOrgUnitProfile:n}=e;return u.createElement("div",{className:Nr},u.createElement(Ar.z,{small:!0,disabled:t===a,onClick:()=>n(t)},g.Z.t("View profile")))};Lr.propTypes={id:f().string.isRequired,setOrgUnitProfile:f().func.isRequired,orgUnitProfile:f().string};const Or=(0,Tr.$j)((e=>{let{orgUnitProfile:t}=e;return{orgUnitProfile:t}}),{setOrgUnitProfile:e=>({type:"ORGANISATION_UNIT_PROFILE_SET",payload:e})})(Lr),Zr=(e,t)=>{const{className:a="",coordinates:n,orgUnitId:r,onClose:i,children:o}=e,{map:s,isPlugin:l}=t,d=(0,u.useMemo)((()=>document.createElement("div")),[]);return kr("Escape",(()=>s.closePopup())),(0,u.useEffect)((()=>{d.className=a,s.openPopup(d,n,i)}),[s,d,a,n,i]),(0,u.useEffect)((()=>()=>s.closePopup()),[s]),(0,Pr.createPortal)(u.createElement(u.Fragment,null,o,!1===l&&r&&u.createElement(Or,{id:r})),d)};Zr.contextTypes={map:f().object,isPlugin:f().bool},Zr.propTypes={coordinates:f().array.isRequired,onClose:f().func.isRequired,children:f().node,className:f().string};const Rr=Zr,xr="EarthEnginePopup_popup__1k3Y7",Mr="EarthEnginePopup_title__sFc3Q",Dr="EarthEnginePopup_table__uIYZy",Fr="EarthEnginePopup_unit__fSQsf",Ir="EarthEnginePopup_classes__AN8t3",Ur="EarthEnginePopup_loading__P2TKS",Gr=e=>{const{coordinates:t,feature:a,data:n,legend:r,valueType:i,onClose:s}=e,{id:l,name:d}=a.properties,{title:c,period:f="",unit:p,items:m=[],groups:b}=r,y="object"==typeof n?n[l]:null,h=pa(i),v="percentage"===i,E="loading"===n;let C=null;if(y)if(h){const e=Ge(v?2:0);C=u.createElement("table",{className:Dr},u.createElement("thead",null,u.createElement("tr",null,u.createElement("th",{colSpan:"2"},c," ",f),u.createElement("th",null,i))),u.createElement("tbody",null,m.filter((e=>y[e.value])).sort(((e,t)=>y[t.value]-y[e.value])).map((t=>{let{value:a,name:n,color:r}=t;return u.createElement("tr",{key:a,className:Ir},u.createElement("th",{style:{backgroundColor:r}}),u.createElement("th",null,n),u.createElement("td",null,e(y[a]),v?"%":""))}))))}else{const e=1===i.length&&"sum"===i[0],t=(e,t)=>1===b.length?e:1===i.length?t:`${t}_${e}`,a=e=>Ge(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){const t=[...e].sort(((e,t)=>e-t)),a=t[0],n=t[t.length-1],r=n-a,i=Math.abs(n);return i>=1e4?0:i>=1e3?r>10?0:1:i>=100?r>1?1:2:i>=10?r>.1?2:3:i>=1?r>.01?3:4:r>.001?4:5}return 0}(Object.values(n).map((t=>Object.keys(t).filter((t=>t.includes(e))).map((e=>t[e])))).flat())),r=i.reduce(((e,t)=>(e[t]=a(t),e)),{}),o=u.createElement("caption",null,c," ",f,!e&&u.createElement("div",{className:Fr},p));C=b?u.createElement("table",{className:Dr},o,u.createElement("thead",null,u.createElement("tr",null,u.createElement("th",null,"Group"),i.map((e=>u.createElement("th",{key:e},_r(e)))))),u.createElement("tbody",null,b.map((e=>{let{id:a,name:n}=e;return u.createElement("tr",{key:a},u.createElement("th",null,n),i.map((e=>u.createElement("td",{key:e},r[e](y[t(e,a)])))))}))),b.length>1&&u.createElement("tfoot",null,u.createElement("tr",null,u.createElement("th",null,g.Z.t("All groups")),i.map((e=>u.createElement("td",{key:e},r[e](y[e]))))))):u.createElement("table",{className:Dr},o,u.createElement("tbody",null,i.map((e=>u.createElement("tr",{key:e},u.createElement("th",null,_r(e),":"),u.createElement("td",null,r[e](y[e])))))))}return u.createElement(Rr,{coordinates:t,orgUnitId:l,onClose:s,className:"dhis2-map-popup-orgunit"},u.createElement("div",{className:xr},u.createElement("div",{className:Mr},d),C,E&&u.createElement("div",{className:Ur},u.createElement(o.V,{small:!0}),g.Z.t("Loading data"))))};Gr.propTypes={coordinates:f().array.isRequired,feature:f().object.isRequired,legend:f().object.isRequired,onClose:f().func.isRequired,data:f().oneOfType([f().string,f().object]),valueType:f().oneOfType([f().string,f().array])};const jr=Gr;function Vr(){return Vr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Vr.apply(this,arguments)}function qr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Br=e=>null!=e,$r={events:{resource:"tracker/events",id:e=>{let{id:t}=e;return t}}},zr=e=>{let{coordinates:t,feature:a,styleDataItem:r,nameProperty:i,displayElements:o,eventCoordinateFieldName:s,onClose:l}=e;const[d,c]=(0,u.useState)(),{refetch:f,fetching:p}=(0,n.u_)(Ea,{lazy:!0}),{error:m,data:b,refetch:y,fetching:h}=(0,n.u_)($r,{lazy:!0});(0,u.useEffect)((()=>{(async()=>{var e;const t=await y({id:a.properties.id||a.properties[Ia]}),n=null==t||null===(e=t.events)||void 0===e?void 0:e.orgUnit;if(n){var r;const e=await f({id:n,nameProperty:i}),t=null==e||null===(r=e.orgUnit)||void 0===r?void 0:r.name;c(t)}})()}),[a,i,y,f]);const{type:v,coordinates:E}=a.geometry,{value:C}=a.properties,{dataValues:S=[],occurredAt:w}=(null==b?void 0:b.events)||{};return u.createElement(Rr,{coordinates:t,onClose:l,className:"dhis2-map-popup-event"},m&&u.createElement("table",null,u.createElement("tbody",null,u.createElement("tr",null,g.Z.t("Could not retrieve event data")),u.createElement("tr",{key:"divider",style:{height:5}}))),!h&&!p&&u.createElement("table",null,u.createElement("tbody",null,(null==b?void 0:b.events)&&(e=>{let{displayElements:t,dataValues:a,styleDataItem:n,value:r}=e;const i=[];return n&&!t.find((e=>e.id===n.id))&&i.push(u.createElement("tr",{key:n.id},u.createElement("th",null,n.name),u.createElement("td",null,Br(r)?r:g.Z.t("Not set")))),t.forEach((e=>{let{id:t,name:n,valueType:r,options:o}=e;const{value:s}=a.find((e=>e.dataElement===t))||{};let l=s;"COORDINATE"===r&&s?l=re(s):Br(s)?o&&(l=o[s]):l=g.Z.t("Not set"),i.push(u.createElement("tr",{key:t},u.createElement("th",null,n),u.createElement("td",null,l)))})),i.length&&i.push(u.createElement("tr",{key:"divider",style:{height:5}})),i})({displayElements:o,dataValues:S,styleDataItem:r,value:C}),"Point"===v&&u.createElement("tr",null,u.createElement("th",null,s||g.Z.t("Event location")),u.createElement("td",null,E[0].toFixed(6)," ",E[1].toFixed(6))),d&&u.createElement("tr",null,u.createElement("th",null,g.Z.t("Organisation unit")),u.createElement("td",null,d)),w&&u.createElement("tr",null,u.createElement("th",null,g.Z.t("Event time")),u.createElement("td",null,ie(w))))))};zr.propTypes={coordinates:f().array.isRequired,displayElements:f().array.isRequired,feature:f().object.isRequired,nameProperty:f().string.isRequired,onClose:f().func.isRequired,eventCoordinateFieldName:f().string,styleDataItem:f().object};const Wr=zr;function Yr(){return Yr=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Yr.apply(this,arguments)}function Hr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Jr=class extends wr{constructor(){super(...arguments),Hr(this,"clusterCount",0),Hr(this,"state",{popup:null,dataElements:null,eventCoordinateFieldName:null}),Hr(this,"onPopupClose",(()=>{this.setState({popup:null})}))}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,bounds:r,data:i,engine:o,eventClustering:s,eventPointColor:l,eventPointRadius:d,nameProperty:c,program:f,programStage:u,serverCluster:p,areaRadius:m,styleDataItem:g,legend:b,dataFilters:y}=this.props,h=dr(i,y),v=l&&"#"!==l.charAt(0)?"#"+l:l,E=v||O,C=g?void 0:et(E),S=C,w=d||6,_=this.context.map;let P,k;this.displayElements={};const A={type:"events",id:e,index:t,opacity:a,isVisible:n,data:h,fillColor:E,strokeColor:C,countColor:S,radius:w,onClick:this.onEventClick.bind(this)};s?p?(A.type="serverCluster",A.bounds=r,A.load=async(e,t)=>{P=P||await(0,Nt.s8)(),k=k||await tn(this.props,{d2:P,nameProperty:c,engine:o}),k=k.withBbox(e.bbox).withClusterSize(e.clusterSize).withIncludeClusterPoints(e.includeClusterPoints);const a=await P.analytics.events.getCluster(k);t(e.tileId,this.toGeoJson(a))}):(A.clusterPane=e,g&&b?(A.type="donutCluster",A.groups=b.items):A.type="clientCluster"):m&&(A.buffer=m,A.bufferStyle={color:v||O,weight:1,opacity:.2,fillOpacity:.1}),f&&u&&this.loadDisplayElements(o,c),this.layer=_.createLayer(A),_.addLayer(this.layer),this.fitBoundsOnce()}render(){const{styleDataItem:e,nameProperty:t}=this.props,{popup:a,displayElements:n,eventCoordinateFieldName:r}=this.state;return a&&n?u.createElement(Wr,Yr({},a,{styleDataItem:e,nameProperty:t,displayElements:n,eventCoordinateFieldName:r,onClose:this.onPopupClose})):null}onEventClick(e){let{feature:t,coordinates:a}=e;this.setState({popup:{feature:t,coordinates:a}})}toGeoJson(e){const t={},a=[];return e.headers.forEach(((e,a)=>t[e.name]=a)),Array.isArray(e.rows)&&e.rows.forEach((e=>{const n=e[t.extent].match(/([-\d.]+)/g),r=parseInt(e[t.count],10),i=++this.clusterCount;a.push({type:"Feature",id:i,geometry:JSON.parse(e[t.center]),properties:{cluster:r>1,cluster_id:i,point_count:r,point_count_abbreviated:Ue(r),bounds:[[n[0],n[1]],[n[2],n[3]]],id:e[t.points]}})})),a}async loadDisplayElements(e,t){const{programStage:a,eventCoordinateField:n}=this.props,r="name"===t?"displayName":"displayShortName",{programStage:i}=await e.query(Ka,{variables:{id:a.id,nameProperty:r}}),{programStageDataElements:o}=i;let s,l=[];if(Array.isArray(o)){l=o.filter((e=>e.displayInReports)).map((e=>e.dataElement));for(const t of l)await this.loadOptionSet(t,e);if(n){const e=o.find((e=>e.dataElement.id===n));e&&(s=e.dataElement.name)}}this.setState({displayElements:l,eventCoordinateFieldName:s})}async loadOptionSet(e,t){const{optionSet:a}=e;if(!a||!a.id)return e;if(a&&a.id){const{optionSet:n}=await t.query(bt,{variables:{id:a.id}});n&&n.options&&(e.options=n.options.reduce(((e,t)=>(e[t.code]=t.name,e)),{}))}}};const Qr=e=>{let{labelFontSize:t,labelFontStyle:a,labelFontWeight:n,labelFontColor:r}=e;const i=t||q;return{fontSize:i,fontStyle:a||"normal",fontWeight:n||"normal",lineHeight:1.2*parseInt(i,10)+"px",color:Qe(r)||B,paddingTop:"10px",labelNoData:g.Z.t("No data")}};function Kr(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Xr=class extends wr{constructor(){super(...arguments),Kr(this,"state",{popup:null})}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,dataFilters:i,labels:o,areaRadius:s,orgUnitFieldDisplayName:l,associatedGeometries:d,organisationUnitColor:c=D,organisationUnitGroupSet:f}=this.props,u=dr(r,i),p=this.context.map,m=f?c:et(c),g=p.createLayer({type:"group",id:e,index:t,opacity:a,isVisible:n}),b={type:C,data:u,hoverLabel:"{name}",style:{color:c,strokeColor:m},onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this),onError:this.onError.bind(this)};o&&(b.label=V,b.labelStyle={...Qr(this.props),paddingTop:"10px"}),s&&(b.buffer=s),d&&g.addLayer({type:C,data:d,hoverLabel:`{name}: ${l}`,style:{color:"rgb(149, 200, 251)",opacityFactor:.5},onClick:this.onAssociatedGeometryClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this)}),g.addLayer(b),this.layer=g,p.addLayer(this.layer).catch(this.onError.bind(this)),this.fitBoundsOnce()}getPopup(){const{coordinates:e,feature:t}=this.state.popup,{id:a,name:n,dimensions:r,pn:i}=t.properties,{orgUnitFieldDisplayName:o}=this.props;return u.createElement(Rr,{coordinates:e,orgUnitId:a,onClose:this.onPopupClose,className:"dhis2-map-popup-orgunit"},u.createElement("em",null,n),this.state.isAssociatedGeometry&&u.createElement("div",null,o),(0,d.isPlainObject)(r)&&u.createElement("div",null,g.Z.t("Groups"),":",Object.keys(r).map((e=>r[e])).join(", ")),i&&u.createElement("div",null,g.Z.t("Parent unit"),": ",i))}render(){const{popup:e,error:t}=this.state;return u.createElement(u.Fragment,null,e&&this.getPopup(),t&&u.createElement(Er,{warning:!0,message:t,onHidden:this.onErrorHidden.bind(this)}))}onFeatureClick(e){this.setState({popup:e})}onAssociatedGeometryClick(e){this.setState({popup:e,isAssociatedGeometry:!0})}};const ei=class extends wr{createLayer(){var e;const{id:t,index:a,opacity:n,isVisible:r,data:i,dataFilters:o,featureStyle:s,config:l,error:d}=this.props,{map:c,isPlugin:f}=this.context;if(d)return;const u=dr(i,o),p=Object.keys(s).length>0?{...s,radius:s.pointSize}:{...l.featureStyle,radius:null===(e=l.featureStyle)||void 0===e?void 0:e.pointSize};this.layer=c.createLayer({type:C,id:t,index:a,opacity:n,isVisible:r,data:u,style:p,onClick:f?Function.prototype:this.onFeatureClick.bind(this)}),c.addLayer(this.layer),this.fitBoundsOnce()}onFeatureClick(e){const t=(e=>{const{properties:t}=e;return t?Object.entries(t).filter((e=>{let[,t]=e;return typeof t===Va||typeof t===qa})).filter((e=>{let[t,a]=e;return"id"!==t||typeof a!==qa||!a.startsWith(Ba)})).map((e=>{let[t,a]=e;return{name:t,dataKey:t,type:typeof a===Va?Va:qa,value:a}})):[]})(this.props.data.find((t=>t.properties.id===e.feature.properties.id))).reduce(((e,t)=>{let{dataKey:a,value:n}=t;return e[a]=n,e}),{});this.props.setFeatureProfile({name:this.props.name,data:t})}};function ti(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var ai=a(50575),ni=a(51175),ri=a(54500),ii=a(31102),oi=a(67717),si=a(7780),li=a(94492),di=a(1416),ci=a(43922),fi=a(74345),ui=a(17406),pi=a(14056),mi=a(87302);const gi=1e3,bi=60*gi,yi=60*bi,hi=24*yi,vi=7*hi,Ei=30*hi,Ci=365*hi;const Si=function(e,t,a,n,r,i){const o=[[si.E,1,gi],[si.E,5,5*gi],[si.E,15,15*gi],[si.E,30,30*gi],[i,1,bi],[i,5,5*bi],[i,15,15*bi],[i,30,30*bi],[r,1,yi],[r,3,3*yi],[r,6,6*yi],[r,12,12*yi],[n,1,hi],[n,2,2*hi],[a,1,vi],[t,1,Ei],[t,3,3*Ei],[e,1,Ci]];return function(t,a,n){const r=a<t;r&&([t,a]=[a,t]);const i=n&&"function"==typeof n.range?n:function(t,a,n){const r=Math.abs(a-t)/n,i=(0,ii.Z)((e=>{let[,,t]=e;return t})).right(o,r);if(i===o.length)return e.every((0,oi.ly)(t/Ci,a/Ci,n));if(0===i)return li.A.every(Math.max((0,oi.ly)(t,a,n),1));const[s,l]=o[r/o[i-1][2]<o[i][2]/r?i-1:i];return s.every(l)}(t,a,n),s=i?i.range(t,+a+1):[];return r?s.reverse():s}}(di.jB,ci.F0,fi.Ox,ui.rr,pi.WQ,mi.Z_),wi="Timeline_timeline__J5EdJ map_box__Qmg+b",_i="Timeline_play__LOGhW",Pi="Timeline_period__-pJEz",ki="Timeline_selected__2SuNH",Ai="play",Ti="pause",Ni=e=>{let{period:t,periods:a,onChange:n,resizeCount:r}=e;const[i,o]=(0,u.useState)(null),[s,l]=(0,u.useState)("start"),[d,c]=(0,u.useState)(t),f=(0,u.useRef)(null),p=(0,u.useRef)(null),m=u.createElement("path",{d:"M0 0h24v24H0z",fillOpacity:"0.0"}),g=u.createElement("path",{d:"M8 5v14l11-7z",className:"play-icon"}),b=u.createElement("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z",className:"pause-icon"}),y=(0,u.useCallback)((()=>{if(f.current){var e;const t=null===(e=f.current.parentNode)||void 0===e?void 0:e.getBoundingClientRect(),a=t?t.width-40-20:0;o(a)}}),[]);(0,u.useEffect)((()=>(window.addEventListener("resize",y),y(),()=>window.removeEventListener("resize",y))),[y,r]);const{periodsWithTypeLevelAndRank:h,distinctLevelsCount:v}=(0,u.useMemo)((()=>fe(a)),[a]),E=(0,u.useMemo)((()=>ue(h)),[h]),C=(0,u.useMemo)((()=>((e,t)=>t.findIndex((t=>t.id===e.id))===t.length-1)(d,E)),[d,E]),S=(0,u.useMemo)((()=>E.length&&i?(0,ni.Z)().domain(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length?e.reduce(((e,t)=>{let{startDate:a,endDate:n}=t;const r=new Date(a),i=new Date(n);return[r<e[0]?r:e[0],i>e[1]?i:e[1]]}),[new Date(e[0].startDate),new Date(e[0].endDate)]):[null,null]}(E)).range([0,i]):null),[E,i]),w=(0,u.useCallback)((()=>{if(!S)return;const e=Math.round(i/80),t=Si(...S.domain(),e),a=(0,ai.LL)(S).tickValues(t);(0,ri.Z)(f.current).call(a)}),[S,i]);(0,u.useEffect)((()=>{w()}),[S,w]);const _=(0,u.useCallback)((()=>{p.current=setTimeout((()=>{const e=E.findIndex((e=>e.id===d.id)),t=e+1;t<E.length?(c(E[t]),n(E[t])):l(Ti)}),1500),l(Ai)}),[E,d,n]),P=(0,u.useCallback)((()=>{clearTimeout(p.current),l(Ti)}),[]);(0,u.useEffect)((()=>(s===Ai?_():P(),()=>clearTimeout(p.current))),[s,_,P]);const k=(0,u.useCallback)((()=>{s===Ai?P():_(),C&&(c(E[0]),n(E[0]))}),[s,C,_,P,E,n]),A=8+8*(v-1);return u.createElement("svg",{className:`dhis2-map-timeline ${wi}`,style:{height:`${32+A}px`,bottom:"30px"}},u.createElement("g",{onClick:k,transform:`translate(7, ${A/2})`,className:_i},m,s===Ai?b:g),E&&S&&u.createElement("g",{transform:"translate(40, 10)"},((e,a)=>e.map((e=>{const r=t.id===e.id,i=a(new Date(e.startDate)),o=a(new Date(e.endDate))-i;return u.createElement("rect",{key:e.id,className:mr()(Pi,{[ki]:r}),x:i,y:8*e.levelRank,width:o,height:8,onClick:()=>{return(a=e).id!==t.id&&(c(a),n(a)),void P();var a}})})))(E,S)),u.createElement("g",{transform:`translate(40, ${12+A})`,ref:f}))};Ni.propTypes={period:f().object.isRequired,periods:f().array.isRequired,onChange:f().func.isRequired,resizeCount:f().number};const Li=Ni,Oi="PeriodName_periodName__7TNSd",Zi="PeriodName_period__J0Yxx map_box__Qmg+b",Ri=e=>{let{period:t,isTimeline:a}=e;return u.createElement("div",{className:`dhis2-map-period ${Oi}`,style:a?{bottom:86}:null},u.createElement("div",{className:Zi},t))};Ri.propTypes={period:f().string.isRequired,isTimeline:f().bool};const xi=Ri;function Mi(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Di=u.createContext();const Fi=class extends wr{constructor(){super(...arguments),Mi(this,"onPeriodChange",(e=>this.setState({period:e})))}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,dataFilters:i,labels:o,valuesByPeriod:s,renderingStrategy:l=w,thematicMapType:d=k,noDataColor:c}=this.props,{period:f}=this.state,u=d===A;let p=u?r.map((e=>({...e,geometry:{type:"Point",coordinates:(0,ea.mC)(e.geometry)}}))):r;if(l!==w){const e=s[f.id]||{};p=p.map((t=>({...t,properties:{...t.properties,...e[t.id],...t.properties.hasAdditionalGeometry&&"Point"===t.geometry.type&&{color:D,radius:I}}}))),c||(p=p.filter((t=>void 0!==e[t.id])))}const m=this.context.map,g={type:"choropleth",id:e,index:t,opacity:a,isVisible:n,data:dr(p,i),hoverLabel:"{name} ({value})",color:c,onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this)};o&&(g.label=this.props.labelTemplate||V,g.labelStyle=Qr(this.props)),u?(this.layer=m.createLayer({type:"group",id:e,index:t,opacity:a,isVisible:n}),this.layer.addLayer({type:"boundary",data:r.map((e=>({...e,properties:{...e.properties,style:{color:D,weight:.5}}}))),style:{}}),this.layer.addLayer(g)):this.layer=m.createLayer(g),m.addLayer(this.layer),this.fitBoundsOnce()}setPeriod(e){const{period:t,periods:a,renderingStrategy:n=w}=this.props;if(!t&&!a)return;const r={};switch(n){case _:r.period=ue(fe(a).periodsWithTypeLevelAndRank)[0];break;case P:r.period=t;break;default:r.period=null}e?this.setState(r,e):this.state=r}getPopup(){const{columns:e,aggregationType:t,legend:a}=this.props,{popup:n,period:r}=this.state,{coordinates:i,feature:o}=n,{id:s,name:l,value:d}=o.properties,c=e[0].items[0].name||"",f=r?r.name:a.period;return u.createElement(Rr,{coordinates:i,orgUnitId:s,onClose:this.onPopupClose,className:"dhis2-map-popup-orgunit"},u.createElement("em",null,l),u.createElement("div",null,c),u.createElement("div",null,f),u.createElement("div",null,g.Z.t("Value"),": ",null!=d?d:g.Z.t("No data")),t&&"DEFAULT"!==t&&u.createElement("div",null,t))}render(){const{periods:e,renderingStrategy:t,filters:a,resizeCount:n}=this.props,{period:r,popup:i}=this.state,{id:o}=Le(a)||{};return u.createElement(u.Fragment,null,t===_&&r&&u.createElement(u.Fragment,null,u.createElement(xi,{period:r.name,isTimeline:!0}),u.createElement(Di.Provider,{value:{map:this.context.map}},u.createElement(Li,{periodId:o,period:r,periods:e,onChange:this.onPeriodChange,resizeCount:n}))),i&&this.getPopup())}onFeatureClick(e){this.setState({popup:e})}},Ii={trackedEntities:{resource:"tracker/trackedEntities",id:e=>{let{id:t}=e;return t},params:e=>{let{program:t}=e;return{fields:"updatedAt,orgUnit,attributes[displayName~rename(name),value,attribute],relationships",program:null==t?void 0:t.id}}}},Ui=e=>{let{coordinates:t,feature:a,activeDataSource:r,program:i,nameProperty:o,displayAttributes:s,onClose:l}=e;const[d,c]=(0,u.useState)(),{refetch:f,fetching:p}=(0,n.u_)(Ea,{lazy:!0}),{error:m,data:b,refetch:y,fetching:h}=(0,n.u_)(Ii,{variables:{id:a.properties.id,program:i},lazy:!0});(0,u.useEffect)((()=>{(async()=>{var e;const t=await y({id:a.properties.id}),n=null==t||null===(e=t.trackedEntities)||void 0===e?void 0:e.orgUnit;if(n){var r;const e=await f({id:n,nameProperty:o}),t=null==e||null===(r=e.orgUnit)||void 0===r?void 0:r.name;c(t)}})()}),[a,o,y,f]);const{type:v,coordinates:E}=a.geometry,{attributes:C=[],updatedAt:S}=(null==b?void 0:b.trackedEntities)||{};return u.createElement(Rr,{coordinates:t,onClose:l,className:"dhis2-map-popup-event"},m&&u.createElement("table",null,u.createElement("tbody",null,u.createElement("tr",null,g.Z.t("Could not retrieve tracked entity data")),u.createElement("tr",{key:"divider",style:{height:5}}))),!h&&!p&&u.createElement("table",null,u.createElement("tbody",null,(null==b?void 0:b.trackedEntities)&&"primary"==r&&(e=>{let{displayAttributes:t,attributes:a}=e;const n=[];return t.forEach((e=>{let{id:t,name:r,valueType:i,options:o}=e;const{value:s}=a.find((e=>e.attribute===t))||{};let l=s;"COORDINATE"===i&&s?l=re(s):(e=>null!=e)(s)?o&&(l=o[s]):l=g.Z.t("Not set"),n.push(u.createElement("tr",{key:t},u.createElement("th",null,r),u.createElement("td",null,l)))})),n.length&&n.push(u.createElement("tr",{key:"divider",style:{height:5}})),n})({displayAttributes:s,attributes:C}),"Point"===v&&u.createElement("tr",null,u.createElement("th",null,g.Z.t("Tracked entity location")),u.createElement("td",null,E[0].toFixed(6)," ",E[1].toFixed(6))),d&&u.createElement("tr",null,u.createElement("th",null,g.Z.t("Organisation unit")),u.createElement("td",null,d)),S&&u.createElement("tr",null,u.createElement("th",null,g.Z.t("Last updated")),u.createElement("td",null,ie(S))))))};Ui.propTypes={coordinates:f().array.isRequired,displayAttributes:f().array.isRequired,feature:f().object.isRequired,nameProperty:f().string.isRequired,onClose:f().func.isRequired,activeDataSource:f().string,program:f().object};const Gi=Ui;function ji(){return ji=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ji.apply(this,arguments)}function Vi(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const qi={trackedEntityType:{resource:"trackedEntityTypes",id:e=>{let{id:t}=e;return t},params:e=>{let{nameProperty:t}=e;return{fields:`trackedEntityTypeAttributes[displayInList,trackedEntityAttribute[id,${t}~rename(name),optionSet,valueType]]`,paging:!1}}}},Bi={program:{resource:"programs",id:e=>{let{id:t}=e;return t},params:e=>{let{nameProperty:t}=e;return{fields:`programTrackedEntityAttributes[displayInList,trackedEntityAttribute[id,${t}~rename(name),optionSet,valueType]]`,paging:!1}}}},$i=e=>{switch(e.type){case $a:return e.coordinates;case za:return(e=>{const t=e.reduce(((e,t)=>(e[0]+=t[0],e[1]+=t[1],e)),[0,0]);return[t[0]/e.length,t[1]/e.length]})(e.coordinates[0]);default:return null}},zi=e=>{let{from:t,to:a}=e;const n=$i(t.geometry),r=$i(a.geometry);return n&&r?{type:Ha,geometry:{type:Ya,coordinates:[n,r]},properties:{}}:null};const Wi=class extends wr{constructor(){super(...arguments),Vi(this,"state",{popup:null,displayAttributes:null,trackedEntityCoordinateFieldName:null})}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,engine:i,relationships:o,secondaryData:s,eventPointColor:l,eventPointRadius:d,nameProperty:c,areaRadius:f,relatedPointColor:u,relatedPointRadius:p,relationshipLineColor:m}=this.props,{map:g}=this.context,b=l||R,y={type:C,data:r,style:{color:b,weight:1,radius:d||6},onClick:this.onEventClick.bind(this)};f&&(y.buffer=f,y.bufferStyle={color:b,weight:1,opacity:.2,fillOpacity:.1});const h=g.createLayer({type:"group",id:e,index:t,opacity:a,isVisible:n});if(this.loadDisplayAttributes(i,c),o){const e={type:C,data:s,style:{color:u||x,weight:1,radius:p||3},onClick:this.onEventClickSecondary.bind(this)},t=((e,t,a)=>({type:C,data:e.map(zi).filter((e=>!!e)),style:{color:t,weight:a}}))(o,m||M,1);h.addLayer(t),h.addLayer(e)}h.addLayer(y),this.layer=h,g.addLayer(this.layer),this.fitBoundsOnce()}render(){const{program:e,nameProperty:t}=this.props,{popup:a,displayAttributes:n}=this.state;return a?u.createElement(Gi,ji({},a,{program:e,nameProperty:t,displayAttributes:n||[],onClose:this.onPopupClose})):null}onEventClick(e){let{feature:t,coordinates:a}=e;this.setState({popup:{feature:t,coordinates:a,activeDataSource:"primary"}})}onEventClickSecondary(e){let{feature:t,coordinates:a}=e;this.setState({popup:{feature:t,coordinates:a,activeDataSource:"secondary"}})}async loadDisplayAttributes(e,t){const{trackedEntityType:a,program:n}=this.props,r="name"===t?"displayName":"displayShortName",{trackedEntityType:i}=await e.query(qi,{variables:{id:a.id,nameProperty:r}});let{trackedEntityTypeAttributes:o}=i;if(n){const{program:t}=await e.query(Bi,{variables:{id:n.id,nameProperty:r}}),{programTrackedEntityAttributes:a}=t;o=[...o,...a.filter((e=>!o.some((t=>e.trackedEntityAttribute.id===t.trackedEntityAttribute.id))))]}let s=[];if(Array.isArray(o)){s=o.filter((e=>e.displayInList)).map((e=>e.trackedEntityAttribute));for(const t of s)await this.loadOptionSet(t,e)}this.setState({displayAttributes:s})}async loadOptionSet(e,t){const{optionSet:a}=e;if(!a||!a.id)return e;if(a&&a.id){const{optionSet:n}=await t.query(bt,{variables:{id:a.id}});n&&n.options&&(e.options=n.options.reduce(((e,t)=>(e[t.code]=t.name,e)),{}))}}},Yi="Map_map__R97nG";function Hi(){return Hi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Hi.apply(this,arguments)}function Ji(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const Qi={event:Jr,trackedEntity:Wi,facility:Xr,thematic:Fi,orgUnit:class extends wr{constructor(){super(...arguments),ti(this,"state",{popup:null})}createLayer(){const{id:e,index:t,opacity:a,isVisible:n,data:r,labels:i,radiusLow:o,dataFilters:s,organisationUnitColor:l=D}=this.props,d=dr(r,s),c=this.context.map,f={type:C,id:e,index:t,opacity:a,isVisible:n,data:d,hoverLabel:"{name}",style:{color:"transparent",strokeColor:l},onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this)};i&&(f.label=V,f.labelStyle=Qr(this.props)),o&&(f.style.radius=o),this.layer=c.createLayer(f),c.addLayer(this.layer),this.fitBoundsOnce()}getPopup(){const{coordinates:e,feature:t}=this.state.popup,{id:a,name:n,level:r,parentName:i}=t.properties;return u.createElement(Rr,{coordinates:e,orgUnitId:a,onClose:this.onPopupClose,className:"dhis2-map-popup-orgunit"},u.createElement("em",null,n),r&&u.createElement("div",null,g.Z.t("Level"),": ",r),i&&u.createElement("div",null,g.Z.t("Parent unit"),": ",i))}render(){return this.state.popup?this.getPopup():null}onFeatureClick(e){this.setState({popup:e})}},earthEngine:class extends wr{constructor(){super(...arguments),qr(this,"state",{isLoading:!0,popup:null,aggregations:null,error:null}),qr(this,"updateLayer",(async e=>{e?this.applyFilter():(this.clearAggregations(),await this.removeLayer(),await this.createLayer(!0),this.setLayerOrder())}))}componentDidUpdate(e){super.componentDidUpdate(e);const{coordinate:t}=this.props;if(t&&t!==e.coordinate)try{this.layer.showValue({lng:t[0],lat:t[1]})}catch(e){this.setState({error:g.Z.t("Google Earth Engine failed. Is the service configured for this DHIS2 instance?")})}}async createLayer(e){const{id:t,index:a,format:n,opacity:r,isVisible:i,datasetId:o,band:s,maskOperator:l,attribution:d,filter:c,methods:f,mosaic:u,name:p,unit:m,legend:b,value:y,resolution:h,projection:v,style:C,popup:S,data:w,aggregationType:_,areaRadius:P,tileScale:k,unmaskAggregation:A}=this.props,{map:T,isPlugin:N}=this.context,L={type:E,id:t,index:a,format:n,opacity:r,isVisible:i,datasetId:o,band:s,maskOperator:l,attribution:d,filter:c,methods:f,mosaic:u,name:p,unit:m,value:y,noValue:g.Z.t("no value"),legend:b.items,resolution:h,projection:v,data:w,aggregationType:_,tileScale:k,unmaskAggregation:A,preload:!N&&this.hasAggregations(),onClick:this.onFeatureClick.bind(this),onRightClick:this.onFeatureRightClick.bind(this),onLoad:this.onLoad.bind(this)};C&&(L.style=C),P&&(L.buffer=P),S&&(L.popup=S),e&&this.setState({isLoading:!0}),L.getAuthToken=ba;try{this.layer=T.createLayer(L),await T.addLayer(this.layer)}catch(e){this.onError(e)}this.fitBoundsOnce()}hasAggregations(){const{data:e,aggregationType:t}=this.props;return e&&("string"==typeof t||Array.isArray(t)&&t.length)}getAggregations(){this.hasAggregations()&&!this.state.aggregations&&(this.setState({aggregations:"loading"}),this.layer.getAggregations().then(this.addAggregationValues.bind(this)).catch(this.onError.bind(this)))}addAggregationValues(e){const{id:t,data:a,setAggregations:n}=this.props;n&&n({[t]:e}),this.setState({data:a.map((t=>({...t,properties:{...t.properties,...e[t.id]}}))),aggregations:e})}clearAggregations(){if(this.hasAggregations()){const{id:e,setAggregations:t}=this.props;this.setState({aggregations:void 0}),t&&t({[e]:void 0})}}applyFilter(){const{data:e,dataFilters:t}=this.props,a=dr(this.state.data||e,t).map((e=>e.id));this.layer&&this.layer.filter&&this.layer.filter(a)}render(){const{legend:e,aggregationType:t}=this.props,{isLoading:a,popup:n,aggregations:r,error:i}=this.state;return u.createElement(u.Fragment,null,a&&u.createElement(br,null),i&&u.createElement(Er,{critical:!0,message:i,onHidden:()=>this.setState({error:null})}),n&&u.createElement(jr,Vr({data:r||{},legend:e,valueType:t,onClose:this.onPopupClose},n)))}onFeatureClick(e){this.getAggregations(),this.setState({popup:e})}onLoad(){this.setState({isLoading:!1,popup:null}),this.context.isPlugin||this.getAggregations()}onError(e){let t=e.message||e;t.includes("memory limit exceeded")&&this.props.error&&(t=this.props.error),this.setState({error:t,isLoading:!1,aggregations:"error"})}},external:class extends wr{createLayer(){const{id:e,index:t,opacity:a,isVisible:n,config:r}=this.props,{map:i}=this.context;this.layer=i.createLayer({id:e,index:t,opacity:a,isVisible:n,...r}),i.addLayer(this.layer)}},geoJsonUrl:ei};class Ki extends u.Component{constructor(e,t){super(e,t),Ji(this,"state",{}),Ji(this,"onRightClick",(e=>{const[t,a]=e.position,{left:n,top:r}=this.map.getContainer().getBoundingClientRect();this.props.openContextMenu({...e,position:[t,a],offset:[n,r]})})),Ji(this,"onMapReady",(e=>{this.setState({map:e});const{setMapObject:t}=this.props;t&&t(this.map)})),Ji(this,"onFullscreenChange",(e=>{let{isFullscreen:t}=e;Tt(this.map,t)}));const{isPlugin:a,baseUrl:n}=e,r=aa({scrollZoom:!a,baseUrl:n});a?(r.toggleMultiTouch(!0),r.on("fullscreenchange",this.onFullscreenChange)):r.on("contextmenu",this.onRightClick,this),this.map=r,r.on("ready",this.onMapReady)}getChildContext(){return{map:this.map,isPlugin:this.props.isPlugin}}componentDidMount(){const{controls:e,bounds:t,latitude:a,longitude:n,zoom:r}=this.props,{map:i}=this;this.node.appendChild(i.getContainer()),i.resize(),e&&e.filter((e=>ea.s9.includes(e.type))).forEach((e=>i.addControl(e)));const o=i.getLayersBounds();Array.isArray(o)?i.fitBounds(o):t?i.fitBounds(t):a&&n&&r?i.setView([n,a],r):i.fitWorld()}componentDidUpdate(e){const{resizeCount:t,isFullscreen:a,isPlugin:n}=this.props;t!==e.resizeCount&&this.map.resize(),n&&a!==e.isFullscreen&&Tt(this.map,a)}componentWillUnmount(){this.map&&(this.map.off("ready",this.onMapReady),this.map.remove(),delete this.map)}render(){const{basemap:e,engine:t,nameProperty:a,layers:n,feature:r,coordinatePopup:i,closeCoordinatePopup:o,openContextMenu:s,setAggregations:l,setFeatureProfile:d,resizeCount:c}=this.props,{map:f}=this.state,p=n.filter((e=>e.isLoaded));return u.createElement("div",{ref:e=>this.node=e,className:Yi},f&&u.createElement(u.Fragment,null,p.map(((e,n)=>{const i=Qi[e.layer]||wr,o=r&&r.layerId===e.id?r:null;return u.createElement(i,Hi({key:e.id,index:p.length-n,feature:o,openContextMenu:s,setAggregations:l,setFeatureProfile:d,engine:t,nameProperty:a,resizeCount:c},e))})),u.createElement(lr,e),i&&u.createElement(Rr,{coordinates:i,onClose:o},g.Z.t("Longitude"),":"," ",i[0].toFixed(6),u.createElement("br",null),g.Z.t("Latitude"),":"," ",i[1].toFixed(6))))}}Ji(Ki,"propTypes",{baseUrl:f().string.isRequired,openContextMenu:f().func.isRequired,basemap:f().object,bounds:f().array,closeCoordinatePopup:f().func,controls:f().array,coordinatePopup:f().array,engine:f().object,feature:f().object,isFullscreen:f().bool,isPlugin:f().bool,latitude:f().number,layers:f().array,longitude:f().number,nameProperty:f().string,resizeCount:f().number,setAggregations:f().func,setFeatureProfile:f().func,setMapObject:f().func,zoom:f().number}),Ji(Ki,"defaultProps",{isPlugin:!1}),Ji(Ki,"childContextTypes",{map:f().object.isRequired,isPlugin:f().bool.isRequired});const Xi=Ki,eo="MapItem_mapItem__MhRhp";function to(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class ao extends u.PureComponent{constructor(e,t){super(e,t),to(this,"state",{}),to(this,"onMapReady",(e=>this.setState({map:e})));const{isPlugin:a,baseUrl:n}=e;this.map=aa({attributionControl:!1,scrollZoom:!a,baseUrl:n}),a&&this.map.toggleMultiTouch(!0),this.map.on("ready",this.onMapReady)}getChildContext(){return{map:this.map,isPlugin:this.props.isPlugin}}componentDidMount(){const{layerId:e,index:t,setMapControls:a}=this.props,{map:n}=this;this.node.appendChild(n.getContainer()),this.fitLayerBounds(),n.sync(e),0==t&&a(n)}componentDidUpdate(e){const{count:t,isFullscreen:a,isPlugin:n}=this.props;t!==e.count&&this.fitLayerBounds(),n&&a!==e.isFullscreen&&Tt(this.map,a),this.map.resize()}componentWillUnmount(){this.map.off("ready",this.onMapReady),this.map.unsync(this.props.layerId),this.map.remove(),delete this.map}render(){const{count:e,children:t}=this.props,{map:a}=this.state;return u.createElement("div",{ref:e=>this.node=e,className:eo,style:{width:4===e?"50%":"33.3333%"}},a&&t)}fitLayerBounds(){this.map.resize();const e=this.map.getLayersBounds();e?this.map.fitBounds(e):this.map.fitWorld()}}to(ao,"childContextTypes",{map:f().object.isRequired,isPlugin:f().bool.isRequired}),to(ao,"propTypes",{baseUrl:f().string.isRequired,children:f().node.isRequired,count:f().number.isRequired,index:f().number.isRequired,layerId:f().string.isRequired,setMapControls:f().func.isRequired,isFullscreen:f().bool,isPlugin:f().bool}),to(ao,"defaultProps",{isPlugin:!1});const no=ao,ro="SplitView_splitView__YbEsG";function io(){return io=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},io.apply(this,arguments)}const oo=e=>{let{isPlugin:t,basemap:a,layer:r,feature:i,controls:o,openContextMenu:s,isFullscreen:l,interpretationModalOpen:d,setMapObject:c}=e;const{baseUrl:f}=(0,n.zw)(),[p,m]=(0,u.useState)(),[g,b]=(0,u.useState)(),y=(0,u.useRef)(),h=(0,u.useCallback)((e=>{let{isFullscreen:t}=e;return m(t)}),[]);(0,u.useEffect)((()=>{g&&o&&y.current&&(o.forEach((e=>{g.addControl(e),y.current.append(g.getControlContainer(e.type))})),c&&c(g))}),[g,o,y,c]),(0,u.useEffect)((()=>(g&&t&&g.on("fullscreenchange",h),()=>{g&&t&&g.off("fullscreenchange",h)})),[g,t,h]),(0,u.useEffect)((()=>{m(l)}),[l]);const{id:v,periods:E=[]}=r;return d?null:u.createElement("div",{ref:y,className:mr()("dhis2-map-split-view",ro)},E.map(((e,n)=>u.createElement(no,{key:e.id,index:n,count:E.length,layerId:v,setMapControls:b,isPlugin:t,isFullscreen:p,baseUrl:f},u.createElement(lr,a),u.createElement(Fi,io({index:1},r,{period:e,feature:i,openContextMenu:s})),u.createElement(xi,{period:e.name})))))};oo.propTypes={layer:f().object.isRequired,openContextMenu:f().func.isRequired,basemap:f().object,controls:f().array,feature:f().object,interpretationModalOpen:f().bool,isFullscreen:f().bool,isPlugin:f().bool,setMapObject:f().func},oo.defaultProps={openContextMenu:()=>{}};const so=oo;function lo(){return lo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},lo.apply(this,arguments)}const co=e=>{const{isPlugin:t,isFullscreen:a,basemap:r,layers:s,controls:l,feature:d,bounds:c,coordinatePopup:f,interpretationModalOpen:m,openContextMenu:g,setMapObject:b,resizeCount:y,...h}=e,{baseUrl:v}=(0,n.zw)(),E=(0,n.bQ)(),{currentUser:C}=(0,p.Z)(),S=C.keyAnalysisDisplayProperty,w=ne(s),_=!!w,P=(0,u.useMemo)((()=>rr(t,_,l)),[t,_,l]);return u.createElement(u.Fragment,null,void 0===r.id?u.createElement(er.Y,null,u.createElement(i.M,null,u.createElement(o.V,null))):u.createElement(u.Fragment,null,_?u.createElement(so,{isPlugin:t,isFullscreen:a,basemap:r,layer:w,controls:P,feature:d,interpretationModalOpen:m,openContextMenu:g,resizeCount:y,setMapObject:b}):u.createElement(Xi,lo({isPlugin:t,isFullscreen:a,basemap:r,layers:[...s].reverse(),bounds:c,controls:P,feature:d,coordinatePopup:f,openContextMenu:g,resizeCount:y,setMapObject:b,baseUrl:v,engine:E,nameProperty:S},h))))};co.propTypes={basemap:f().object,bounds:f().array,controls:f().array,coordinatePopup:f().array,feature:f().object,interpretationModalOpen:f().bool,isFullscreen:f().bool,isPlugin:f().bool,layers:f().array,openContextMenu:f().func,resizeCount:f().number,setMapObject:f().func};const fo=co;var uo=a(17775),po=a(89308),mo=a(15073),go=a(7448),bo=a(69666),yo=a(75023),ho=a(47756),vo=a(61223);const Eo="Checkbox_checkbox__VD9Z7",Co=e=>{let{label:t,checked:a=!1,disabled:n,dense:r=!0,tooltip:i,onChange:o,className:s,dataTest:l}=e;return u.createElement("div",{className:mr()(Eo,s),"data-test":l},u.createElement(ho.X,{label:t,checked:a,dense:r,disabled:n,onChange:e=>{let{checked:t}=e;return o(t)}}),i&&u.createElement(po.u,{content:i},u.createElement(vo.Z,null)))};Co.propTypes={onChange:f().func.isRequired,checked:f().bool,className:f().string,dataTest:f().string,dense:f().bool,disabled:f().bool,label:f().string,tooltip:f().string};const So="ColorButton_colorButton__R+Adn",wo=e=>{let{color:t,onChange:a,className:n}=e;return u.createElement("label",{className:mr()(So,n),style:{backgroundImage:`radial-gradient(\n                        circle, ${t} 35%, transparent 40%\n                    )`}},u.createElement("input",{type:"color",value:t,onChange:e=>a(e.target.value.toUpperCase())}))};wo.propTypes={color:f().string.isRequired,onChange:f().func.isRequired,className:f().string};const _o=wo;var Po=a(63429);const ko="ColorPicker_colorPicker__cDBFg",Ao="ColorPicker_label__2MEbh",To="ColorPicker_icon__YLETT",No="ColorPicker_dark__ScuM6",Lo=e=>{let{color:t,label:a,width:n,height:r,onChange:i,className:o}=e;return u.createElement(u.Fragment,null,u.createElement("div",{className:mr()(ko,o)},a&&u.createElement("div",{className:Ao},a),u.createElement("label",{style:{backgroundColor:t,width:n||"100%",height:r||32}},u.createElement("span",{className:mr()(To,{[No]:!Xe(t)})},u.createElement(Po.Z,null)),u.createElement("input",{type:"color",value:t,onChange:e=>i(e.target.value.toUpperCase())}))))};Lo.propTypes={color:f().string.isRequired,onChange:f().func.isRequired,className:f().string,height:f().oneOfType([f().string,f().number]),label:f().string,width:f().oneOfType([f().string,f().number])};const Oo="ColorScale_colorScale__49vdu",Zo="ColorScale_item__pC2V1",Ro=e=>{let{scale:t,bins:a,width:n,onClick:r}=e;const i=ze[t][a],o=n?n/a:36;return u.createElement("ul",{onClick:()=>r(t),className:Oo,style:{...n&&{width:n}}},i.map(((e,t)=>u.createElement("li",{key:t,className:Zo,style:{backgroundColor:e,width:o}}))))};Ro.propTypes={bins:f().number.isRequired,scale:f().string.isRequired,onClick:f().func.isRequired,width:f().number};const xo=Ro,Mo="ColorScaleSelect_colorScale__4hvzQ",Do="ColorScaleSelect_popover__y0bcu",Fo=e=>{let{palette:t,width:a,onChange:n,className:r}=e;const[i,o]=(0,u.useState)(!1),s=(0,u.useRef)(),l=t.length,d=(e=>We.find((t=>ze[t][e.length].join(",")===e.join(","))))(t),c=e=>{n(Ye(e,l)),o(!1)};return u.createElement(u.Fragment,null,u.createElement("div",{ref:s,className:mr()(Mo,r)},u.createElement(xo,{bins:l,scale:d,onClick:()=>o(!0),width:a||260})),i&&u.createElement(uo.J,{reference:s,arrow:!1,placement:"right",onClickOutside:()=>o(!1)},u.createElement("div",{className:Do,style:{width:a+24||260}},We.map(((e,t)=>u.createElement(xo,{key:t,scale:e,bins:l,onClick:c,width:a||260}))))))};Fo.propTypes={palette:f().array.isRequired,onChange:f().func.isRequired,className:f().string,width:f().number};const Io=e=>{let{condition:t,wrapper:a,children:n}=e;return t?a(n):n};Io.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired,condition:f().bool.isRequired,wrapper:f().elementType.isRequired};const Uo=Io,Go="CustomRadioLabel_customRadioLabel__sQCAD",jo="CustomRadioLabel_labelsWrap__wpfpi",Vo="CustomRadioLabel_icon__30JEO",qo="CustomRadioLabel_iconChecked__xUMki",Bo="CustomRadioLabel_disabled__xwkO2",$o="CustomRadioLabel_label__Uwhxp",zo="CustomRadioLabel_sublabel__UQL4N",Wo=e=>{let{icon:t,label:a,sublabel:n,checked:r,disabled:i}=e;return u.createElement("div",{className:mr()(Go,{[Bo]:i})},u.createElement("div",{className:mr()(Vo,{[qo]:r})},t),u.createElement("div",{className:jo},u.createElement("div",{className:$o},a),u.createElement("div",{className:zo},n)))};Wo.propTypes={checked:f().bool.isRequired,icon:f().node.isRequired,label:f().string.isRequired,sublabel:f().string.isRequired,disabled:f().bool};const Yo="DatePicker_datePicker__o+7IX",Ho="DatePicker_label__dxJ2X",Jo="DatePicker_content__rClMi",Qo="DatePicker_box__g-fUm",Ko="DatePicker_inputDiv__YD05P",Xo="DatePicker_input__3iMEB",es=e=>{let{label:t,name:a,defaultVal:n,onBlur:r,className:i}=e;const o=(0,u.useRef)(null);return(0,u.useEffect)((()=>{o.current&&n&&(o.current.defaultValue=n.slice(0,10))}),[n]),u.createElement("div",{className:mr()(Yo,i)},u.createElement("label",{className:Ho},t),u.createElement("div",{className:Jo},u.createElement("div",{className:Qo},u.createElement("div",{className:Ko},u.createElement("input",{className:Xo,ref:o,type:"date",name:a,onBlur:e=>r(e.target.value)})))))};es.propTypes={label:f().string.isRequired,onBlur:f().func.isRequired,className:f().string,defaultVal:f().string,name:f().string};var ts=a(25330),as=a(15648),ns=a(93883);const rs="InputField_inputField__kOwID",is=e=>{let{label:t,value:a,min:n,max:r,step:i=1,dense:o=!0,disabled:s,helpText:l,inputWidth:d,onChange:c,className:f}=e;return u.createElement("div",{className:mr()(rs,f)},u.createElement(ns.U,{dense:o,type:"number",min:String(n),max:String(r),step:String(i),label:t,value:Number.isNaN(a)?"":String(a),disabled:s,onChange:e=>{let{value:t}=e;return c(Number(t))},helpText:l,inputWidth:d}))};is.propTypes={label:f().string.isRequired,onChange:f().func.isRequired,className:f().string,dense:f().bool,disabled:f().bool,helpText:f().string,inputWidth:f().string,max:f().number,min:f().number,step:f().number,value:f().oneOfType([f().number,f().string])};const os=is,ss="FontStyle_fontStyle__1hQJn",ls="FontStyle_textSize__U8QDq",ds=e=>{let{color:t,size:a,weight:n,fontStyle:r,onColorChange:i,onSizeChange:o,onWeightChange:s,onStyleChange:l,className:d}=e;return u.createElement("div",{className:mr()(ss,d)},o&&u.createElement(os,{dense:!0,label:g.Z.t("Size"),min:6,max:100,value:parseInt(void 0!==a?a:q,10),onChange:e=>o(e+"px"),className:ls}),i&&u.createElement(_o,{color:Qe(t)||B,onChange:i,button:!0}),s&&u.createElement(Ar.z,{icon:u.createElement(ts.Z,null),onClick:()=>{s("bold"===n?"normal":"bold")},secondary:!0,toggled:"bold"===n}),l&&u.createElement(Ar.z,{icon:u.createElement(as.Z,null),onClick:()=>{l("italic"===r?"normal":"italic")},secondary:!0,toggled:"italic"===r}))};ds.propTypes={className:f().string,color:f().string,fontStyle:f().string,size:f().oneOfType([f().string,f().number]),weight:f().string,onColorChange:f().func,onSizeChange:f().func,onStyleChange:f().func,onWeightChange:f().func};const cs="Help_help__7P-ad",fs="Help_content__dogcj",us=e=>{let{children:t}=e;return u.createElement("div",{className:cs},u.createElement(vo.Z,null),u.createElement("div",{className:fs},t))};us.propTypes={children:f().node.isRequired};const ps="IconButton_iconButton__7QtUX",ms="IconButton_disabled__1mgmW",gs=e=>{let{tooltip:t,onClick:a,className:n,children:r,dataTest:i,disabled:o,ariaLabel:s}=e;return u.createElement("button",{onClick:a,className:mr()(ps,n,{[ms]:!!o}),"data-test":i,disabled:o,"aria-label":s},t?u.createElement(po.u,{content:t},r):r)};gs.propTypes={ariaLabel:f().string,children:f().node,className:f().string,dataTest:f().string,disabled:f().bool,tooltip:f().string,onClick:f().func};const bs="ImageSelect_imageSelect__S8yu-",ys="ImageSelect_title__xJ8wS",hs="ImageSelect_imageContainer__dV03s",vs="ImageSelect_imageContainerSelected__XcG8R",Es="ImageSelect_image__RTHOQ",Cs="ImageSelect_noImage__fcKtR",Ss=e=>{let{id:t,img:a,title:n,isSelected:r,onClick:i,className:o}=e;return u.createElement("div",{className:mr()(bs,o),title:n,onClick:()=>i(t)},n?u.createElement("div",{className:ys},n):null,u.createElement("div",{className:mr()(hs,{[vs]:r})},a?u.createElement("img",{src:a,className:Es}):u.createElement("div",{className:Cs})))};Ss.propTypes={id:f().string.isRequired,onClick:f().func.isRequired,className:f().string,img:f().string,isSelected:f().bool,title:f().string};const ws=e=>{let{option:t,onDisplayOptionChange:a}=e;return u.createElement(js,{label:g.Z.t("Display"),loading:!1,items:[{id:V,name:g.Z.t("Name")},{id:"{name}\n{value}",name:g.Z.t("Name and value")},{id:"{value}",name:g.Z.t("Value")}],value:t||null,onChange:e=>{let{id:t}=e;return a(t)}})};ws.propTypes={onDisplayOptionChange:f().func.isRequired,option:f().string};const _s="MenuButton_menuButton__tGXHP",Ps=e=>{let{children:t,dataTest:a,disabled:n,name:r,onBlur:i,onClick:o,onFocus:s}=e;return u.createElement("button",{className:_s,"data-test":a,disabled:n,name:r,onBlur:i,onClick:o,onFocus:s},t)};Ps.propTypes={children:f().node,dataTest:f().string,disabled:f().bool,name:f().string,onBlur:f().func,onClick:f().func,onFocus:f().func};var ks=a(92718),As=a(75125);const Ts="RadioGroup_radioGroup__WKKLI",Ns="RadioGroup_row__B5Px0",Ls="RadioGroup_label__tx+Nt",Os="RadioGroup_boldLabel__lxq-T",Zs=u.createContext(),Rs=e=>{let{value:t,label:a,helpText:n,display:r="column",onChange:i,boldLabel:o=!1,children:s,dataTest:l}=e;const[d,c]=(0,u.useState)(t);return(0,u.useEffect)((()=>{c(t)}),[t]),u.createElement(Zs.Provider,{value:{radio:d,onChange:i}},u.createElement("div",{className:mr()(Ts,{[Ns]:"row"===r})},a&&u.createElement("div",{className:mr()(Ls,{[Os]:o})},a),u.createElement(As.N,{helpText:n,dataTest:l},s)))};Rs.propTypes={onChange:f().func.isRequired,boldLabel:f().bool,children:f().arrayOf(f().node),dataTest:f().string,display:f().oneOf(["row","column"]),helpText:f().string,label:f().string,value:f().oneOfType([f().string,f().number])};const xs="Radio_disabled__Y8KwW",Ms=e=>{let{value:t,disabled:a,dense:n=!0,dataTest:r,label:i}=e;const{radio:o,onChange:s}=(0,u.useContext)(Zs);return u.createElement(ks.Y,{className:mr()({[xs]:a}),label:i,dense:n,disabled:a,checked:t===o,onChange:()=>{t!==o&&s(t)},dataTest:r,value:t})};Ms.propTypes={label:f().oneOfType([f().string,f().node]).isRequired,dataTest:f().string,dense:f().bool,disabled:f().bool,value:f().oneOfType([f().string,f().number])};var Ds=a(3376),Fs=a(18275),Is=a(37126),Us=a(86484);const Gs=e=>{const{dense:t=!0,emptyText:a,errorText:n,helpText:r,warning:i,items:o,label:s,prefix:l,loading:d,multiple:c,filterable:f,disabled:p,onChange:m,className:g,value:b,dataTest:y}=e,h=!0===d,v=c?Ds.n:Fs.n,E=c?Is.M:Us.a;let C;C=c?Array.isArray(b)?b.map((e=>String(e))):[]:null!=b?String(b):"";const S=(0,u.useCallback)((e=>{let{selected:t}=e;return m(c?o.filter((e=>t.includes(String(e.id)))).map((e=>e.id)):o.find((e=>String(e.id)===t)))}),[o,c,m]);return u.createElement("div",{className:mr()(rs,g)},u.createElement(v,{dense:t,label:s,prefix:l,selected:h?void 0:C,filterable:f,disabled:p,loading:h,error:!!n,warning:!!i,validationText:i||n,helpText:r,empty:a,onChange:S,dataTest:y},o&&o.map((e=>{let{id:t,name:a}=e;return u.createElement(E,{key:t,value:String(t),label:a})}))))};Gs.propTypes={className:f().string,dataTest:f().string,dense:f().bool,disabled:f().bool,emptyText:f().string,errorText:f().string,filterable:f().bool,helpText:f().string,items:f().arrayOf(f().shape({id:f().oneOfType([f().string,f().number]).isRequired,name:f().string})),label:f().string,loading:f().oneOfType([f().bool,f().string]),multiple:f().bool,prefix:f().string,value:f().oneOfType([f().string,f().number,f().arrayOf(f().oneOfType([f().string,f().number]))]),warning:f().string,onChange:f().func};const js=Gs;var Vs=a(48556),qs=a(61462);const Bs=u.createContext(),$s=e=>{let{value:t,onChange:a,children:n}=e;const[r,i]=(0,u.useState)(t);return(0,u.useEffect)((()=>{t!==r&&i(t)}),[t,r]),u.createElement(Bs.Provider,{value:{tab:r,onChange:a}},u.createElement(qs.n,null,n))};$s.propTypes={children:f().oneOfType([f().arrayOf(f().node),f().node]).isRequired,value:f().string.isRequired,onChange:f().func.isRequired};const zs=e=>{let{value:t,dataTest:a,children:n}=e;const{tab:r,onChange:i}=(0,u.useContext)(Bs);return u.createElement(Vs.O,{selected:t===r,onClick:()=>{t!==r&&i(t)},dataTest:a},n)};zs.propTypes={children:f().node.isRequired,value:f().string.isRequired,dataTest:f().string};const Ws=e=>{let{type:t,label:a,value:n,dense:r=!0,onChange:i,className:o}=e;return u.createElement("div",{className:mr()(rs,o)},u.createElement(ns.U,{dense:r,type:t,label:a,value:n,onChange:e=>{let{value:t}=e;return i(t)}}))};Ws.propTypes={label:f().string.isRequired,onChange:f().func.isRequired,className:f().string,dense:f().bool,type:f().string,value:f().string};const Ys="ContextMenu_anchor__creaN",Hs="ContextMenu_menu__2SOPg",Js=e=>{const{position:t,offset:a,feature:r,container:i,isSplitView:o,onDrill:s,onClose:l}=e,{isDisconnected:d}=(0,n.Uw)(),c=(0,u.useRef)(),[f,p]=(0,u.useState)();(0,u.useEffect)((()=>{if(t){const[e,n]=t;if(o){const[t,r]=a,{left:o,top:s}=i.getBoundingClientRect();p({left:t-o+e,top:r-s+n})}else p({left:e,top:n})}}),[t,a,i,o]);const{hasCoordinatesUp:m,hasCoordinatesDown:b}=r.properties;return u.createElement(u.Fragment,null,u.createElement("div",{ref:c,className:Ys,style:f}),u.createElement(uo.J,{reference:c,arrow:!1,placement:"right",onClickOutside:l},u.createElement("div",{className:Hs},u.createElement(Uo,{condition:d,wrapper:e=>u.createElement(po.u,{content:g.Z.t("Not available offline")},e)},u.createElement(mo.v,{dense:!0},u.createElement(go.s,{label:g.Z.t("Drill up one level"),icon:u.createElement(bo.Z,null),disabled:!m||d,onClick:()=>s("up")}),u.createElement(go.s,{label:g.Z.t("Drill down one level"),icon:u.createElement(yo.Z,null),disabled:!b||d,onClick:()=>s("down")}))))))};Js.propTypes={onClose:f().func.isRequired,onDrill:f().func.isRequired,container:f().instanceOf(Element),feature:f().object,isSplitView:f().bool,offset:f().array,position:f().array};const Qs=Js,Ks=e=>{let{radius:t,maxRadius:a,text:n,textAlign:r,color:i,stroke:o,pattern:s}=e;const l="left"===r,d=a,c=2*a-t,f=l?d-a-al:d+a+al,p=2*a-2*t,m=f+(l?-nl:nl),g=l?"end":"start";return u.createElement("g",null,u.createElement("circle",{cx:d,cy:c,r:t,stroke:o||"#000",style:{fill:s?`url(#${s})`:i||"none",strokeWidth:.5}}),n&&u.createElement("g",null,u.createElement("line",{x1:d,x2:f,y1:p,y2:p,stroke:"black",style:{strokeDasharray:"2, 2",strokeWidth:.5}}),u.createElement("text",{x:m,y:p,textAnchor:g,alignmentBaseline:"middle",style:{fontSize:12}},n)))};Ks.propTypes={maxRadius:f().number.isRequired,radius:f().number.isRequired,color:f().string,pattern:f().string,stroke:f().string,text:f().string,textAlign:f().oneOf(["left","right"])};const Xs=Ks;function el(){return el=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},el.apply(this,arguments)}const tl={paddingTop:10},al=16,nl=4,rl=e=>{let{radiusLow:t,radiusHigh:a,color:n,classes:r}=e;const i=2*a+4,o=(0,On._b)().range([t,a]),s=o(.5);if(isNaN(t)||isNaN(a))return null;let l=[];if(Array.isArray(r)&&r.length){const e=r[0].startValue,t=r[r.length-1].endValue,n=o.domain([e,t]);l=[...r].reverse().map((e=>({radius:n(e.endValue),maxRadius:a,color:e.color,text:String(e.endValue)}))),l.push({radius:n(e),maxRadius:a,text:String(e)})}else{const e=n&&et(n);l=[{radius:a,maxRadius:a,color:n,stroke:e,text:g.Z.t("Max")},{radius:s,maxRadius:a,color:n,stroke:e,text:g.Z.t("Mid")},{radius:t,maxRadius:a,color:n,stroke:e,text:g.Z.t("Min")}]}let d=Math.ceil(6.8*Math.max(oe(r,"startValue"),oe(r,"endValue")));const c=2*(a+al+nl+d);let f=l.reduce(((e,t,a)=>{const n=e.radius-t.radius,r=void 0===e.gap||n<e.gap?n:e.gap;return a===l.length-1?Math.round(2*r):{radius:t.radius,gap:r}}));const p=c<245,m=p&&f>5&&f<12;if(p||(f/=2),f<6){const[e]=l,t=l[l.length-1],a=e.radius-t.radius,n=[0];if(a>6&&n.push(l.length-1),a>15){const e=t.radius+a/2,r=l.reduce(((t,a)=>a.radius>=e&&a.radius-e<t.radius-e?a:t));n.push(l.indexOf(r))}l.forEach(((e,t)=>{n.includes(t)||delete e.text}))}d=Math.ceil(6.8*oe(l,"text"));const b=d+al+nl;return u.createElement("div",{style:tl},u.createElement("svg",{width:245,height:i+20},u.createElement("g",{transform:`translate(${m?b:"2"} 10)`},l.map(((e,t)=>u.createElement(Xs,el({key:t},e,{textAlign:m&&t%2==0?"left":"right"})))))))};rl.propTypes={radiusHigh:f().number.isRequired,radiusLow:f().number.isRequired,classes:f().array,color:f().string};const il=rl,ol="LegendItemRange_legendItemRange__IgIK+",sl=e=>{let{name:t="",startValue:a,endValue:n,count:r}=e;return u.createElement("td",{className:ol},isNaN(a)?t:`${t} ${a} - ${n}`,void 0!==r?` (${r})`:"")};sl.propTypes={count:f().number,endValue:f().number,name:f().string,startValue:f().number};const ll=sl,dl=e=>{let{color:t,weight:a}=e;return u.createElement("svg",{viewBox:"0 0 24 24",style:{width:24,height:24}},u.createElement("path",{stroke:t,fill:t,strokeWidth:a/2,d:"M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"}))};dl.propTypes={color:f().string,weight:f().number};const cl=dl,fl=e=>{let{color:t,fill:a="none",weight:n}=e;return u.createElement("svg",{viewBox:"0 0 24 24",style:{width:24,height:24}},u.createElement("path",{fill:a,stroke:t,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",d:"M 3.5 18.5 l 7.5 2.5 l 11 -2 L 19 12 l 3 -4 l -8 -3 l -8 2 L 2 14 z"}))};fl.propTypes={color:f().string,fill:f().string,weight:f().number};const ul=fl,pl="LegendItem_legendItem__Jjz38",ml=e=>{let{type:t,image:a,color:n,strokeColor:r,fillColor:i,radius:o,weight:s,name:l,startValue:d,endValue:c,count:f}=e;if(!l&&void 0===d)return null;const p={backgroundImage:a?`url(${a})`:"none",backgroundColor:n||"transparent"};if(r&&(p.border=`1px solid ${r}`),o){const e=2*Math.min(o,15);p.width=`${e}px`,p.height=`${e}px`,p.borderRadius="50%"}const m=s?Math.min(s,5):null;return u.createElement("tr",{className:pl,"data-test":"layerlegend-item"},u.createElement("th",null,s?"LineString"===t?u.createElement(cl,{color:n,weight:m}):u.createElement(ul,{color:r||n,fill:i,weight:m}):u.createElement("span",{style:p})),u.createElement(ll,{name:l,startValue:d,endValue:c,count:f}))};ml.propTypes={color:f().string,count:f().number,endValue:f().number,fillColor:f().string,image:f().string,name:f().string,radius:f().number,startValue:f().number,strokeColor:f().string,type:f().string,weight:f().number};const gl=ml,bl="Legend_legend__eAr+e",yl="Legend_description__EmtXT",hl="Legend_legendImage__bYIN+",vl="Legend_filters__eMkd8",El="Legend_group__J8bob",Cl="Legend_unit__7lYDI",Sl="Legend_explanation__eeeOy",wl="Legend_source__0a062";function _l(){return _l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},_l.apply(this,arguments)}const Pl=e=>{let{description:t,filters:a,groups:n,unit:r,items:i,bubbles:o,explanation:s,url:l,source:d,sourceUrl:c}=e;return u.createElement("dl",{className:bl,"data-test":"layerlegend"},t&&u.createElement("div",{className:yl},t),n&&u.createElement("div",{className:El},n.length>1?g.Z.t("Groups"):g.Z.t("Group"),n.map((e=>{let{id:t,name:a}=e;return u.createElement("div",{key:t},a)}))),r&&i&&u.createElement("div",{className:Cl},r),o?u.createElement(il,_l({},o,{classes:i})):Array.isArray(i)&&u.createElement("table",null,u.createElement("tbody",null,i.map(((e,t)=>u.createElement(gl,_l({},e,{key:`item-${t}`})))))),l&&u.createElement("img",{className:hl,src:l}),Array.isArray(a)&&u.createElement("div",{className:vl},u.createElement("div",null,g.Z.t("Filters"),":"),a.map(((e,t)=>u.createElement("div",{key:t},e)))),Array.isArray(s)&&u.createElement("div",{className:Sl},s.map(((e,t)=>u.createElement("div",{key:t},e)))),d&&u.createElement("div",{className:wl},g.Z.t("Source"),": ",c?u.createElement("a",{href:c,target:"_blank",rel:"noreferrer"},d):u.createElement("span",null,d)))};Pl.propTypes={bubbles:f().shape({radiusHigh:f().number.isRequired,radiusLow:f().number.isRequired,color:f().string}),description:f().string,explanation:f().array,filters:f().array,groups:f().array,items:f().array,source:f().string,sourceUrl:f().string,unit:f().string,url:f().string};const kl=Pl,Al=e=>{let{id:t,legend:a,alerts:n=[]}=e;return u.createElement("div",{key:t},a&&u.createElement(u.Fragment,null,u.createElement("h2",{className:"dhis2-map-legend-title"},a.title,u.createElement("span",{className:"dhis2-map-legend-period"},a.period)),u.createElement(kl,a)),n.map(((e,t)=>u.createElement("div",{key:t,className:"dhis2-map-legend-alert"},e.message))))};Al.propTypes={id:f().string.isRequired,alerts:f().array,data:f().array,layer:f().string,legend:f().object,serverCluster:f().bool};const Tl=Al;function Nl(){return Nl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Nl.apply(this,arguments)}const Ll=e=>{let{layers:t}=e;const[a,n]=(0,u.useState)(!1),r=t.filter((e=>e.legend||e.alerts)).reverse();return u.createElement("div",{className:"dhis2-map-legend"},a?u.createElement("div",{className:"dhis2-map-legend-content",onMouseLeave:()=>n(!1)},r.map((e=>u.createElement(Tl,Nl({key:e.id},e))))):u.createElement("div",{className:"dhis2-map-legend-button",title:g.Z.t("Legend"),onMouseEnter:()=>n(!0)}))};Ll.propTypes={layers:f().array.isRequired};const Ol=Ll,Zl="Map_map__XD3B7";function Rl(){return Rl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Rl.apply(this,arguments)}const xl=[[-18.7,-34.9],[50.2,35.9]],Ml=(0,u.forwardRef)(((e,t)=>{const{basemap:a,mapViews:n,controls:r,getResizeFunction:s}=e,l=(0,u.useRef)(n.map((e=>({...e,isLoaded:!1}))));(0,u.useEffect)((()=>{var e;e=l.current,n.some(((t,a)=>{const n=e[a];return!(n.layer===E||n.filters.length===t.filters.length&&n.rows.length===t.rows.length&&!t.filters.some(((e,t)=>{const a=n.filters[t].items.map((e=>e.id)),r=e.items.map((e=>e.id));return a.length!==r.length||!a.every(((e,t)=>e===r[t]))}))&&!t.rows.some(((e,t)=>{const a=n.rows[t].items.map((e=>e.id)),r=e.items.map((e=>e.id));return a.length!==r.length||!a.every(((e,t)=>e===r[t]))})))}))&&(l.current=n.map((e=>({...e,isLoaded:!1}))),c(!1))}),[n]);const[d,c]=(0,u.useState)(!1),[f,p]=(0,u.useState)(),[m,g]=(0,u.useState)(0),b=()=>g((e=>e+1)),y=(0,u.useCallback)((e=>{l.current=l.current.map((t=>e.id===t.id?e:t)),l.current.every((e=>e.isLoaded))&&c(!0)}),[]);(0,u.useEffect)((()=>{s&&s(b)}),[s]);if(!d){const e=l.current.filter((e=>!e.isLoaded));return u.createElement(i.M,null,u.createElement(o.V,null),e.map((e=>u.createElement(Xn,{key:e.id,config:e,onLoad:y}))))}return u.createElement("div",{ref:t,className:`dhis2-map-plugin ${Zl}`},u.createElement(_t.z,null),u.createElement(Pt.k,{colors:!0,spacers:!0,theme:!0}),u.createElement(fo,{isPlugin:!0,isFullscreen:!1,basemap:a,layers:l.current,controls:r,bounds:xl,openContextMenu:p,resizeCount:m}),u.createElement(Ol,{layers:l.current}),f&&u.createElement(Qs,Rl({},f,{onDrill:async e=>{const{layerId:t,feature:a}=f;let n;if(t&&a){const{level:r,id:i,parentGraph:o,grandParentId:s,grandParentParentGraph:d}=a.properties,f=l.current.find((e=>e.id===t));n="up"===e?At(f,s,d,parseInt(r)-1):At(f,i,o,parseInt(r)+1),l.current=l.current.map((e=>e.id===t?{...n,isLoaded:!1}:e)),c(!1),p()}},onClose:()=>p()})))}));Ml.displayName="PluginMap",Ml.propTypes={basemap:f().object,controls:f().array,getResizeFunction:f().func,mapViews:f().array,name:f().string};const Dl=Ml;function Fl(){return Fl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Fl.apply(this,arguments)}const Il=e=>{let{visualization:t}=e;const a=(0,n.bQ)(),{systemSettings:r}=(0,p.Z)(),[i,o]=(0,u.useState)(null);(0,u.useEffect)((()=>{const{basemap:e,mapViews:n,userOrgUnit:i,id:s,...l}=t,d=async()=>{var t,d,c;const{keyBingMapsApiKey:f,keyDefaultBaseMap:u}=r;let p;if(s&&!n){const e=await(async(e,t,a)=>t.query({map:pt},{variables:{id:e}}).then((e=>lt(e.map,a))).catch((()=>{throw new Error(`Could not load map with id "${e}"`)})))(s,a,u);p=lt(e,u)}else p=n?lt({basemap:e,mapViews:n},u):await((e,t,a)=>{const{name:n}=e;return st({ao:e,engine:a}).then((e=>({name:n,basemap:{id:t},mapViews:[{id:_e(),...e}]})))})(l,u,a);const{basemap:m}=await wt({basemapId:null===(t=p.basemap)||void 0===t?void 0:t.id,basemapVisible:null===(d=p.basemap)||void 0===d?void 0:d.isVisible,keyDefaultBaseMap:u,keyBingMapsApiKey:f,engine:a});o({...p,mapViews:i?null===(c=p.mapViews)||void 0===c?void 0:c.map((e=>({...e,userOrgUnit:i}))):p.mapViews,basemap:m})};ge()(r)||d()}),[t,r,a]);const{basemap:s,mapViews:l,userOrgUnit:d,id:c,...f}=t;return i?u.createElement(Dl,Fl({},i,f)):u.createElement(pe,null)};Il.propTypes={visualization:f().object};const Ul=Il,Gl={schemas:[]},jl={systemSettings:{resource:"systemSettings",params:{key:["keyAnalysisRelativePeriod","keyBingMapsApiKey","keyHideDailyPeriods","keyHideWeeklyPeriods","keyHideBiWeeklyPeriods","keyHideMonthlyPeriods","keyHideBiMonthlyPeriods","keyDefaultBaseMap"]}},currentUser:{resource:"me",params:{fields:"id,username,displayName~rename(name),authorities,settings[keyAnalysisDisplayProperty]"}}},Vl=e=>{let{systemSettings:t,currentUser:a}=e;return{systemSettings:Object.assign({},Y,t,{hiddenPeriods:ce(t)}),currentUser:{id:a.id,name:a.name,username:a.username,authorities:new Set(a.authorities),keyAnalysisDisplayProperty:a.settings.keyAnalysisDisplayProperty},nameProperty:"name"===a.settings.keyAnalysisDisplayProperty?"displayName":"displayShortName"}},ql=e=>{let{visualization:t,displayProperty:a}=e;return u.createElement(m.D,{d2Config:Gl},(e=>{let{d2:n,d2Error:r}=e;return n||r?u.createElement(p.n,{query:jl,dataTransformation:Vl,translucent:!1},u.createElement(Ul,{visualization:t,displayProperty:a})):u.createElement(pe,null)}))};ql.propTypes={displayProperty:f().string,visualization:f().object};const Bl={READY:"READY",INSTALLING:"INSTALLING"};function $l(e){let{installingWorker:t,onStateChange:a}=e;t.onstatechange=()=>{"activated"===t.state&&a(Bl.READY)}}function zl(){return zl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},zl.apply(this,arguments)}const Wl=()=>u.createElement(r.m,null,u.createElement(i.M,null,u.createElement(o.V,null))),Yl=e=>{let{id:t,children:a,cacheNow:r,isParentCached:i}=e;const{startRecording:o,isCached:s,remove:d}=(0,n.Of)(t);return(0,u.useEffect)((()=>{r&&o({onError:console.error})}),[r]),(0,u.useEffect)((()=>{const e=l().on("removeCachedData",{window:window.parent},(()=>d()));return()=>e.cancel()}),[d]),(0,u.useEffect)((()=>{!i&&s&&d()}),[i]),u.createElement(n.MW,{id:t,loadingMask:Wl},a)};Yl.propTypes={cacheNow:f().bool,children:f().node,id:f().string,isParentCached:f().bool};const Hl=e=>{l().send(window.parent,"installationStatus",{installationStatus:e})},Jl=()=>{const[e,t]=(0,u.useState)(),[a,n]=(0,u.useState)(null),r=e=>t(e.data);return(0,u.useEffect)((()=>{l().send(window.parent,"getProps").then(r).catch((e=>console.error(e))),async function(e){let{onStateChange:t}=e;if(!navigator.serviceWorker)return null;const a=await navigator.serviceWorker.getRegistration();return a?a.active?Bl.READY:a.installing?($l({installingWorker:a.installing,onStateChange:t}),Bl.INSTALLING):(a.onupdatefound=()=>{t(Bl.INSTALLING);const e=a.installing;e&&$l({installingWorker:e,onStateChange:t})},null):null}({onStateChange:Hl}).then(Hl);const e=l().on("newProps",{window:window.parent},r);return()=>e.cancel()}),[]),(0,u.useLayoutEffect)((()=>{const e=(0,d.debounce)(300,(()=>n((e=>"number"==typeof e?e+1:1))));return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),[]),e?u.createElement("div",{style:{display:"flex",height:"100%",overflow:"hidden"}},u.createElement(Yl,{id:e.cacheId,cacheNow:e.recordOnNextLoad,isParentCached:e.isParentCached},u.createElement(ql,zl({id:a},e)))):null}}}]);